"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const s=require("./room-DPWLzMyU.cjs"),T=require("./index-C__bLGR6.cjs"),a=require("react");function y({viewer:i,children:m,...f}){const{room:c,component:d,addComponent:p}=s.useInternalFeatures("presence3dAutodesk"),[r,u]=a.useState(null);return a.useEffect(()=>{if(!c||r||!i)return;const l=new T.Ry(i,f);p(l),u(Date.now())},[c,i]),a.useEffect(()=>{!d&&r&&u(null)},[d]),m??s.jsxRuntimeExports.jsx(s.jsxRuntimeExports.Fragment,{})}function $({modelUrn:i,clientId:m,clientSecret:f,authUrl:c,initializeOptions:d,data:p,onDocumentLoadError:r,onDocumentLoadSuccess:u,onViewerInitialized:l,isAvatarsEnabled:S,isLaserEnabled:g,isNameEnabled:j,isMouseEnabled:b,avatarConfig:v,...I}){const[w,x]=a.useState(null),{hasJoinedRoom:A}=s.useInternalFeatures("presence3dAutodesk"),R=c||"https://developer.api.autodesk.com/authentication/v2/token",V=btoa(`${m}:${f}`),z={grant_type:"client_credentials",scope:"data:read bucket:read",...p};a.useEffect(()=>{if(A){E();return}w&&(w.finish(),x(null))},[A]);async function E(){let t=null;if(!window.Autodesk){console.error("[Superviz] Autodesk not found");return}await fetch(R,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${V}`},body:new URLSearchParams(z).toString()}).then(e=>e.json()).then(e=>{const o=`urn:${btoa(i)}`,k={env:"AutodeskProduction2",api:"streamingV2",accessToken:e.access_token,...d};window.Autodesk.Viewing.Initializer(k,async()=>{const h=document.getElementById("autodesk-content");if(!h){console.error("[Superviz] Autodesk container not found");return}t=new window.Autodesk.Viewing.GuiViewer3D(h),await t.start(),l&&l({viewer:t,container:h}),window.Autodesk.Viewing.Document.load(o,F,P)})});function F(e){u&&u(e);const n=e.getRoot().getDefaultGeometry();if(!n||!t)return;const o={applyScaling:"meters"};t.loadDocumentNode(e,n,o).then(()=>{t&&x(t)}).catch(k=>{console.error("[SuperViz] Failed to load document node",k)})}function P(e,n,o){r&&r(e,n,o),console.error("[SuperViz] Failed to load document",e,n,o)}}return s.jsxRuntimeExports.jsx(y,{viewer:w,isAvatarsEnabled:S,isLaserEnabled:g,isNameEnabled:j,isMouseEnabled:b,avatarConfig:v,children:s.jsxRuntimeExports.jsx("div",{id:"autodesk-content",...I})})}exports.AutodeskPresence=y;exports.AutodeskViewer=$;
