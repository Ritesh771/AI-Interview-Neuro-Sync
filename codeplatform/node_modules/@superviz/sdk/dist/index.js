import{a as Gt,b as Wt,c as Vt,d as Me,e as Wi,f as Vi,g as Ht,h as Yr,i as Hi,j as it,k as zi,l as is,m as te,n as ss}from"./chunks/chunk-HLDC3GQS.js";import{a as $i,b as rs}from"./chunks/chunk-3ONINIVE.js";import{a as zt}from"./chunks/chunk-UMKOLOIY.js";import{a as tt,b as A,c as Q,d as Xr,e as Qr,f as es,g as rt,h as ts,i as q}from"./chunks/chunk-VQOGFHZT.js";import{b as y,c as L,d as Gi,e as Y,f as pe,h as S,i as m,j as E}from"./chunks/chunk-3ZCZGH34.js";var os=Y((ru,ns)=>{m();var De=1e3,Be=De*60,Ue=Be*60,Le=Ue*24,ho=Le*7,mo=Le*365.25;ns.exports=function(r,t){t=t||{};var e=typeof r;if(e==="string"&&r.length>0)return fo(r);if(e==="number"&&isFinite(r))return t.long?vo(r):go(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function fo(r){if(r=String(r),!(r.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(t){var e=parseFloat(t[1]),i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return e*mo;case"weeks":case"week":case"w":return e*ho;case"days":case"day":case"d":return e*Le;case"hours":case"hour":case"hrs":case"hr":case"h":return e*Ue;case"minutes":case"minute":case"mins":case"min":case"m":return e*Be;case"seconds":case"second":case"secs":case"sec":case"s":return e*De;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:return}}}}function go(r){var t=Math.abs(r);return t>=Le?Math.round(r/Le)+"d":t>=Ue?Math.round(r/Ue)+"h":t>=Be?Math.round(r/Be)+"m":t>=De?Math.round(r/De)+"s":r+"ms"}function vo(r){var t=Math.abs(r);return t>=Le?$t(r,t,Le,"day"):t>=Ue?$t(r,t,Ue,"hour"):t>=Be?$t(r,t,Be,"minute"):t>=De?$t(r,t,De,"second"):r+" ms"}function $t(r,t,e,i){var s=t>=e*1.5;return Math.round(r/e)+" "+i+(s?"s":"")}});var cs=Y((nu,as)=>{m();function bo(r){e.debug=e,e.default=e,e.coerce=a,e.disable=n,e.enable=s,e.enabled=c,e.humanize=os(),e.destroy=l,Object.keys(r).forEach(u=>{e[u]=r[u]}),e.names=[],e.skips=[],e.formatters={};function t(u){let p=0;for(let d=0;d<u.length;d++)p=(p<<5)-p+u.charCodeAt(d),p|=0;return e.colors[Math.abs(p)%e.colors.length]}e.selectColor=t;function e(u){let p,d=null,h,f;function v(...O){if(!v.enabled)return;let w=v,G=Number(new Date),W=G-(p||G);w.diff=W,w.prev=p,w.curr=G,p=G,O[0]=e.coerce(O[0]),typeof O[0]!="string"&&O.unshift("%O");let V=0;O[0]=O[0].replace(/%([a-zA-Z%])/g,(F,U)=>{if(F==="%%")return"%";V++;let z=e.formatters[U];if(typeof z=="function"){let $=O[V];F=z.call(w,$),O.splice(V,1),V--}return F}),e.formatArgs.call(w,O),(w.log||e.log).apply(w,O)}return v.namespace=u,v.useColors=e.useColors(),v.color=e.selectColor(u),v.extend=i,v.destroy=e.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(h!==e.namespaces&&(h=e.namespaces,f=e.enabled(u)),f),set:O=>{d=O}}),typeof e.init=="function"&&e.init(v),v}function i(u,p){let d=e(this.namespace+(typeof p=="undefined"?":":p)+u);return d.log=this.log,d}function s(u){e.save(u),e.namespaces=u,e.names=[],e.skips=[];let p,d=(typeof u=="string"?u:"").split(/[\s,]+/),h=d.length;for(p=0;p<h;p++)d[p]&&(u=d[p].replace(/\*/g,".*?"),u[0]==="-"?e.skips.push(new RegExp("^"+u.slice(1)+"$")):e.names.push(new RegExp("^"+u+"$")))}function n(){let u=[...e.names.map(o),...e.skips.map(o).map(p=>"-"+p)].join(",");return e.enable(""),u}function c(u){if(u[u.length-1]==="*")return!0;let p,d;for(p=0,d=e.skips.length;p<d;p++)if(e.skips[p].test(u))return!1;for(p=0,d=e.names.length;p<d;p++)if(e.names[p].test(u))return!0;return!1}function o(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function a(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}as.exports=bo});var Zi=Y((re,Zt)=>{m();re.formatArgs=Eo;re.save=Po;re.load=Co;re.useColors=yo;re.storage=wo();re.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();re.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function yo(){if(typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let r;return typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&(r=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(r[1],10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Eo(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+Zt.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;r.splice(1,0,t,"color: inherit");let e=0,i=0;r[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(e++,s==="%c"&&(i=e))}),r.splice(i,0,t)}re.log=console.debug||console.log||(()=>{});function Po(r){try{r?re.storage.setItem("debug",r):re.storage.removeItem("debug")}catch(t){}}function Co(){let r;try{r=re.storage.getItem("debug")}catch(t){}return!r&&typeof process!="undefined"&&"env"in process&&(r=E.DEBUG),r}function wo(){try{return localStorage}catch(r){}}Zt.exports=cs()(re);var{formatters:To}=Zt.exports;To.j=function(r){try{return JSON.stringify(r)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var Jt=Y((vu,us)=>{m();function _o(r){var t=typeof r;return r!=null&&(t=="object"||t=="function")}us.exports=_o});var ps=Y((yu,ds)=>{m();var Ao=typeof window=="object"&&window&&window.Object===Object&&window;ds.exports=Ao});var qi=Y((Pu,hs)=>{m();var Oo=ps(),So=typeof self=="object"&&self&&self.Object===Object&&self,Mo=Oo||So||Function("return this")();hs.exports=Mo});var fs=Y((wu,ms)=>{m();var Lo=qi(),Ro=function(){return Lo.Date.now()};ms.exports=Ro});var vs=Y((_u,gs)=>{m();var ko=/\s/;function Io(r){for(var t=r.length;t--&&ko.test(r.charAt(t)););return t}gs.exports=Io});var ys=Y((Ou,bs)=>{m();var xo=vs(),No=/^\s+/;function Fo(r){return r&&r.slice(0,xo(r)+1).replace(No,"")}bs.exports=Fo});var Ki=Y((Mu,Es)=>{m();var Do=qi(),Bo=Do.Symbol;Es.exports=Bo});var Ts=Y((Ru,ws)=>{m();var Ps=Ki(),Cs=Object.prototype,Uo=Cs.hasOwnProperty,jo=Cs.toString,st=Ps?Ps.toStringTag:void 0;function Go(r){var t=Uo.call(r,st),e=r[st];try{r[st]=void 0;var i=!0}catch(n){}var s=jo.call(r);return i&&(t?r[st]=e:delete r[st]),s}ws.exports=Go});var As=Y((Iu,_s)=>{m();var Wo=Object.prototype,Vo=Wo.toString;function Ho(r){return Vo.call(r)}_s.exports=Ho});var Ls=Y((Nu,Ms)=>{m();var Os=Ki(),zo=Ts(),$o=As(),Zo="[object Null]",Jo="[object Undefined]",Ss=Os?Os.toStringTag:void 0;function qo(r){return r==null?r===void 0?Jo:Zo:Ss&&Ss in Object(r)?zo(r):$o(r)}Ms.exports=qo});var ks=Y((Du,Rs)=>{m();function Ko(r){return r!=null&&typeof r=="object"}Rs.exports=Ko});var xs=Y((Uu,Is)=>{m();var Yo=Ls(),Xo=ks(),Qo="[object Symbol]";function ea(r){return typeof r=="symbol"||Xo(r)&&Yo(r)==Qo}Is.exports=ea});var Bs=Y((Gu,Ds)=>{m();var ta=ys(),Ns=Jt(),ia=xs(),Fs=NaN,ra=/^[-+]0x[0-9a-f]+$/i,sa=/^0b[01]+$/i,na=/^0o[0-7]+$/i,oa=parseInt;function aa(r){if(typeof r=="number")return r;if(ia(r))return Fs;if(Ns(r)){var t=typeof r.valueOf=="function"?r.valueOf():r;r=Ns(t)?t+"":t}if(typeof r!="string")return r===0?r:+r;r=ta(r);var e=sa.test(r);return e||na.test(r)?oa(r.slice(2),e?2:8):ra.test(r)?Fs:+r}Ds.exports=aa});var Gs=Y((Vu,js)=>{m();var ca=Jt(),Yi=fs(),Us=Bs(),la="Expected a function",ua=Math.max,da=Math.min;function pa(r,t,e){var i,s,n,c,o,a,l=0,u=!1,p=!1,d=!0;if(typeof r!="function")throw new TypeError(la);t=Us(t)||0,ca(e)&&(u=!!e.leading,p="maxWait"in e,n=p?ua(Us(e.maxWait)||0,t):n,d="trailing"in e?!!e.trailing:d);function h(F){var U=i,z=s;return i=s=void 0,l=F,c=r.apply(z,U),c}function f(F){return l=F,o=setTimeout(w,t),u?h(F):c}function v(F){var U=F-a,z=F-l,$=t-U;return p?da($,n-z):$}function O(F){var U=F-a,z=F-l;return a===void 0||U>=t||U<0||p&&z>=n}function w(){var F=Yi();if(O(F))return G(F);o=setTimeout(w,v(F))}function G(F){return o=void 0,d&&i?h(F):(i=s=void 0,c)}function W(){o!==void 0&&clearTimeout(o),l=0,i=a=s=o=void 0}function V(){return o===void 0?c:G(Yi())}function J(){var F=Yi(),U=O(F);if(i=arguments,s=this,a=F,U){if(o===void 0)return f(a);if(p)return clearTimeout(o),o=setTimeout(w,t),h(a)}return o===void 0&&(o=setTimeout(w,t)),c}return J.cancel=W,J.flush=V,J}js.exports=pa});var Xi=Y((zu,Ws)=>{m();var ha=Gs(),ma=Jt(),fa="Expected a function";function ga(r,t,e){var i=!0,s=!0;if(typeof r!="function")throw new TypeError(fa);return ma(e)&&(i="leading"in e?!!e.leading:i,s="trailing"in e?!!e.trailing:s),ha(r,t,{leading:i,maxWait:t,trailing:s})}Ws.exports=ga});var ao=Y((kt,Gr)=>{m();(function(r,t){typeof kt=="object"&&typeof Gr=="object"?Gr.exports=t():typeof define=="function"&&define.amd?define([],t):typeof kt=="object"?kt.bowser=t():r.bowser=t()})(kt,function(){return function(r){var t={};function e(i){if(t[i])return t[i].exports;var s=t[i]={i,l:!1,exports:{}};return r[i].call(s.exports,s,s.exports,e),s.l=!0,s.exports}return e.m=r,e.c=t,e.d=function(i,s,n){e.o(i,s)||Object.defineProperty(i,s,{enumerable:!0,get:n})},e.r=function(i){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},e.t=function(i,s){if(1&s&&(i=e(i)),8&s||4&s&&typeof i=="object"&&i&&i.__esModule)return i;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:i}),2&s&&typeof i!="string")for(var c in i)e.d(n,c,function(o){return i[o]}.bind(null,c));return n},e.n=function(i){var s=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(s,"a",s),s},e.o=function(i,s){return Object.prototype.hasOwnProperty.call(i,s)},e.p="",e(e.s=90)}({17:function(r,t,e){"use strict";t.__esModule=!0,t.default=void 0;var i=e(18),s=function(){function n(){}return n.getFirstMatch=function(c,o){var a=o.match(c);return a&&a.length>0&&a[1]||""},n.getSecondMatch=function(c,o){var a=o.match(c);return a&&a.length>1&&a[2]||""},n.matchAndReturnConst=function(c,o,a){if(c.test(o))return a},n.getWindowsVersionName=function(c){switch(c){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},n.getMacOSVersionName=function(c){var o=c.split(".").splice(0,2).map(function(a){return parseInt(a,10)||0});if(o.push(0),o[0]===10)switch(o[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},n.getAndroidVersionName=function(c){var o=c.split(".").splice(0,2).map(function(a){return parseInt(a,10)||0});if(o.push(0),!(o[0]===1&&o[1]<5))return o[0]===1&&o[1]<6?"Cupcake":o[0]===1&&o[1]>=6?"Donut":o[0]===2&&o[1]<2?"Eclair":o[0]===2&&o[1]===2?"Froyo":o[0]===2&&o[1]>2?"Gingerbread":o[0]===3?"Honeycomb":o[0]===4&&o[1]<1?"Ice Cream Sandwich":o[0]===4&&o[1]<4?"Jelly Bean":o[0]===4&&o[1]>=4?"KitKat":o[0]===5?"Lollipop":o[0]===6?"Marshmallow":o[0]===7?"Nougat":o[0]===8?"Oreo":o[0]===9?"Pie":void 0},n.getVersionPrecision=function(c){return c.split(".").length},n.compareVersions=function(c,o,a){a===void 0&&(a=!1);var l=n.getVersionPrecision(c),u=n.getVersionPrecision(o),p=Math.max(l,u),d=0,h=n.map([c,o],function(f){var v=p-n.getVersionPrecision(f),O=f+new Array(v+1).join(".0");return n.map(O.split("."),function(w){return new Array(20-w.length).join("0")+w}).reverse()});for(a&&(d=p-Math.min(l,u)),p-=1;p>=d;){if(h[0][p]>h[1][p])return 1;if(h[0][p]===h[1][p]){if(p===d)return 0;p-=1}else if(h[0][p]<h[1][p])return-1}},n.map=function(c,o){var a,l=[];if(Array.prototype.map)return Array.prototype.map.call(c,o);for(a=0;a<c.length;a+=1)l.push(o(c[a]));return l},n.find=function(c,o){var a,l;if(Array.prototype.find)return Array.prototype.find.call(c,o);for(a=0,l=c.length;a<l;a+=1){var u=c[a];if(o(u,a))return u}},n.assign=function(c){for(var o,a,l=c,u=arguments.length,p=new Array(u>1?u-1:0),d=1;d<u;d++)p[d-1]=arguments[d];if(Object.assign)return Object.assign.apply(Object,[c].concat(p));var h=function(){var f=p[o];typeof f=="object"&&f!==null&&Object.keys(f).forEach(function(v){l[v]=f[v]})};for(o=0,a=p.length;o<a;o+=1)h();return c},n.getBrowserAlias=function(c){return i.BROWSER_ALIASES_MAP[c]},n.getBrowserTypeByAlias=function(c){return i.BROWSER_MAP[c]||""},n}();t.default=s,r.exports=t.default},18:function(r,t,e){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(r,t,e){"use strict";t.__esModule=!0,t.default=void 0;var i,s=(i=e(91))&&i.__esModule?i:{default:i},n=e(18);function c(a,l){for(var u=0;u<l.length;u++){var p=l[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(a,p.key,p)}}var o=function(){function a(){}var l,u,p;return a.getParser=function(d,h){if(h===void 0&&(h=!1),typeof d!="string")throw new Error("UserAgent should be a string");return new s.default(d,h)},a.parse=function(d){return new s.default(d).getResult()},l=a,p=[{key:"BROWSER_MAP",get:function(){return n.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return n.ENGINE_MAP}},{key:"OS_MAP",get:function(){return n.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return n.PLATFORMS_MAP}}],(u=null)&&c(l.prototype,u),p&&c(l,p),a}();t.default=o,r.exports=t.default},91:function(r,t,e){"use strict";t.__esModule=!0,t.default=void 0;var i=a(e(92)),s=a(e(93)),n=a(e(94)),c=a(e(95)),o=a(e(17));function a(u){return u&&u.__esModule?u:{default:u}}var l=function(){function u(d,h){if(h===void 0&&(h=!1),d==null||d==="")throw new Error("UserAgent parameter can't be empty");this._ua=d,this.parsedResult={},h!==!0&&this.parse()}var p=u.prototype;return p.getUA=function(){return this._ua},p.test=function(d){return d.test(this._ua)},p.parseBrowser=function(){var d=this;this.parsedResult.browser={};var h=o.default.find(i.default,function(f){if(typeof f.test=="function")return f.test(d);if(f.test instanceof Array)return f.test.some(function(v){return d.test(v)});throw new Error("Browser's test function is not valid")});return h&&(this.parsedResult.browser=h.describe(this.getUA())),this.parsedResult.browser},p.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},p.getBrowserName=function(d){return d?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},p.getBrowserVersion=function(){return this.getBrowser().version},p.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},p.parseOS=function(){var d=this;this.parsedResult.os={};var h=o.default.find(s.default,function(f){if(typeof f.test=="function")return f.test(d);if(f.test instanceof Array)return f.test.some(function(v){return d.test(v)});throw new Error("Browser's test function is not valid")});return h&&(this.parsedResult.os=h.describe(this.getUA())),this.parsedResult.os},p.getOSName=function(d){var h=this.getOS().name;return d?String(h).toLowerCase()||"":h||""},p.getOSVersion=function(){return this.getOS().version},p.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},p.getPlatformType=function(d){d===void 0&&(d=!1);var h=this.getPlatform().type;return d?String(h).toLowerCase()||"":h||""},p.parsePlatform=function(){var d=this;this.parsedResult.platform={};var h=o.default.find(n.default,function(f){if(typeof f.test=="function")return f.test(d);if(f.test instanceof Array)return f.test.some(function(v){return d.test(v)});throw new Error("Browser's test function is not valid")});return h&&(this.parsedResult.platform=h.describe(this.getUA())),this.parsedResult.platform},p.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},p.getEngineName=function(d){return d?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},p.parseEngine=function(){var d=this;this.parsedResult.engine={};var h=o.default.find(c.default,function(f){if(typeof f.test=="function")return f.test(d);if(f.test instanceof Array)return f.test.some(function(v){return d.test(v)});throw new Error("Browser's test function is not valid")});return h&&(this.parsedResult.engine=h.describe(this.getUA())),this.parsedResult.engine},p.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},p.getResult=function(){return o.default.assign({},this.parsedResult)},p.satisfies=function(d){var h=this,f={},v=0,O={},w=0;if(Object.keys(d).forEach(function($){var se=d[$];typeof se=="string"?(O[$]=se,w+=1):typeof se=="object"&&(f[$]=se,v+=1)}),v>0){var G=Object.keys(f),W=o.default.find(G,function($){return h.isOS($)});if(W){var V=this.satisfies(f[W]);if(V!==void 0)return V}var J=o.default.find(G,function($){return h.isPlatform($)});if(J){var F=this.satisfies(f[J]);if(F!==void 0)return F}}if(w>0){var U=Object.keys(O),z=o.default.find(U,function($){return h.isBrowser($,!0)});if(z!==void 0)return this.compareVersion(O[z])}},p.isBrowser=function(d,h){h===void 0&&(h=!1);var f=this.getBrowserName().toLowerCase(),v=d.toLowerCase(),O=o.default.getBrowserTypeByAlias(v);return h&&O&&(v=O.toLowerCase()),v===f},p.compareVersion=function(d){var h=[0],f=d,v=!1,O=this.getBrowserVersion();if(typeof O=="string")return d[0]===">"||d[0]==="<"?(f=d.substr(1),d[1]==="="?(v=!0,f=d.substr(2)):h=[],d[0]===">"?h.push(1):h.push(-1)):d[0]==="="?f=d.substr(1):d[0]==="~"&&(v=!0,f=d.substr(1)),h.indexOf(o.default.compareVersions(O,f,v))>-1},p.isOS=function(d){return this.getOSName(!0)===String(d).toLowerCase()},p.isPlatform=function(d){return this.getPlatformType(!0)===String(d).toLowerCase()},p.isEngine=function(d){return this.getEngineName(!0)===String(d).toLowerCase()},p.is=function(d,h){return h===void 0&&(h=!1),this.isBrowser(d,h)||this.isOS(d)||this.isPlatform(d)},p.some=function(d){var h=this;return d===void 0&&(d=[]),d.some(function(f){return h.is(f)})},u}();t.default=l,r.exports=t.default},92:function(r,t,e){"use strict";t.__esModule=!0,t.default=void 0;var i,s=(i=e(17))&&i.__esModule?i:{default:i},n=/version\/(\d+(\.?_?\d+)+)/i,c=[{test:[/googlebot/i],describe:function(o){var a={name:"Googlebot"},l=s.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,o)||s.default.getFirstMatch(n,o);return l&&(a.version=l),a}},{test:[/opera/i],describe:function(o){var a={name:"Opera"},l=s.default.getFirstMatch(n,o)||s.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/opr\/|opios/i],describe:function(o){var a={name:"Opera"},l=s.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,o)||s.default.getFirstMatch(n,o);return l&&(a.version=l),a}},{test:[/SamsungBrowser/i],describe:function(o){var a={name:"Samsung Internet for Android"},l=s.default.getFirstMatch(n,o)||s.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/Whale/i],describe:function(o){var a={name:"NAVER Whale Browser"},l=s.default.getFirstMatch(n,o)||s.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/MZBrowser/i],describe:function(o){var a={name:"MZ Browser"},l=s.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,o)||s.default.getFirstMatch(n,o);return l&&(a.version=l),a}},{test:[/focus/i],describe:function(o){var a={name:"Focus"},l=s.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,o)||s.default.getFirstMatch(n,o);return l&&(a.version=l),a}},{test:[/swing/i],describe:function(o){var a={name:"Swing"},l=s.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,o)||s.default.getFirstMatch(n,o);return l&&(a.version=l),a}},{test:[/coast/i],describe:function(o){var a={name:"Opera Coast"},l=s.default.getFirstMatch(n,o)||s.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(o){var a={name:"Opera Touch"},l=s.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,o)||s.default.getFirstMatch(n,o);return l&&(a.version=l),a}},{test:[/yabrowser/i],describe:function(o){var a={name:"Yandex Browser"},l=s.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,o)||s.default.getFirstMatch(n,o);return l&&(a.version=l),a}},{test:[/ucbrowser/i],describe:function(o){var a={name:"UC Browser"},l=s.default.getFirstMatch(n,o)||s.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/Maxthon|mxios/i],describe:function(o){var a={name:"Maxthon"},l=s.default.getFirstMatch(n,o)||s.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/epiphany/i],describe:function(o){var a={name:"Epiphany"},l=s.default.getFirstMatch(n,o)||s.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/puffin/i],describe:function(o){var a={name:"Puffin"},l=s.default.getFirstMatch(n,o)||s.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/sleipnir/i],describe:function(o){var a={name:"Sleipnir"},l=s.default.getFirstMatch(n,o)||s.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/k-meleon/i],describe:function(o){var a={name:"K-Meleon"},l=s.default.getFirstMatch(n,o)||s.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/micromessenger/i],describe:function(o){var a={name:"WeChat"},l=s.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,o)||s.default.getFirstMatch(n,o);return l&&(a.version=l),a}},{test:[/qqbrowser/i],describe:function(o){var a={name:/qqbrowserlite/i.test(o)?"QQ Browser Lite":"QQ Browser"},l=s.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,o)||s.default.getFirstMatch(n,o);return l&&(a.version=l),a}},{test:[/msie|trident/i],describe:function(o){var a={name:"Internet Explorer"},l=s.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/\sedg\//i],describe:function(o){var a={name:"Microsoft Edge"},l=s.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/edg([ea]|ios)/i],describe:function(o){var a={name:"Microsoft Edge"},l=s.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/vivaldi/i],describe:function(o){var a={name:"Vivaldi"},l=s.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/seamonkey/i],describe:function(o){var a={name:"SeaMonkey"},l=s.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/sailfish/i],describe:function(o){var a={name:"Sailfish"},l=s.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,o);return l&&(a.version=l),a}},{test:[/silk/i],describe:function(o){var a={name:"Amazon Silk"},l=s.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/phantom/i],describe:function(o){var a={name:"PhantomJS"},l=s.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/slimerjs/i],describe:function(o){var a={name:"SlimerJS"},l=s.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(o){var a={name:"BlackBerry"},l=s.default.getFirstMatch(n,o)||s.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/(web|hpw)[o0]s/i],describe:function(o){var a={name:"WebOS Browser"},l=s.default.getFirstMatch(n,o)||s.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/bada/i],describe:function(o){var a={name:"Bada"},l=s.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/tizen/i],describe:function(o){var a={name:"Tizen"},l=s.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,o)||s.default.getFirstMatch(n,o);return l&&(a.version=l),a}},{test:[/qupzilla/i],describe:function(o){var a={name:"QupZilla"},l=s.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,o)||s.default.getFirstMatch(n,o);return l&&(a.version=l),a}},{test:[/firefox|iceweasel|fxios/i],describe:function(o){var a={name:"Firefox"},l=s.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/electron/i],describe:function(o){var a={name:"Electron"},l=s.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/MiuiBrowser/i],describe:function(o){var a={name:"Miui"},l=s.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/chromium/i],describe:function(o){var a={name:"Chromium"},l=s.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,o)||s.default.getFirstMatch(n,o);return l&&(a.version=l),a}},{test:[/chrome|crios|crmo/i],describe:function(o){var a={name:"Chrome"},l=s.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/GSA/i],describe:function(o){var a={name:"Google Search"},l=s.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:function(o){var a=!o.test(/like android/i),l=o.test(/android/i);return a&&l},describe:function(o){var a={name:"Android Browser"},l=s.default.getFirstMatch(n,o);return l&&(a.version=l),a}},{test:[/playstation 4/i],describe:function(o){var a={name:"PlayStation 4"},l=s.default.getFirstMatch(n,o);return l&&(a.version=l),a}},{test:[/safari|applewebkit/i],describe:function(o){var a={name:"Safari"},l=s.default.getFirstMatch(n,o);return l&&(a.version=l),a}},{test:[/.*/i],describe:function(o){var a=o.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:s.default.getFirstMatch(a,o),version:s.default.getSecondMatch(a,o)}}}];t.default=c,r.exports=t.default},93:function(r,t,e){"use strict";t.__esModule=!0,t.default=void 0;var i,s=(i=e(17))&&i.__esModule?i:{default:i},n=e(18),c=[{test:[/Roku\/DVP/],describe:function(o){var a=s.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,o);return{name:n.OS_MAP.Roku,version:a}}},{test:[/windows phone/i],describe:function(o){var a=s.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,o);return{name:n.OS_MAP.WindowsPhone,version:a}}},{test:[/windows /i],describe:function(o){var a=s.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,o),l=s.default.getWindowsVersionName(a);return{name:n.OS_MAP.Windows,version:a,versionName:l}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(o){var a={name:n.OS_MAP.iOS},l=s.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,o);return l&&(a.version=l),a}},{test:[/macintosh/i],describe:function(o){var a=s.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,o).replace(/[_\s]/g,"."),l=s.default.getMacOSVersionName(a),u={name:n.OS_MAP.MacOS,version:a};return l&&(u.versionName=l),u}},{test:[/(ipod|iphone|ipad)/i],describe:function(o){var a=s.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,o).replace(/[_\s]/g,".");return{name:n.OS_MAP.iOS,version:a}}},{test:function(o){var a=!o.test(/like android/i),l=o.test(/android/i);return a&&l},describe:function(o){var a=s.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,o),l=s.default.getAndroidVersionName(a),u={name:n.OS_MAP.Android,version:a};return l&&(u.versionName=l),u}},{test:[/(web|hpw)[o0]s/i],describe:function(o){var a=s.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,o),l={name:n.OS_MAP.WebOS};return a&&a.length&&(l.version=a),l}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(o){var a=s.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,o)||s.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,o)||s.default.getFirstMatch(/\bbb(\d+)/i,o);return{name:n.OS_MAP.BlackBerry,version:a}}},{test:[/bada/i],describe:function(o){var a=s.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,o);return{name:n.OS_MAP.Bada,version:a}}},{test:[/tizen/i],describe:function(o){var a=s.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,o);return{name:n.OS_MAP.Tizen,version:a}}},{test:[/linux/i],describe:function(){return{name:n.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:n.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(o){var a=s.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,o);return{name:n.OS_MAP.PlayStation4,version:a}}}];t.default=c,r.exports=t.default},94:function(r,t,e){"use strict";t.__esModule=!0,t.default=void 0;var i,s=(i=e(17))&&i.__esModule?i:{default:i},n=e(18),c=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(o){var a=s.default.getFirstMatch(/(can-l01)/i,o)&&"Nova",l={type:n.PLATFORMS_MAP.mobile,vendor:"Huawei"};return a&&(l.model=a),l}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:n.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:n.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:n.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:n.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:n.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:n.PLATFORMS_MAP.tablet}}},{test:function(o){var a=o.test(/ipod|iphone/i),l=o.test(/like (ipod|iphone)/i);return a&&!l},describe:function(o){var a=s.default.getFirstMatch(/(ipod|iphone)/i,o);return{type:n.PLATFORMS_MAP.mobile,vendor:"Apple",model:a}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:n.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:n.PLATFORMS_MAP.mobile}}},{test:function(o){return o.getBrowserName(!0)==="blackberry"},describe:function(){return{type:n.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(o){return o.getBrowserName(!0)==="bada"},describe:function(){return{type:n.PLATFORMS_MAP.mobile}}},{test:function(o){return o.getBrowserName()==="windows phone"},describe:function(){return{type:n.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(o){var a=Number(String(o.getOSVersion()).split(".")[0]);return o.getOSName(!0)==="android"&&a>=3},describe:function(){return{type:n.PLATFORMS_MAP.tablet}}},{test:function(o){return o.getOSName(!0)==="android"},describe:function(){return{type:n.PLATFORMS_MAP.mobile}}},{test:function(o){return o.getOSName(!0)==="macos"},describe:function(){return{type:n.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(o){return o.getOSName(!0)==="windows"},describe:function(){return{type:n.PLATFORMS_MAP.desktop}}},{test:function(o){return o.getOSName(!0)==="linux"},describe:function(){return{type:n.PLATFORMS_MAP.desktop}}},{test:function(o){return o.getOSName(!0)==="playstation 4"},describe:function(){return{type:n.PLATFORMS_MAP.tv}}},{test:function(o){return o.getOSName(!0)==="roku"},describe:function(){return{type:n.PLATFORMS_MAP.tv}}}];t.default=c,r.exports=t.default},95:function(r,t,e){"use strict";t.__esModule=!0,t.default=void 0;var i,s=(i=e(17))&&i.__esModule?i:{default:i},n=e(18),c=[{test:function(o){return o.getBrowserName(!0)==="microsoft edge"},describe:function(o){if(/\sedg\//i.test(o))return{name:n.ENGINE_MAP.Blink};var a=s.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,o);return{name:n.ENGINE_MAP.EdgeHTML,version:a}}},{test:[/trident/i],describe:function(o){var a={name:n.ENGINE_MAP.Trident},l=s.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:function(o){return o.test(/presto/i)},describe:function(o){var a={name:n.ENGINE_MAP.Presto},l=s.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:function(o){var a=o.test(/gecko/i),l=o.test(/like gecko/i);return a&&!l},describe:function(o){var a={name:n.ENGINE_MAP.Gecko},l=s.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:n.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(o){var a={name:n.ENGINE_MAP.WebKit},l=s.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,o);return l&&(a.version=l),a}}];t.default=c,r.exports=t.default}})})});m();m();var Ur=pe(Zi());m();var Ji=(w=>(w.svPrimary="sv-primary",w.svPrimary900="sv-primary-900",w.svPrimary200="sv-primary-200",w.svSecondary="sv-secondary",w.svGray="sv-gray",w.svSuccess="sv-success",w.svDanger="sv-danger",w.svBlack="sv-black",w.svWhite="sv-white",w.svGray100="sv-gray-100",w.svGray200="sv-gray-200",w.svGray300="sv-gray-300",w.svGray400="sv-gray-400",w.svGray500="sv-gray-500",w.svGray600="sv-gray-600",w.svGray700="sv-gray-700",w.svGray800="sv-gray-800",w))(Ji||{});m();m();m();m();var Z=(s,n,c,...o)=>S(void 0,[s,n,c,...o],function*(r,t,e,i={}){let a=yield fetch(r,{method:t,headers:y({"Content-Type":"application/json"},i),body:e?JSON.stringify(e):null});if(!a.ok)throw a;try{return yield a.json()}catch(l){return a.ok}});m();var ls=pe(Zi()),N=class{constructor(t){this.debug=(0,ls.default)(t)}log(t,...e){this.debug(t,...e)}};m();m();var Vs=pe(Xi());var j=class{constructor(t={}){this.subscribe=t=>{this.callbacks.push(t)};this.unsubscribe=t=>{this.callbacks=this.callbacks.filter(e=>e!==t)};this.publish=(...t)=>{this.callbacks&&this.callbacks.forEach(e=>{this.callListener(e,t).catch(i=>{var s;(s=this.logger)==null||s.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${e.name}
            Event: ${JSON.stringify(t)}
            Error: ${i}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(t,e)=>new Promise((i,s)=>{try{let n=t(...e);i(n)}catch(n){s(n)}});let{logger:e,throttleTime:i}=t;this.logger=e||new N("@superviz/sdk/observer-helper"),this.throttle=i,this.callbacks=[],this.throttle&&(this.publish=(0,Vs.default)(this.publish,this.throttle))}};var be=class{constructor(){this.observers={};this.subscribe=(t,e)=>{this.logger.log(`subscribed to ${t} event`),this.observers[t]||(this.observers[t]=new j({logger:this.logger})),this.observers[t].subscribe(e)};this.unsubscribe=(t,e)=>{if(this.logger.log(`unsubscribed from ${t} event`),!!this.observers[t]){if(!e){this.observers[t].destroy(),delete this.observers[t];return}this.observers[t].unsubscribe(e)}};this.publish=(t,e)=>{t in this.observers&&this.observers[t].publish(e)}}};m();var H=class{static createUrl(t,e,i={}){let s=new URL(e,t);return Object.keys(i).forEach(n=>s.searchParams.append(n,i[n])),s.toString()}static validateApiKey(t,e){let s=this.createUrl(t,"/user/checkapikey");return Z(s,"POST",{apiKey:e})}static fetchConfig(t,e){let s=this.createUrl(t,"/immersive-config");return Z(s,"POST",{apiKey:e})}static fetchLimits(t,e){return S(this,null,function*(){let s=this.createUrl(t,"/user/check_limits_v2");return(yield Z(s,"GET","",{apikey:e})).limits})}static fetchWaterMark(t,e){return S(this,null,function*(){let s=this.createUrl(t,"/user/watermark"),{message:n}=yield Z(s,"POST",{apiKey:e});return n})}static createAnnotations(t,e,i){return S(this,null,function*(){let n=this.createUrl(t,"/annotations");return Z(n,"POST",y({},i),{apikey:e})})}static updateComment(t,e,i,s){return S(this,null,function*(){let n=`/comments/${i}`,c=this.createUrl(t,n);return Z(c,"PUT",{text:s},{apikey:e})})}static createComment(t,e,i){return S(this,null,function*(){let n=this.createUrl(t,"/comments");return Z(n,"POST",y({},i),{apikey:e})})}static fetchAnnotation(t,e,i){return S(this,null,function*(){let n=this.createUrl(t,"/annotations",{roomId:i.roomId});return Z(n,"GET",void 0,{apikey:e})})}static resolveAnnotation(t,e,i){return S(this,null,function*(){let s=`/annotations/resolve/${i}`,n=this.createUrl(t,s);return Z(n,"POST",{},{apikey:e})})}static deleteComment(t,e,i){return S(this,null,function*(){let s=`/comments/${i}`,n=this.createUrl(t,s);return Z(n,"DELETE",{},{apikey:e})})}static deleteAnnotation(t,e,i){return S(this,null,function*(){let s=`/annotations/${i}`,n=this.createUrl(t,s);return Z(n,"DELETE",{},{apikey:e})})}static createParticipant(t){return S(this,null,function*(){let e=A.get("apiUrl"),s=this.createUrl(e,"/participants");return Z(s,"POST",y({},t),{apikey:A.get("apiKey")})})}static fetchParticipant(t){return S(this,null,function*(){let e=A.get("apiUrl"),i=`/participants/${t}`,s=this.createUrl(e,i);return Z(s,"GET",void 0,{apikey:A.get("apiKey")})})}static sendActivity(t,e,i,s){return S(this,null,function*(){let n="/activity",c=A.get("apiUrl"),o=A.get("roomId"),a=A.get("apiKey"),l=this.createUrl(c,n);return Z(l,"POST",{groupId:e,groupName:i,meetingId:o,product:s,userId:t},{apikey:a})})}static fetchParticipantsByGroup(t){return S(this,null,function*(){let e=`/groups/participants/${t}`,i=A.get("apiUrl"),s=this.createUrl(i,e,{take:1e4});return Z(s,"GET",void 0,{apikey:A.get("apiKey")})})}static createMentions(t){return S(this,null,function*(){let e="/mentions",i=A.get("apiUrl"),s=this.createUrl(i,e);return Z(s,"POST",t,{apikey:A.get("apiKey")})})}};m();function va(r,t){return S(this,null,function*(){try{return(yield H.validateApiKey(r,t))===!0}catch(e){if(e.status===404)return!1;throw new Error("Unable to validate API key")}})}var Hs=va;m();var zs="6.7.1-beta.1";var Re=class{static getRemoteConfig(){return S(this,arguments,function*(t="prod"){if(t==="local")return(yield import("./chunks/.remote-config-W6AJZY5U.js")).default.remoteConfig;let e={version:zs,environment:t},i=this.createUrl(e);return Z(i,"GET",null)})}static getFeatures(t){return S(this,null,function*(){return Z(`${this.REMOTE_CONFIG_BASE_URL}/features/${t}`,"GET",void 0)})}static createUrl({version:t,environment:e}){return`${this.REMOTE_CONFIG_BASE_URL}/sdk/${t}?env=${e}`}};Re.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com";m();m();var Ea=Object.create,yi=Object.defineProperty,Pa=Object.defineProperties,Ca=Object.getOwnPropertyDescriptor,wa=Object.getOwnPropertyDescriptors,Ta=Object.getOwnPropertyNames,$s=Object.getOwnPropertySymbols,_a=Object.getPrototypeOf,pn=Object.prototype.hasOwnProperty,Aa=Object.prototype.propertyIsEnumerable,Zs=(r,t,e)=>t in r?yi(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,g=(r,t)=>{for(var e in t||(t={}))pn.call(t,e)&&Zs(r,e,t[e]);if($s)for(var e of $s(t))Aa.call(t,e)&&Zs(r,e,t[e]);return r},R=(r,t)=>Pa(r,wa(t)),_r=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),Oa=(r,t)=>{for(var e in t)yi(r,e,{get:t[e],enumerable:!0})},Sa=(r,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Ta(t))!pn.call(r,s)&&s!==e&&yi(r,s,{get:()=>t[s],enumerable:!(i=Ca(t,s))||i.enumerable});return r},Ma=(r,t,e)=>(e=r!=null?Ea(_a(r)):{},Sa(t||!r||!r.__esModule?yi(e,"default",{value:r,enumerable:!0}):e,r)),Ee=(r,t,e)=>new Promise((i,s)=>{var n=a=>{try{o(e.next(a))}catch(l){s(l)}},c=a=>{try{o(e.throw(a))}catch(l){s(l)}},o=a=>a.done?i(a.value):Promise.resolve(a.value).then(n,c);o((e=e.apply(r,t)).next())}),La=_r((r,t)=>{var e=1e3,i=e*60,s=i*60,n=s*24,c=n*7,o=n*365.25;t.exports=function(d,h){h=h||{};var f=typeof d;if(f==="string"&&d.length>0)return a(d);if(f==="number"&&isFinite(d))return h.long?u(d):l(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))};function a(d){if(d=String(d),!(d.length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(h){var f=parseFloat(h[1]),v=(h[2]||"ms").toLowerCase();switch(v){case"years":case"year":case"yrs":case"yr":case"y":return f*o;case"weeks":case"week":case"w":return f*c;case"days":case"day":case"d":return f*n;case"hours":case"hour":case"hrs":case"hr":case"h":return f*s;case"minutes":case"minute":case"mins":case"min":case"m":return f*i;case"seconds":case"second":case"secs":case"sec":case"s":return f*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function l(d){var h=Math.abs(d);return h>=n?Math.round(d/n)+"d":h>=s?Math.round(d/s)+"h":h>=i?Math.round(d/i)+"m":h>=e?Math.round(d/e)+"s":d+"ms"}function u(d){var h=Math.abs(d);return h>=n?p(d,h,n,"day"):h>=s?p(d,h,s,"hour"):h>=i?p(d,h,i,"minute"):h>=e?p(d,h,e,"second"):d+" ms"}function p(d,h,f,v){var O=h>=f*1.5;return Math.round(d/f)+" "+v+(O?"s":"")}}),Ra=_r((r,t)=>{function e(i){n.debug=n,n.default=n,n.coerce=p,n.disable=a,n.enable=o,n.enabled=l,n.humanize=La(),n.destroy=d,Object.keys(i).forEach(h=>{n[h]=i[h]}),n.names=[],n.skips=[],n.formatters={};function s(h){let f=0;for(let v=0;v<h.length;v++)f=(f<<5)-f+h.charCodeAt(v),f|=0;return n.colors[Math.abs(f)%n.colors.length]}n.selectColor=s;function n(h){let f,v=null,O,w;function G(...W){if(!G.enabled)return;let V=G,J=Number(new Date),F=J-(f||J);V.diff=F,V.prev=f,V.curr=J,f=J,W[0]=n.coerce(W[0]),typeof W[0]!="string"&&W.unshift("%O");let U=0;W[0]=W[0].replace(/%([a-zA-Z%])/g,(z,$)=>{if(z==="%%")return"%";U++;let se=n.formatters[$];if(typeof se=="function"){let Ce=W[U];z=se.call(V,Ce),W.splice(U,1),U--}return z}),n.formatArgs.call(V,W),(V.log||n.log).apply(V,W)}return G.namespace=h,G.useColors=n.useColors(),G.color=n.selectColor(h),G.extend=c,G.destroy=n.destroy,Object.defineProperty(G,"enabled",{enumerable:!0,configurable:!1,get:()=>v!==null?v:(O!==n.namespaces&&(O=n.namespaces,w=n.enabled(h)),w),set:W=>{v=W}}),typeof n.init=="function"&&n.init(G),G}function c(h,f){let v=n(this.namespace+(typeof f=="undefined"?":":f)+h);return v.log=this.log,v}function o(h){n.save(h),n.namespaces=h,n.names=[],n.skips=[];let f,v=(typeof h=="string"?h:"").split(/[\s,]+/),O=v.length;for(f=0;f<O;f++)v[f]&&(h=v[f].replace(/\*/g,".*?"),h[0]==="-"?n.skips.push(new RegExp("^"+h.slice(1)+"$")):n.names.push(new RegExp("^"+h+"$")))}function a(){let h=[...n.names.map(u),...n.skips.map(u).map(f=>"-"+f)].join(",");return n.enable(""),h}function l(h){if(h[h.length-1]==="*")return!0;let f,v;for(f=0,v=n.skips.length;f<v;f++)if(n.skips[f].test(h))return!1;for(f=0,v=n.names.length;f<v;f++)if(n.names[f].test(h))return!0;return!1}function u(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}function p(h){return h instanceof Error?h.stack||h.message:h}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}t.exports=e}),ka=_r((r,t)=>{r.formatArgs=i,r.save=s,r.load=n,r.useColors=e,r.storage=c(),r.destroy=(()=>{let a=!1;return()=>{a||(a=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){if(typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let a;return typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&(a=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(a[1],10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(a){if(a[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+a[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;let l="color: "+this.color;a.splice(1,0,l,"color: inherit");let u=0,p=0;a[0].replace(/%[a-zA-Z%]/g,d=>{d!=="%%"&&(u++,d==="%c"&&(p=u))}),a.splice(p,0,l)}r.log=console.debug||console.log||(()=>{});function s(a){try{a?r.storage.setItem("debug",a):r.storage.removeItem("debug")}catch(l){}}function n(){let a;try{a=r.storage.getItem("debug")}catch(l){}return!a&&typeof process!="undefined"&&"env"in process&&(a=E.DEBUG),a}function c(){try{return localStorage}catch(a){}}t.exports=Ra()(r);var{formatters:o}=t.exports;o.j=function(a){try{return JSON.stringify(a)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}}),Ia=(r=>(r.JOIN_ROOM="room.join",r.JOINED_ROOM="room.joined",r.LEAVE_ROOM="room.leave",r.UPDATE="room.update",r.ERROR="room.error",r))(Ia||{}),_=(r=>(r.JOINED_ROOM="presence.joined-room",r.LEAVE="presence.leave",r.UPDATE="presence.update",r))(_||{}),Ar=(r=>(r.CONNECTED="CONNECTED",r.CONNECTING="CONNECTING",r.DISCONNECTED="DISCONNECTED",r.CONNECTION_ERROR="CONNECTION_ERROR",r.RECONNECTING="RECONNECTING",r.RECONNECT_ERROR="RECONNECT_ERROR",r))(Ar||{}),ar=function(r,t){return ar=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])},ar(r,t)};function Ei(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");ar(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function cr(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],i=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function oi(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),s,n=[],c;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(o){c={error:o}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(c)throw c.error}}return n}function ai(r,t,e){if(e||arguments.length===2)for(var i=0,s=t.length,n;i<s;i++)(n||!(i in t))&&(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return r.concat(n||Array.prototype.slice.call(t))}function ye(r){return typeof r=="function"}function hn(r){var t=function(i){Error.call(i),i.stack=new Error().stack},e=r(t);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var Qi=hn(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(e,i){return i+1+") "+e.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function lr(r,t){if(r){var e=r.indexOf(t);0<=e&&r.splice(e,1)}}var Pi=function(){function r(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var t,e,i,s,n;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var o=cr(c),a=o.next();!a.done;a=o.next()){var l=a.value;l.remove(this)}}catch(v){t={error:v}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}else c.remove(this);var u=this.initialTeardown;if(ye(u))try{u()}catch(v){n=v instanceof Qi?v.errors:[v]}var p=this._finalizers;if(p){this._finalizers=null;try{for(var d=cr(p),h=d.next();!h.done;h=d.next()){var f=h.value;try{Js(f)}catch(v){n=n!=null?n:[],v instanceof Qi?n=ai(ai([],oi(n)),oi(v.errors)):n.push(v)}}}catch(v){i={error:v}}finally{try{h&&!h.done&&(s=d.return)&&s.call(d)}finally{if(i)throw i.error}}}if(n)throw new Qi(n)}},r.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)Js(t);else{if(t instanceof r){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}},r.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},r.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},r.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&lr(e,t)},r.prototype.remove=function(t){var e=this._finalizers;e&&lr(e,t),t instanceof r&&t._removeParent(this)},r.EMPTY=function(){var t=new r;return t.closed=!0,t}(),r}(),mn=Pi.EMPTY;function fn(r){return r instanceof Pi||r&&"closed"in r&&ye(r.remove)&&ye(r.add)&&ye(r.unsubscribe)}function Js(r){ye(r)?r():r.unsubscribe()}var Ne={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ci={setTimeout:function(r,t){for(var e=[],i=2;i<arguments.length;i++)e[i-2]=arguments[i];var s=ci.delegate;return s!=null&&s.setTimeout?s.setTimeout.apply(s,ai([r,t],oi(e))):setTimeout.apply(void 0,ai([r,t],oi(e)))},clearTimeout:function(r){var t=ci.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(r)},delegate:void 0};function xa(r){ci.setTimeout(function(){var t=Ne.onUnhandledError;if(t)t(r);else throw r})}function qs(){}var Na=function(){return Or("C",void 0,void 0)}();function Fa(r){return Or("E",void 0,r)}function Da(r){return Or("N",r,void 0)}function Or(r,t,e){return{kind:r,value:t,error:e}}var ke=null;function ei(r){if(Ne.useDeprecatedSynchronousErrorHandling){var t=!ke;if(t&&(ke={errorThrown:!1,error:null}),r(),t){var e=ke,i=e.errorThrown,s=e.error;if(ke=null,i)throw s}}else r()}function Ba(r){Ne.useDeprecatedSynchronousErrorHandling&&ke&&(ke.errorThrown=!0,ke.error=r)}var gn=function(r){Ei(t,r);function t(e){var i=r.call(this)||this;return i.isStopped=!1,e?(i.destination=e,fn(e)&&e.add(i)):i.destination=Wa,i}return t.create=function(e,i,s){return new ur(e,i,s)},t.prototype.next=function(e){this.isStopped?tr(Da(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?tr(Fa(e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?tr(Na,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Pi),Ua=Function.prototype.bind;function er(r,t){return Ua.call(r,t)}var ja=function(){function r(t){this.partialObserver=t}return r.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(i){qt(i)}},r.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(i){qt(i)}else qt(t)},r.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){qt(e)}},r}(),ur=function(r){Ei(t,r);function t(e,i,s){var n=r.call(this)||this,c;if(ye(e)||!e)c={next:e!=null?e:void 0,error:i!=null?i:void 0,complete:s!=null?s:void 0};else{var o;n&&Ne.useDeprecatedNextContext?(o=Object.create(e),o.unsubscribe=function(){return n.unsubscribe()},c={next:e.next&&er(e.next,o),error:e.error&&er(e.error,o),complete:e.complete&&er(e.complete,o)}):c=e}return n.destination=new ja(c),n}return t}(gn);function qt(r){Ne.useDeprecatedSynchronousErrorHandling?Ba(r):xa(r)}function Ga(r){throw r}function tr(r,t){var e=Ne.onStoppedNotification;e&&ci.setTimeout(function(){return e(r,t)})}var Wa={closed:!0,next:qs,error:Ga,complete:qs},Va=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Ha(r){return r}function za(r){return r.length===0?Ha:r.length===1?r[0]:function(t){return r.reduce(function(e,i){return i(e)},t)}}var Ks=function(){function r(t){t&&(this._subscribe=t)}return r.prototype.lift=function(t){var e=new r;return e.source=this,e.operator=t,e},r.prototype.subscribe=function(t,e,i){var s=this,n=Za(t)?t:new ur(t,e,i);return ei(function(){var c=s,o=c.operator,a=c.source;n.add(o?o.call(n,a):a?s._subscribe(n):s._trySubscribe(n))}),n},r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},r.prototype.forEach=function(t,e){var i=this;return e=Ys(e),new e(function(s,n){var c=new ur({next:function(o){try{t(o)}catch(a){n(a),c.unsubscribe()}},error:n,complete:s});i.subscribe(c)})},r.prototype._subscribe=function(t){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(t)},r.prototype[Va]=function(){return this},r.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return za(t)(this)},r.prototype.toPromise=function(t){var e=this;return t=Ys(t),new t(function(i,s){var n;e.subscribe(function(c){return n=c},function(c){return s(c)},function(){return i(n)})})},r.create=function(t){return new r(t)},r}();function Ys(r){var t;return(t=r!=null?r:Ne.Promise)!==null&&t!==void 0?t:Promise}function $a(r){return r&&ye(r.next)&&ye(r.error)&&ye(r.complete)}function Za(r){return r&&r instanceof gn||$a(r)&&fn(r)}var Ja=hn(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),he=function(r){Ei(t,r);function t(){var e=r.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype.lift=function(e){var i=new Xs(this,this);return i.operator=e,i},t.prototype._throwIfClosed=function(){if(this.closed)throw new Ja},t.prototype.next=function(e){var i=this;ei(function(){var s,n;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var c=cr(i.currentObservers),o=c.next();!o.done;o=c.next()){var a=o.value;a.next(e)}}catch(l){s={error:l}}finally{try{o&&!o.done&&(n=c.return)&&n.call(c)}finally{if(s)throw s.error}}}})},t.prototype.error=function(e){var i=this;ei(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=e;for(var s=i.observers;s.length;)s.shift().error(e)}})},t.prototype.complete=function(){var e=this;ei(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var i=e.observers;i.length;)i.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(e){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var i=this,s=this,n=s.hasError,c=s.isStopped,o=s.observers;return n||c?mn:(this.currentObservers=null,o.push(e),new Pi(function(){i.currentObservers=null,lr(o,e)}))},t.prototype._checkFinalizedStatuses=function(e){var i=this,s=i.hasError,n=i.thrownError,c=i.isStopped;s?e.error(n):c&&e.complete()},t.prototype.asObservable=function(){var e=new Ks;return e.source=this,e},t.create=function(e,i){return new Xs(e,i)},t}(Ks),Xs=function(r){Ei(t,r);function t(e,i){var s=r.call(this)||this;return s.destination=e,s.source=i,s}return t.prototype.next=function(e){var i,s;(s=(i=this.destination)===null||i===void 0?void 0:i.next)===null||s===void 0||s.call(i,e)},t.prototype.error=function(e){var i,s;(s=(i=this.destination)===null||i===void 0?void 0:i.error)===null||s===void 0||s.call(i,e)},t.prototype.complete=function(){var e,i;(i=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||i===void 0||i.call(e)},t.prototype._subscribe=function(e){var i,s;return(s=(i=this.source)===null||i===void 0?void 0:i.subscribe(e))!==null&&s!==void 0?s:mn},t}(he),Qs=Ma(ka()),Sr=class{constructor(r){this.debug=(0,Qs.default)(r),Qs.default.enable("*")}log(r,...t){this.debug(r,...t)}},qa=class vn{constructor(t,e,i){this.io=t,this.presence=e,this.roomId=i,this.presences=new Set,this.observers=new Map,this.onPresenceJoin=s=>{(s==null?void 0:s.roomId)===this.roomId&&(this.logger.log("presence room @ presence join",s),this.presences.add(s),this.observers.get("presence.joined-room").next({connectionId:s.connectionId,data:s.data,id:s.id,name:s.name,timestamp:s.timestamp}))},this.onPresenceLeave=s=>{(s==null?void 0:s.roomId)===this.roomId&&(this.logger.log("presence room @ presence leave",s),this.presences.delete(s),this.observers.get("presence.leave").next(s))},this.onPresenceUpdate=s=>{(s==null?void 0:s.roomId)===this.roomId&&(this.logger.log("presence room @ presence update",s),this.observers.get("presence.update").next({connectionId:s.connectionId,data:s.data,id:s.id,name:s.name,roomId:s==null?void 0:s.roomId,timestamp:s.timestamp}))},this.logger=new Sr("@superviz/socket-client/presence"),this.registerSubjects(),this.subscribeToPresenceEvents()}static register(t,e,i){return new vn(t,e,i)}get(t,e){let i=new he;i.subscribe({next:t,error:e});let s=n=>{let c=n.presences.map(o=>({connectionId:o.connectionId,data:o.data,id:o.id,name:o.name,timestamp:o.timestamp}));this.logger.log("presence room @ get",n),this.io.off("presence.get",s),i.next(c),i.complete()};this.io.on("presence.get",s),this.io.emit("presence.get",this.roomId)}update(t){let e={connectionId:this.io.id,data:t,id:this.presence.id,name:this.presence.name,timestamp:Date.now()};this.io.emit("presence.update",this.roomId,e),this.logger.log("presence room @ update",this.roomId,e)}destroy(){this.io.off("presence.joined-room",this.onPresenceJoin),this.io.off("presence.leave",this.onPresenceLeave),this.io.off("presence.update",this.onPresenceUpdate),this.observers.forEach(t=>t.unsubscribe()),this.observers.clear()}registerSubjects(){this.observers.set("presence.joined-room",new he),this.observers.set("presence.leave",new he),this.observers.set("presence.update",new he)}on(t,e,i){this.observers.get(t).subscribe({error:i,next:e})}off(t){this.observers.get(t).unsubscribe(),this.observers.delete(t),this.observers.set(t,new he)}subscribeToPresenceEvents(){this.io.on("presence.joined-room",this.onPresenceJoin),this.io.on("presence.leave",this.onPresenceLeave),this.io.on("presence.update",this.onPresenceUpdate)}},fe=Object.create(null);fe.open="0";fe.close="1";fe.ping="2";fe.pong="3";fe.message="4";fe.upgrade="5";fe.noop="6";var ti=Object.create(null);Object.keys(fe).forEach(r=>{ti[fe[r]]=r});var dr={type:"error",data:"parser error"},bn=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",yn=typeof ArrayBuffer=="function",En=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,Mr=({type:r,data:t},e,i)=>bn&&t instanceof Blob?e?i(t):en(t,i):yn&&(t instanceof ArrayBuffer||En(t))?e?i(t):en(new Blob([t]),i):i(fe[r]+(t||"")),en=(r,t)=>{let e=new FileReader;return e.onload=function(){let i=e.result.split(",")[1];t("b"+(i||""))},e.readAsDataURL(r)};function tn(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}var ir;function Ka(r,t){if(bn&&r.data instanceof Blob)return r.data.arrayBuffer().then(tn).then(t);if(yn&&(r.data instanceof ArrayBuffer||En(r.data)))return t(tn(r.data));Mr(r,!1,e=>{ir||(ir=new TextEncoder),t(ir.encode(e))})}var rn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ot=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let r=0;r<rn.length;r++)ot[rn.charCodeAt(r)]=r;var Ya=r=>{let t=r.length*.75,e=r.length,i,s=0,n,c,o,a;r[r.length-1]==="="&&(t--,r[r.length-2]==="="&&t--);let l=new ArrayBuffer(t),u=new Uint8Array(l);for(i=0;i<e;i+=4)n=ot[r.charCodeAt(i)],c=ot[r.charCodeAt(i+1)],o=ot[r.charCodeAt(i+2)],a=ot[r.charCodeAt(i+3)],u[s++]=n<<2|c>>4,u[s++]=(c&15)<<4|o>>2,u[s++]=(o&3)<<6|a&63;return l},Xa=typeof ArrayBuffer=="function",Lr=(r,t)=>{if(typeof r!="string")return{type:"message",data:Pn(r,t)};let e=r.charAt(0);return e==="b"?{type:"message",data:Qa(r.substring(1),t)}:ti[e]?r.length>1?{type:ti[e],data:r.substring(1)}:{type:ti[e]}:dr},Qa=(r,t)=>{if(Xa){let e=Ya(r);return Pn(e,t)}else return{base64:!0,data:r}},Pn=(r,t)=>{switch(t){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},Cn="",ec=(r,t)=>{let e=r.length,i=new Array(e),s=0;r.forEach((n,c)=>{Mr(n,!1,o=>{i[c]=o,++s===e&&t(i.join(Cn))})})},tc=(r,t)=>{let e=r.split(Cn),i=[];for(let s=0;s<e.length;s++){let n=Lr(e[s],t);if(i.push(n),n.type==="error")break}return i};function ic(){return new TransformStream({transform(r,t){Ka(r,e=>{let i=e.length,s;if(i<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,i);else if(i<65536){s=new Uint8Array(3);let n=new DataView(s.buffer);n.setUint8(0,126),n.setUint16(1,i)}else{s=new Uint8Array(9);let n=new DataView(s.buffer);n.setUint8(0,127),n.setBigUint64(1,BigInt(i))}r.data&&typeof r.data!="string"&&(s[0]|=128),t.enqueue(s),t.enqueue(e)})}})}var rr;function Kt(r){return r.reduce((t,e)=>t+e.length,0)}function Yt(r,t){if(r[0].length===t)return r.shift();let e=new Uint8Array(t),i=0;for(let s=0;s<t;s++)e[s]=r[0][i++],i===r[0].length&&(r.shift(),i=0);return r.length&&i<r[0].length&&(r[0]=r[0].slice(i)),e}function rc(r,t){rr||(rr=new TextDecoder);let e=[],i=0,s=-1,n=!1;return new TransformStream({transform(c,o){for(e.push(c);;){if(i===0){if(Kt(e)<1)break;let a=Yt(e,1);n=(a[0]&128)===128,s=a[0]&127,s<126?i=3:s===126?i=1:i=2}else if(i===1){if(Kt(e)<2)break;let a=Yt(e,2);s=new DataView(a.buffer,a.byteOffset,a.length).getUint16(0),i=3}else if(i===2){if(Kt(e)<8)break;let a=Yt(e,8),l=new DataView(a.buffer,a.byteOffset,a.length),u=l.getUint32(0);if(u>Math.pow(2,21)-1){o.enqueue(dr);break}s=u*Math.pow(2,32)+l.getUint32(4),i=3}else{if(Kt(e)<s)break;let a=Yt(e,s);o.enqueue(Lr(n?a:rr.decode(a),t)),i=0}if(s===0||s>r){o.enqueue(dr);break}}}})}var wn=4;function K(r){if(r)return sc(r)}function sc(r){for(var t in K.prototype)r[t]=K.prototype[t];return r}K.prototype.on=K.prototype.addEventListener=function(r,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(t),this};K.prototype.once=function(r,t){function e(){this.off(r,e),t.apply(this,arguments)}return e.fn=t,this.on(r,e),this};K.prototype.off=K.prototype.removeListener=K.prototype.removeAllListeners=K.prototype.removeEventListener=function(r,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var e=this._callbacks["$"+r];if(!e)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var i,s=0;s<e.length;s++)if(i=e[s],i===t||i.fn===t){e.splice(s,1);break}return e.length===0&&delete this._callbacks["$"+r],this};K.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),e=this._callbacks["$"+r],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(e){e=e.slice(0);for(var i=0,s=e.length;i<s;++i)e[i].apply(this,t)}return this};K.prototype.emitReserved=K.prototype.emit;K.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};K.prototype.hasListeners=function(r){return!!this.listeners(r).length};var ne=typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")();function Tn(r,...t){return t.reduce((e,i)=>(r.hasOwnProperty(i)&&(e[i]=r[i]),e),{})}var nc=ne.setTimeout,oc=ne.clearTimeout;function Ci(r,t){t.useNativeTimers?(r.setTimeoutFn=nc.bind(ne),r.clearTimeoutFn=oc.bind(ne)):(r.setTimeoutFn=ne.setTimeout.bind(ne),r.clearTimeoutFn=ne.clearTimeout.bind(ne))}var ac=1.33;function cc(r){return typeof r=="string"?lc(r):Math.ceil((r.byteLength||r.size)*ac)}function lc(r){let t=0,e=0;for(let i=0,s=r.length;i<s;i++)t=r.charCodeAt(i),t<128?e+=1:t<2048?e+=2:t<55296||t>=57344?e+=3:(i++,e+=4);return e}function uc(r){let t="";for(let e in r)r.hasOwnProperty(e)&&(t.length&&(t+="&"),t+=encodeURIComponent(e)+"="+encodeURIComponent(r[e]));return t}function dc(r){let t={},e=r.split("&");for(let i=0,s=e.length;i<s;i++){let n=e[i].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}var pc=class extends Error{constructor(r,t,e){super(r),this.description=t,this.context=e,this.type="TransportError"}},Rr=class extends K{constructor(r){super(),this.writable=!1,Ci(this,r),this.opts=r,this.query=r.query,this.socket=r.socket}onError(r,t,e){return super.emitReserved("error",new pc(r,t,e)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(r){this.readyState==="open"&&this.write(r)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(r){let t=Lr(r,this.socket.binaryType);this.onPacket(t)}onPacket(r){super.emitReserved("packet",r)}onClose(r){this.readyState="closed",super.emitReserved("close",r)}pause(r){}createUri(r,t={}){return r+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){let r=this.opts.hostname;return r.indexOf(":")===-1?r:"["+r+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(r){let t=uc(r);return t.length?"?"+t:""}},_n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),pr=64,hc={},sn=0,Xt=0,nn;function on(r){let t="";do t=_n[r%pr]+t,r=Math.floor(r/pr);while(r>0);return t}function An(){let r=on(+new Date);return r!==nn?(sn=0,nn=r):r+"."+on(sn++)}for(;Xt<pr;Xt++)hc[_n[Xt]]=Xt;var On=!1;try{On=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(r){}var mc=On;function Sn(r){let t=r.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!t||mc))return new XMLHttpRequest}catch(e){}if(!t)try{return new ne[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(e){}}function fc(){}var gc=function(){return new Sn({xdomain:!1}).responseType!=null}(),vc=class extends Rr{constructor(r){if(super(r),this.polling=!1,typeof location!="undefined"){let e=location.protocol==="https:",i=location.port;i||(i=e?"443":"80"),this.xd=typeof location!="undefined"&&r.hostname!==location.hostname||i!==r.port}let t=r&&r.forceBase64;this.supportsBinary=gc&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(r){this.readyState="pausing";let t=()=>{this.readyState="paused",r()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(r){let t=e=>{if(this.readyState==="opening"&&e.type==="open"&&this.onOpen(),e.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)};tc(r,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){let r=()=>{this.write([{type:"close"}])};this.readyState==="open"?r():this.once("open",r)}write(r){this.writable=!1,ec(r,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let r=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=An()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(r,t)}request(r={}){return Object.assign(r,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new We(this.uri(),r)}doWrite(r,t){let e=this.request({method:"POST",data:r});e.on("success",t),e.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){let r=this.request();r.on("data",this.onData.bind(this)),r.on("error",(t,e)=>{this.onError("xhr poll error",t,e)}),this.pollXhr=r}},We=class ii extends K{constructor(t,e){super(),Ci(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.data=e.data!==void 0?e.data:null,this.create()}create(){var t;let e=Tn(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd;let i=this.xhr=new Sn(e);try{i.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let s in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&i.setRequestHeader(s,this.opts.extraHeaders[s])}}catch(s){}if(this.method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}try{i.setRequestHeader("Accept","*/*")}catch(s){}(t=this.opts.cookieJar)===null||t===void 0||t.addCookies(i),"withCredentials"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=()=>{var s;i.readyState===3&&((s=this.opts.cookieJar)===null||s===void 0||s.parseCookies(i)),i.readyState===4&&(i.status===200||i.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof i.status=="number"?i.status:0)},0))},i.send(this.data)}catch(s){this.setTimeoutFn(()=>{this.onError(s)},0);return}typeof document!="undefined"&&(this.index=ii.requestsCount++,ii.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=fc,t)try{this.xhr.abort()}catch(e){}typeof document!="undefined"&&delete ii.requests[this.index],this.xhr=null}}onLoad(){let t=this.xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};We.requestsCount=0;We.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",an);else if(typeof addEventListener=="function"){let r="onpagehide"in ne?"pagehide":"unload";addEventListener(r,an,!1)}}function an(){for(let r in We.requests)We.requests.hasOwnProperty(r)&&We.requests[r].abort()}var kr=typeof Promise=="function"&&typeof Promise.resolve=="function"?r=>Promise.resolve().then(r):(r,t)=>t(r,0),Qt=ne.WebSocket||ne.MozWebSocket,sr=!0,bc="arraybuffer",cn=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",yc=class extends Rr{constructor(r){super(r),this.supportsBinary=!r.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let r=this.uri(),t=this.opts.protocols,e=cn?{}:Tn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(e.headers=this.opts.extraHeaders);try{this.ws=sr&&!cn?t?new Qt(r,t):new Qt(r):new Qt(r,t,e)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=r=>this.onClose({description:"websocket connection closed",context:r}),this.ws.onmessage=r=>this.onData(r.data),this.ws.onerror=r=>this.onError("websocket error",r)}write(r){this.writable=!1;for(let t=0;t<r.length;t++){let e=r[t],i=t===r.length-1;Mr(e,this.supportsBinary,s=>{let n={};sr||(e.options&&(n.compress=e.options.compress),this.opts.perMessageDeflate&&(typeof s=="string"?Buffer.byteLength(s):s.length)<this.opts.perMessageDeflate.threshold&&(n.compress=!1));try{sr?this.ws.send(s):this.ws.send(s,n)}catch(c){}i&&kr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let r=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=An()),this.supportsBinary||(t.b64=1),this.createUri(r,t)}check(){return!!Qt}},Ec=class extends Rr{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(r=>{this.onError("webtransport error",r)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(r=>{let t=rc(Number.MAX_SAFE_INTEGER,this.socket.binaryType),e=r.readable.pipeThrough(t).getReader(),i=ic();i.readable.pipeTo(r.writable),this.writer=i.writable.getWriter();let s=()=>{e.read().then(({done:c,value:o})=>{c||(this.onPacket(o),s())}).catch(c=>{})};s();let n={type:"open"};this.query.sid&&(n.data=`{"sid":"${this.query.sid}"}`),this.writer.write(n).then(()=>this.onOpen())})}))}write(r){this.writable=!1;for(let t=0;t<r.length;t++){let e=r[t],i=t===r.length-1;this.writer.write(e).then(()=>{i&&kr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var r;(r=this.transport)===null||r===void 0||r.close()}},Pc={websocket:yc,webtransport:Ec,polling:vc},Cc=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,wc=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function hr(r){if(r.length>2e3)throw"URI too long";let t=r,e=r.indexOf("["),i=r.indexOf("]");e!=-1&&i!=-1&&(r=r.substring(0,e)+r.substring(e,i).replace(/:/g,";")+r.substring(i,r.length));let s=Cc.exec(r||""),n={},c=14;for(;c--;)n[wc[c]]=s[c]||"";return e!=-1&&i!=-1&&(n.source=t,n.host=n.host.substring(1,n.host.length-1).replace(/;/g,":"),n.authority=n.authority.replace("[","").replace("]","").replace(/;/g,":"),n.ipv6uri=!0),n.pathNames=Tc(n,n.path),n.queryKey=_c(n,n.query),n}function Tc(r,t){let e=/\/{2,9}/g,i=t.replace(e,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&i.splice(0,1),t.slice(-1)=="/"&&i.splice(i.length-1,1),i}function _c(r,t){let e={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,s,n){s&&(e[s]=n)}),e}var Ir=class je extends K{constructor(t,e={}){super(),this.binaryType=bc,this.writeBuffer=[],t&&typeof t=="object"&&(e=t,t=null),t?(t=hr(t),e.hostname=t.host,e.secure=t.protocol==="https"||t.protocol==="wss",e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=hr(e.host).host),Ci(this,e),this.secure=e.secure!=null?e.secure:typeof location!="undefined"&&location.protocol==="https:",e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=e.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=dc(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){let e=Object.assign({},this.opts.query);e.EIO=wn,e.transport=t,this.id&&(e.sid=this.id);let i=Object.assign({},this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new Pc[t](i)}open(){let t;if(this.opts.rememberUpgrade&&je.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch(e){this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",e=>this.onClose("transport close",e))}probe(t){let e=this.createTransport(t),i=!1;je.priorWebsocketSuccess=!1;let s=()=>{i||(e.send([{type:"ping",data:"probe"}]),e.once("packet",p=>{if(!i)if(p.type==="pong"&&p.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;je.priorWebsocketSuccess=e.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(u(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())})}else{let d=new Error("probe error");d.transport=e.name,this.emitReserved("upgradeError",d)}}))};function n(){i||(i=!0,u(),e.close(),e=null)}let c=p=>{let d=new Error("probe error: "+p);d.transport=e.name,n(),this.emitReserved("upgradeError",d)};function o(){c("transport closed")}function a(){c("socket closed")}function l(p){e&&p.name!==e.name&&n()}let u=()=>{e.removeListener("open",s),e.removeListener("error",c),e.removeListener("close",o),this.off("close",a),this.off("upgrading",l)};e.once("open",s),e.once("error",c),e.once("close",o),this.once("close",a),this.once("upgrading",l),this.upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{i||e.open()},200):e.open()}onOpen(){if(this.readyState="open",je.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let t=0,e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),this.resetPingTimeout(),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let e=0;e<this.writeBuffer.length;e++){let i=this.writeBuffer[e].data;if(i&&(t+=cc(i)),e>0&&t>this.maxPayload)return this.writeBuffer.slice(0,e);t+=2}return this.writeBuffer}write(t,e,i){return this.sendPacket("message",t,e,i),this}send(t,e,i){return this.sendPacket("message",t,e,i),this}sendPacket(t,e,i,s){if(typeof e=="function"&&(s=e,e=void 0),typeof i=="function"&&(s=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;let n={type:t,data:e,options:i};this.emitReserved("packetCreate",n),this.writeBuffer.push(n),s&&this.once("flush",s),this.flush()}close(){let t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},i=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():t()}):this.upgrading?i():t()),this}onError(t){je.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,e){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){let e=[],i=0,s=t.length;for(;i<s;i++)~this.transports.indexOf(t[i])&&e.push(t[i]);return e}};Ir.protocol=wn;var _d=Ir.protocol;function Ac(r,t="",e){let i=r;e=e||typeof location!="undefined"&&location,r==null&&(r=e.protocol+"//"+e.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=e.protocol+r:r=e.host+r),/^(https?|wss?):\/\//.test(r)||(typeof e!="undefined"?r=e.protocol+"//"+r:r="https://"+r),i=hr(r)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";let s=i.host.indexOf(":")!==-1?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+s+":"+i.port+t,i.href=i.protocol+"://"+s+(e&&e.port===i.port?"":":"+i.port),i}var Mn={};Oa(Mn,{Decoder:()=>Fc,Encoder:()=>Nc,PacketType:()=>D,protocol:()=>xc});var Oc=typeof ArrayBuffer=="function",Sc=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,Ln=Object.prototype.toString,Mc=typeof Blob=="function"||typeof Blob!="undefined"&&Ln.call(Blob)==="[object BlobConstructor]",Lc=typeof File=="function"||typeof File!="undefined"&&Ln.call(File)==="[object FileConstructor]";function xr(r){return Oc&&(r instanceof ArrayBuffer||Sc(r))||Mc&&r instanceof Blob||Lc&&r instanceof File}function ri(r,t){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let e=0,i=r.length;e<i;e++)if(ri(r[e]))return!0;return!1}if(xr(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return ri(r.toJSON(),!0);for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e)&&ri(r[e]))return!0;return!1}function Rc(r){let t=[],e=r.data,i=r;return i.data=mr(e,t),i.attachments=t.length,{packet:i,buffers:t}}function mr(r,t){if(!r)return r;if(xr(r)){let e={_placeholder:!0,num:t.length};return t.push(r),e}else if(Array.isArray(r)){let e=new Array(r.length);for(let i=0;i<r.length;i++)e[i]=mr(r[i],t);return e}else if(typeof r=="object"&&!(r instanceof Date)){let e={};for(let i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=mr(r[i],t));return e}return r}function kc(r,t){return r.data=fr(r.data,t),delete r.attachments,r}function fr(r,t){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<t.length)return t[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let e=0;e<r.length;e++)r[e]=fr(r[e],t);else if(typeof r=="object")for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&(r[e]=fr(r[e],t));return r}var Ic=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],xc=5,D;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(D||(D={}));var Nc=class{constructor(r){this.replacer=r}encode(r){return(r.type===D.EVENT||r.type===D.ACK)&&ri(r)?this.encodeAsBinary({type:r.type===D.EVENT?D.BINARY_EVENT:D.BINARY_ACK,nsp:r.nsp,data:r.data,id:r.id}):[this.encodeAsString(r)]}encodeAsString(r){let t=""+r.type;return(r.type===D.BINARY_EVENT||r.type===D.BINARY_ACK)&&(t+=r.attachments+"-"),r.nsp&&r.nsp!=="/"&&(t+=r.nsp+","),r.id!=null&&(t+=r.id),r.data!=null&&(t+=JSON.stringify(r.data,this.replacer)),t}encodeAsBinary(r){let t=Rc(r),e=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(e),i}};function ln(r){return Object.prototype.toString.call(r)==="[object Object]"}var Fc=class Rn extends K{constructor(t){super(),this.reviver=t}add(t){let e;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);let i=e.type===D.BINARY_EVENT;i||e.type===D.BINARY_ACK?(e.type=i?D.EVENT:D.ACK,this.reconstructor=new Dc(e),e.attachments===0&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else if(xr(t)||t.base64)if(this.reconstructor)e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let e=0,i={type:Number(t.charAt(0))};if(D[i.type]===void 0)throw new Error("unknown packet type "+i.type);if(i.type===D.BINARY_EVENT||i.type===D.BINARY_ACK){let n=e+1;for(;t.charAt(++e)!=="-"&&e!=t.length;);let c=t.substring(n,e);if(c!=Number(c)||t.charAt(e)!=="-")throw new Error("Illegal attachments");i.attachments=Number(c)}if(t.charAt(e+1)==="/"){let n=e+1;for(;++e&&!(t.charAt(e)===","||e===t.length););i.nsp=t.substring(n,e)}else i.nsp="/";let s=t.charAt(e+1);if(s!==""&&Number(s)==s){let n=e+1;for(;++e;){let c=t.charAt(e);if(c==null||Number(c)!=c){--e;break}if(e===t.length)break}i.id=Number(t.substring(n,e+1))}if(t.charAt(++e)){let n=this.tryParse(t.substr(e));if(Rn.isPayloadValid(i.type,n))i.data=n;else throw new Error("invalid payload")}return i}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(e){return!1}}static isPayloadValid(t,e){switch(t){case D.CONNECT:return ln(e);case D.DISCONNECT:return e===void 0;case D.CONNECT_ERROR:return typeof e=="string"||ln(e);case D.EVENT:case D.BINARY_EVENT:return Array.isArray(e)&&(typeof e[0]=="number"||typeof e[0]=="string"&&Ic.indexOf(e[0])===-1);case D.ACK:case D.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},Dc=class{constructor(r){this.packet=r,this.buffers=[],this.reconPack=r}takeBinaryData(r){if(this.buffers.push(r),this.buffers.length===this.reconPack.attachments){let t=kc(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function le(r,t,e){return r.on(t,e),function(){r.off(t,e)}}var Bc=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),kn=class extends K{constructor(r,t,e){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=r,this.nsp=t,e&&e.auth&&(this.auth=e.auth),this._opts=Object.assign({},e),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let r=this.io;this.subs=[le(r,"open",this.onopen.bind(this)),le(r,"packet",this.onpacket.bind(this)),le(r,"error",this.onerror.bind(this)),le(r,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...r){return r.unshift("message"),this.emit.apply(this,r),this}emit(r,...t){if(Bc.hasOwnProperty(r))throw new Error('"'+r.toString()+'" is a reserved event name');if(t.unshift(r),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let e={type:D.EVENT,data:t};if(e.options={},e.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){let s=this.ids++,n=t.pop();this._registerAckCallback(s,n),e.id=s}let i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(e),this.packet(e)):this.sendBuffer.push(e)),this.flags={},this}_registerAckCallback(r,t){var e;let i=(e=this.flags.timeout)!==null&&e!==void 0?e:this._opts.ackTimeout;if(i===void 0){this.acks[r]=t;return}let s=this.io.setTimeoutFn(()=>{delete this.acks[r];for(let c=0;c<this.sendBuffer.length;c++)this.sendBuffer[c].id===r&&this.sendBuffer.splice(c,1);t.call(this,new Error("operation has timed out"))},i),n=(...c)=>{this.io.clearTimeoutFn(s),t.apply(this,c)};n.withError=!0,this.acks[r]=n}emitWithAck(r,...t){return new Promise((e,i)=>{let s=(n,c)=>n?i(n):e(c);s.withError=!0,t.push(s),this.emit(r,...t)})}_addToQueue(r){let t;typeof r[r.length-1]=="function"&&(t=r.pop());let e={id:this._queueSeq++,tryCount:0,pending:!1,args:r,flags:Object.assign({fromQueue:!0},this.flags)};r.push((i,...s)=>e!==this._queue[0]?void 0:(i!==null?e.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),e.pending=!1,this._drainQueue())),this._queue.push(e),this._drainQueue()}_drainQueue(r=!1){if(!this.connected||this._queue.length===0)return;let t=this._queue[0];t.pending&&!r||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(r){r.nsp=this.nsp,this.io._packet(r)}onopen(){typeof this.auth=="function"?this.auth(r=>{this._sendConnectPacket(r)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(r){this.packet({type:D.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},r):r})}onerror(r){this.connected||this.emitReserved("connect_error",r)}onclose(r,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",r,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(r=>{if(!this.sendBuffer.some(t=>String(t.id)===r)){let t=this.acks[r];delete this.acks[r],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(r){if(r.nsp===this.nsp)switch(r.type){case D.CONNECT:r.data&&r.data.sid?this.onconnect(r.data.sid,r.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case D.EVENT:case D.BINARY_EVENT:this.onevent(r);break;case D.ACK:case D.BINARY_ACK:this.onack(r);break;case D.DISCONNECT:this.ondisconnect();break;case D.CONNECT_ERROR:this.destroy();let t=new Error(r.data.message);t.data=r.data.data,this.emitReserved("connect_error",t);break}}onevent(r){let t=r.data||[];r.id!=null&&t.push(this.ack(r.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(r){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let e of t)e.apply(this,r)}super.emit.apply(this,r),this._pid&&r.length&&typeof r[r.length-1]=="string"&&(this._lastOffset=r[r.length-1])}ack(r){let t=this,e=!1;return function(...i){e||(e=!0,t.packet({type:D.ACK,id:r,data:i}))}}onack(r){let t=this.acks[r.id];typeof t=="function"&&(delete this.acks[r.id],t.withError&&r.data.unshift(null),t.apply(this,r.data))}onconnect(r,t){this.id=r,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(r=>this.emitEvent(r)),this.receiveBuffer=[],this.sendBuffer.forEach(r=>{this.notifyOutgoingListeners(r),this.packet(r)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(r=>r()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:D.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(r){return this.flags.compress=r,this}get volatile(){return this.flags.volatile=!0,this}timeout(r){return this.flags.timeout=r,this}onAny(r){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(r),this}prependAny(r){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(r),this}offAny(r){if(!this._anyListeners)return this;if(r){let t=this._anyListeners;for(let e=0;e<t.length;e++)if(r===t[e])return t.splice(e,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(r){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(r),this}prependAnyOutgoing(r){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(r),this}offAnyOutgoing(r){if(!this._anyOutgoingListeners)return this;if(r){let t=this._anyOutgoingListeners;for(let e=0;e<t.length;e++)if(r===t[e])return t.splice(e,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(r){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let e of t)e.apply(this,r.data)}}};function Ze(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Ze.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),e=Math.floor(t*this.jitter*r);r=Math.floor(t*10)&1?r+e:r-e}return Math.min(r,this.max)|0};Ze.prototype.reset=function(){this.attempts=0};Ze.prototype.setMin=function(r){this.ms=r};Ze.prototype.setMax=function(r){this.max=r};Ze.prototype.setJitter=function(r){this.jitter=r};var li=class extends K{constructor(r,t){var e;super(),this.nsps={},this.subs=[],r&&typeof r=="object"&&(t=r,r=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Ci(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((e=t.randomizationFactor)!==null&&e!==void 0?e:.5),this.backoff=new Ze({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=r;let i=t.parser||Mn;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(r){return arguments.length?(this._reconnection=!!r,this):this._reconnection}reconnectionAttempts(r){return r===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=r,this)}reconnectionDelay(r){var t;return r===void 0?this._reconnectionDelay:(this._reconnectionDelay=r,(t=this.backoff)===null||t===void 0||t.setMin(r),this)}randomizationFactor(r){var t;return r===void 0?this._randomizationFactor:(this._randomizationFactor=r,(t=this.backoff)===null||t===void 0||t.setJitter(r),this)}reconnectionDelayMax(r){var t;return r===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=r,(t=this.backoff)===null||t===void 0||t.setMax(r),this)}timeout(r){return arguments.length?(this._timeout=r,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(r){if(~this._readyState.indexOf("open"))return this;this.engine=new Ir(this.uri,this.opts);let t=this.engine,e=this;this._readyState="opening",this.skipReconnect=!1;let i=le(t,"open",function(){e.onopen(),r&&r()}),s=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),r?r(c):this.maybeReconnectOnOpen()},n=le(t,"error",s);if(this._timeout!==!1){let c=this._timeout,o=this.setTimeoutFn(()=>{i(),s(new Error("timeout")),t.close()},c);this.opts.autoUnref&&o.unref(),this.subs.push(()=>{this.clearTimeoutFn(o)})}return this.subs.push(i),this.subs.push(n),this}connect(r){return this.open(r)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let r=this.engine;this.subs.push(le(r,"ping",this.onping.bind(this)),le(r,"data",this.ondata.bind(this)),le(r,"error",this.onerror.bind(this)),le(r,"close",this.onclose.bind(this)),le(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(r){try{this.decoder.add(r)}catch(t){this.onclose("parse error",t)}}ondecoded(r){kr(()=>{this.emitReserved("packet",r)},this.setTimeoutFn)}onerror(r){this.emitReserved("error",r)}socket(r,t){let e=this.nsps[r];return e?this._autoConnect&&!e.active&&e.connect():(e=new kn(this,r,t),this.nsps[r]=e),e}_destroy(r){let t=Object.keys(this.nsps);for(let e of t)if(this.nsps[e].active)return;this._close()}_packet(r){let t=this.encoder.encode(r);for(let e=0;e<t.length;e++)this.engine.write(t[e],r.options)}cleanup(){this.subs.forEach(r=>r()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(r,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",r,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let r=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();this._reconnecting=!0;let e=this.setTimeoutFn(()=>{r.skipReconnect||(this.emitReserved("reconnect_attempt",r.backoff.attempts),!r.skipReconnect&&r.open(i=>{i?(r._reconnecting=!1,r.reconnect(),this.emitReserved("reconnect_error",i)):r.onreconnect()}))},t);this.opts.autoUnref&&e.unref(),this.subs.push(()=>{this.clearTimeoutFn(e)})}}onreconnect(){let r=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",r)}},nt={};function nr(r,t){typeof r=="object"&&(t=r,r=void 0),t=t||{};let e=Ac(r,t.path||"/socket.io"),i=e.source,s=e.id,n=e.path,c=nt[s]&&n in nt[s].nsps,o=t.forceNew||t["force new connection"]||t.multiplex===!1||c,a;return o?a=new li(i,t):(nt[s]||(nt[s]=new li(i,t)),a=nt[s]),e.query&&!t.query&&(t.query=e.queryKey),a.socket(e.path,t)}Object.assign(nr,{Manager:li,Socket:kn,io:nr,connect:nr});var B;(function(r){r.assertEqual=s=>s;function t(s){}r.assertIs=t;function e(s){throw new Error}r.assertNever=e,r.arrayToEnum=s=>{let n={};for(let c of s)n[c]=c;return n},r.getValidEnumValues=s=>{let n=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),c={};for(let o of n)c[o]=s[o];return r.objectValues(c)},r.objectValues=s=>r.objectKeys(s).map(function(n){return s[n]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let n=[];for(let c in s)Object.prototype.hasOwnProperty.call(s,c)&&n.push(c);return n},r.find=(s,n)=>{for(let c of s)if(n(c))return c},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function i(s,n=" | "){return s.map(c=>typeof c=="string"?`'${c}'`:c).join(n)}r.joinValues=i,r.jsonStringifyReplacer=(s,n)=>typeof n=="bigint"?n.toString():n})(B||(B={}));var gr;(function(r){r.mergeShapes=(t,e)=>g(g({},t),e)})(gr||(gr={}));var C=B.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Te=r=>{switch(typeof r){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(r)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(r)?C.array:r===null?C.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?C.promise:typeof Map!="undefined"&&r instanceof Map?C.map:typeof Set!="undefined"&&r instanceof Set?C.set:typeof Date!="undefined"&&r instanceof Date?C.date:C.object;default:return C.unknown}},b=B.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Uc=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),ue=class In extends Error{constructor(t){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};let e=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,e):this.__proto__=e,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){let e=t||function(n){return n.message},i={_errors:[]},s=n=>{for(let c of n.issues)if(c.code==="invalid_union")c.unionErrors.map(s);else if(c.code==="invalid_return_type")s(c.returnTypeError);else if(c.code==="invalid_arguments")s(c.argumentsError);else if(c.path.length===0)i._errors.push(e(c));else{let o=i,a=0;for(;a<c.path.length;){let l=c.path[a];a===c.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(e(c))):o[l]=o[l]||{_errors:[]},o=o[l],a++}}};return s(this),i}static assert(t){if(!(t instanceof In))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,B.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=e=>e.message){let e={},i=[];for(let s of this.issues)s.path.length>0?(e[s.path[0]]=e[s.path[0]]||[],e[s.path[0]].push(t(s))):i.push(t(s));return{formErrors:i,fieldErrors:e}}get formErrors(){return this.flatten()}};ue.create=r=>new ue(r);var Ve=(r,t)=>{let e;switch(r.code){case b.invalid_type:r.received===C.undefined?e="Required":e=`Expected ${r.expected}, received ${r.received}`;break;case b.invalid_literal:e=`Invalid literal value, expected ${JSON.stringify(r.expected,B.jsonStringifyReplacer)}`;break;case b.unrecognized_keys:e=`Unrecognized key(s) in object: ${B.joinValues(r.keys,", ")}`;break;case b.invalid_union:e="Invalid input";break;case b.invalid_union_discriminator:e=`Invalid discriminator value. Expected ${B.joinValues(r.options)}`;break;case b.invalid_enum_value:e=`Invalid enum value. Expected ${B.joinValues(r.options)}, received '${r.received}'`;break;case b.invalid_arguments:e="Invalid function arguments";break;case b.invalid_return_type:e="Invalid function return type";break;case b.invalid_date:e="Invalid date";break;case b.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(e=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(e=`${e} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?e=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?e=`Invalid input: must end with "${r.validation.endsWith}"`:B.assertNever(r.validation):r.validation!=="regex"?e=`Invalid ${r.validation}`:e="Invalid";break;case b.too_small:r.type==="array"?e=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?e=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?e=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?e=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:e="Invalid input";break;case b.too_big:r.type==="array"?e=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?e=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?e=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?e=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?e=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:e="Invalid input";break;case b.custom:e="Invalid input";break;case b.invalid_intersection_types:e="Intersection results could not be merged";break;case b.not_multiple_of:e=`Number must be a multiple of ${r.multipleOf}`;break;case b.not_finite:e="Number must be finite";break;default:e=t.defaultError,B.assertNever(r)}return{message:e}},xn=Ve;function jc(r){xn=r}function ui(){return xn}var di=r=>{let{data:t,path:e,errorMaps:i,issueData:s}=r,n=[...e,...s.path||[]],c=R(g({},s),{path:n});if(s.message!==void 0)return R(g({},s),{path:n,message:s.message});let o="",a=i.filter(l=>!!l).slice().reverse();for(let l of a)o=l(c,{data:t,defaultError:o}).message;return R(g({},s),{path:n,message:o})},Gc=[];function P(r,t){let e=ui(),i=di({issueData:t,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,e,e===Ve?void 0:Ve].filter(s=>!!s)});r.common.issues.push(i)}var ie=class Nn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,e){let i=[];for(let s of e){if(s.status==="aborted")return k;s.status==="dirty"&&t.dirty(),i.push(s.value)}return{status:t.value,value:i}}static mergeObjectAsync(t,e){return Ee(this,null,function*(){let i=[];for(let s of e){let n=yield s.key,c=yield s.value;i.push({key:n,value:c})}return Nn.mergeObjectSync(t,i)})}static mergeObjectSync(t,e){let i={};for(let s of e){let{key:n,value:c}=s;if(n.status==="aborted"||c.status==="aborted")return k;n.status==="dirty"&&t.dirty(),c.status==="dirty"&&t.dirty(),n.value!=="__proto__"&&(typeof c.value!="undefined"||s.alwaysSet)&&(i[n.value]=c.value)}return{status:t.value,value:i}}},k=Object.freeze({status:"aborted"}),pi=r=>({status:"dirty",value:r}),ee=r=>({status:"valid",value:r}),vr=r=>r.status==="aborted",br=r=>r.status==="dirty",ut=r=>r.status==="valid",dt=r=>typeof Promise!="undefined"&&r instanceof Promise;function hi(r,t,e,i){if(e==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?r!==t||!i:!t.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?i:e==="a"?i.call(r):i?i.value:t.get(r)}function Fn(r,t,e,i,s){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?r!==t||!s:!t.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?s.call(r,e):s?s.value=e:t.set(r,e),e}var T;(function(r){r.errToObj=t=>typeof t=="string"?{message:t}:t||{},r.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(T||(T={}));var at,ct,ge=class{constructor(r,t,e,i){this._cachedPath=[],this.parent=r,this.data=t,this._path=e,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},un=(r,t)=>{if(ut(t))return{success:!0,data:t.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let e=new ue(r.common.issues);return this._error=e,this._error}}};function I(r){if(!r)return{};let{errorMap:t,invalid_type_error:e,required_error:i,description:s}=r;if(t&&(e||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:s}:{errorMap:(n,c)=>{var o,a;let{message:l}=r;return n.code==="invalid_enum_value"?{message:l!=null?l:c.defaultError}:typeof c.data=="undefined"?{message:(o=l!=null?l:i)!==null&&o!==void 0?o:c.defaultError}:n.code!=="invalid_type"?{message:c.defaultError}:{message:(a=l!=null?l:e)!==null&&a!==void 0?a:c.defaultError}},description:s}}var x=class{constructor(r){this.spa=this.safeParseAsync,this._def=r,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(r){return Te(r.data)}_getOrReturnCtx(r,t){return t||{common:r.parent.common,data:r.data,parsedType:Te(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}_processInputParams(r){return{status:new ie,ctx:{common:r.parent.common,data:r.data,parsedType:Te(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}}_parseSync(r){let t=this._parse(r);if(dt(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(r){let t=this._parse(r);return Promise.resolve(t)}parse(r,t){let e=this.safeParse(r,t);if(e.success)return e.data;throw e.error}safeParse(r,t){var e;let i={common:{issues:[],async:(e=t==null?void 0:t.async)!==null&&e!==void 0?e:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:Te(r)},s=this._parseSync({data:r,path:i.path,parent:i});return un(i,s)}parseAsync(r,t){return Ee(this,null,function*(){let e=yield this.safeParseAsync(r,t);if(e.success)return e.data;throw e.error})}safeParseAsync(r,t){return Ee(this,null,function*(){let e={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:Te(r)},i=this._parse({data:r,path:e.path,parent:e}),s=yield dt(i)?i:Promise.resolve(i);return un(e,s)})}refine(r,t){let e=i=>typeof t=="string"||typeof t=="undefined"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,s)=>{let n=r(i),c=()=>s.addIssue(g({code:b.custom},e(i)));return typeof Promise!="undefined"&&n instanceof Promise?n.then(o=>o?!0:(c(),!1)):n?!0:(c(),!1)})}refinement(r,t){return this._refinement((e,i)=>r(e)?!0:(i.addIssue(typeof t=="function"?t(e,i):t),!1))}_refinement(r){return new de({schema:this,typeName:M.ZodEffects,effect:{type:"refinement",refinement:r}})}superRefine(r){return this._refinement(r)}optional(){return me.create(this,this._def)}nullable(){return Ae.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return xe.create(this,this._def)}promise(){return $e.create(this,this._def)}or(r){return bt.create([this,r],this._def)}and(r){return yt.create(this,r,this._def)}transform(r){return new de(R(g({},I(this._def)),{schema:this,typeName:M.ZodEffects,effect:{type:"transform",transform:r}}))}default(r){let t=typeof r=="function"?r:()=>r;return new wt(R(g({},I(this._def)),{innerType:this,defaultValue:t,typeName:M.ZodDefault}))}brand(){return new Nr(g({typeName:M.ZodBranded,type:this},I(this._def)))}catch(r){let t=typeof r=="function"?r:()=>r;return new Tt(R(g({},I(this._def)),{innerType:this,catchValue:t,typeName:M.ZodCatch}))}describe(r){let t=this.constructor;return new t(R(g({},this._def),{description:r}))}pipe(r){return Fr.create(this,r)}readonly(){return _t.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Wc=/^c[^\s-]{8,}$/i,Vc=/^[0-9a-z]+$/,Hc=/^[0-9A-HJKMNP-TV-Z]{26}$/,zc=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,$c=/^[a-z0-9_-]{21}$/i,Zc=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Jc=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,qc="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",or,Kc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Yc=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Xc=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Dn="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Qc=new RegExp(`^${Dn}$`);function Bn(r){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?t=`${t}\\.\\d{${r.precision}}`:r.precision==null&&(t=`${t}(\\.\\d+)?`),t}function el(r){return new RegExp(`^${Bn(r)}$`)}function Un(r){let t=`${Dn}T${Bn(r)}`,e=[];return e.push(r.local?"Z?":"Z"),r.offset&&e.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${e.join("|")})`,new RegExp(`^${t}$`)}function tl(r,t){return!!((t==="v4"||!t)&&Kc.test(r)||(t==="v6"||!t)&&Yc.test(r))}var He=class lt extends x{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==C.string){let s=this._getOrReturnCtx(t);return P(s,{code:b.invalid_type,expected:C.string,received:s.parsedType}),k}let e=new ie,i;for(let s of this._def.checks)if(s.kind==="min")t.data.length<s.value&&(i=this._getOrReturnCtx(t,i),P(i,{code:b.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),e.dirty());else if(s.kind==="max")t.data.length>s.value&&(i=this._getOrReturnCtx(t,i),P(i,{code:b.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),e.dirty());else if(s.kind==="length"){let n=t.data.length>s.value,c=t.data.length<s.value;(n||c)&&(i=this._getOrReturnCtx(t,i),n?P(i,{code:b.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):c&&P(i,{code:b.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),e.dirty())}else if(s.kind==="email")Jc.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"email",code:b.invalid_string,message:s.message}),e.dirty());else if(s.kind==="emoji")or||(or=new RegExp(qc,"u")),or.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"emoji",code:b.invalid_string,message:s.message}),e.dirty());else if(s.kind==="uuid")zc.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"uuid",code:b.invalid_string,message:s.message}),e.dirty());else if(s.kind==="nanoid")$c.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"nanoid",code:b.invalid_string,message:s.message}),e.dirty());else if(s.kind==="cuid")Wc.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"cuid",code:b.invalid_string,message:s.message}),e.dirty());else if(s.kind==="cuid2")Vc.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"cuid2",code:b.invalid_string,message:s.message}),e.dirty());else if(s.kind==="ulid")Hc.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"ulid",code:b.invalid_string,message:s.message}),e.dirty());else if(s.kind==="url")try{new URL(t.data)}catch(n){i=this._getOrReturnCtx(t,i),P(i,{validation:"url",code:b.invalid_string,message:s.message}),e.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"regex",code:b.invalid_string,message:s.message}),e.dirty())):s.kind==="trim"?t.data=t.data.trim():s.kind==="includes"?t.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(t,i),P(i,{code:b.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),e.dirty()):s.kind==="toLowerCase"?t.data=t.data.toLowerCase():s.kind==="toUpperCase"?t.data=t.data.toUpperCase():s.kind==="startsWith"?t.data.startsWith(s.value)||(i=this._getOrReturnCtx(t,i),P(i,{code:b.invalid_string,validation:{startsWith:s.value},message:s.message}),e.dirty()):s.kind==="endsWith"?t.data.endsWith(s.value)||(i=this._getOrReturnCtx(t,i),P(i,{code:b.invalid_string,validation:{endsWith:s.value},message:s.message}),e.dirty()):s.kind==="datetime"?Un(s).test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{code:b.invalid_string,validation:"datetime",message:s.message}),e.dirty()):s.kind==="date"?Qc.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{code:b.invalid_string,validation:"date",message:s.message}),e.dirty()):s.kind==="time"?el(s).test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{code:b.invalid_string,validation:"time",message:s.message}),e.dirty()):s.kind==="duration"?Zc.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"duration",code:b.invalid_string,message:s.message}),e.dirty()):s.kind==="ip"?tl(t.data,s.version)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"ip",code:b.invalid_string,message:s.message}),e.dirty()):s.kind==="base64"?Xc.test(t.data)||(i=this._getOrReturnCtx(t,i),P(i,{validation:"base64",code:b.invalid_string,message:s.message}),e.dirty()):B.assertNever(s);return{status:e.value,value:t.data}}_regex(t,e,i){return this.refinement(s=>t.test(s),g({validation:e,code:b.invalid_string},T.errToObj(i)))}_addCheck(t){return new lt(R(g({},this._def),{checks:[...this._def.checks,t]}))}email(t){return this._addCheck(g({kind:"email"},T.errToObj(t)))}url(t){return this._addCheck(g({kind:"url"},T.errToObj(t)))}emoji(t){return this._addCheck(g({kind:"emoji"},T.errToObj(t)))}uuid(t){return this._addCheck(g({kind:"uuid"},T.errToObj(t)))}nanoid(t){return this._addCheck(g({kind:"nanoid"},T.errToObj(t)))}cuid(t){return this._addCheck(g({kind:"cuid"},T.errToObj(t)))}cuid2(t){return this._addCheck(g({kind:"cuid2"},T.errToObj(t)))}ulid(t){return this._addCheck(g({kind:"ulid"},T.errToObj(t)))}base64(t){return this._addCheck(g({kind:"base64"},T.errToObj(t)))}ip(t){return this._addCheck(g({kind:"ip"},T.errToObj(t)))}datetime(t){var e,i;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck(g({kind:"datetime",precision:typeof(t==null?void 0:t.precision)=="undefined"?null:t==null?void 0:t.precision,offset:(e=t==null?void 0:t.offset)!==null&&e!==void 0?e:!1,local:(i=t==null?void 0:t.local)!==null&&i!==void 0?i:!1},T.errToObj(t==null?void 0:t.message)))}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck(g({kind:"time",precision:typeof(t==null?void 0:t.precision)=="undefined"?null:t==null?void 0:t.precision},T.errToObj(t==null?void 0:t.message)))}duration(t){return this._addCheck(g({kind:"duration"},T.errToObj(t)))}regex(t,e){return this._addCheck(g({kind:"regex",regex:t},T.errToObj(e)))}includes(t,e){return this._addCheck(g({kind:"includes",value:t,position:e==null?void 0:e.position},T.errToObj(e==null?void 0:e.message)))}startsWith(t,e){return this._addCheck(g({kind:"startsWith",value:t},T.errToObj(e)))}endsWith(t,e){return this._addCheck(g({kind:"endsWith",value:t},T.errToObj(e)))}min(t,e){return this._addCheck(g({kind:"min",value:t},T.errToObj(e)))}max(t,e){return this._addCheck(g({kind:"max",value:t},T.errToObj(e)))}length(t,e){return this._addCheck(g({kind:"length",value:t},T.errToObj(e)))}nonempty(t){return this.min(1,T.errToObj(t))}trim(){return new lt(R(g({},this._def),{checks:[...this._def.checks,{kind:"trim"}]}))}toLowerCase(){return new lt(R(g({},this._def),{checks:[...this._def.checks,{kind:"toLowerCase"}]}))}toUpperCase(){return new lt(R(g({},this._def),{checks:[...this._def.checks,{kind:"toUpperCase"}]}))}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get minLength(){let t=null;for(let e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxLength(){let t=null;for(let e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}};He.create=r=>{var t;return new He(g({checks:[],typeName:M.ZodString,coerce:(t=r==null?void 0:r.coerce)!==null&&t!==void 0?t:!1},I(r)))};function il(r,t){let e=(r.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,s=e>i?e:i,n=parseInt(r.toFixed(s).replace(".","")),c=parseInt(t.toFixed(s).replace(".",""));return n%c/Math.pow(10,s)}var pt=class yr extends x{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==C.number){let s=this._getOrReturnCtx(t);return P(s,{code:b.invalid_type,expected:C.number,received:s.parsedType}),k}let e,i=new ie;for(let s of this._def.checks)s.kind==="int"?B.isInteger(t.data)||(e=this._getOrReturnCtx(t,e),P(e,{code:b.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(e=this._getOrReturnCtx(t,e),P(e,{code:b.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(e=this._getOrReturnCtx(t,e),P(e,{code:b.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?il(t.data,s.value)!==0&&(e=this._getOrReturnCtx(t,e),P(e,{code:b.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(t.data)||(e=this._getOrReturnCtx(t,e),P(e,{code:b.not_finite,message:s.message}),i.dirty()):B.assertNever(s);return{status:i.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,T.toString(e))}gt(t,e){return this.setLimit("min",t,!1,T.toString(e))}lte(t,e){return this.setLimit("max",t,!0,T.toString(e))}lt(t,e){return this.setLimit("max",t,!1,T.toString(e))}setLimit(t,e,i,s){return new yr(R(g({},this._def),{checks:[...this._def.checks,{kind:t,value:e,inclusive:i,message:T.toString(s)}]}))}_addCheck(t){return new yr(R(g({},this._def),{checks:[...this._def.checks,t]}))}int(t){return this._addCheck({kind:"int",message:T.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:T.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:T.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:T.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:T.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:T.toString(e)})}finite(t){return this._addCheck({kind:"finite",message:T.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:T.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:T.toString(t)})}get minValue(){let t=null;for(let e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(let e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&B.isInteger(t.value))}get isFinite(){let t=null,e=null;for(let i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(e===null||i.value>e)&&(e=i.value):i.kind==="max"&&(t===null||i.value<t)&&(t=i.value)}return Number.isFinite(e)&&Number.isFinite(t)}};pt.create=r=>new pt(g({checks:[],typeName:M.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1},I(r)));var ht=class Er extends x{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==C.bigint){let s=this._getOrReturnCtx(t);return P(s,{code:b.invalid_type,expected:C.bigint,received:s.parsedType}),k}let e,i=new ie;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(e=this._getOrReturnCtx(t,e),P(e,{code:b.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(e=this._getOrReturnCtx(t,e),P(e,{code:b.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?t.data%s.value!==BigInt(0)&&(e=this._getOrReturnCtx(t,e),P(e,{code:b.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):B.assertNever(s);return{status:i.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,T.toString(e))}gt(t,e){return this.setLimit("min",t,!1,T.toString(e))}lte(t,e){return this.setLimit("max",t,!0,T.toString(e))}lt(t,e){return this.setLimit("max",t,!1,T.toString(e))}setLimit(t,e,i,s){return new Er(R(g({},this._def),{checks:[...this._def.checks,{kind:t,value:e,inclusive:i,message:T.toString(s)}]}))}_addCheck(t){return new Er(R(g({},this._def),{checks:[...this._def.checks,t]}))}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:T.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:T.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:T.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:T.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:T.toString(e)})}get minValue(){let t=null;for(let e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(let e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}};ht.create=r=>{var t;return new ht(g({checks:[],typeName:M.ZodBigInt,coerce:(t=r==null?void 0:r.coerce)!==null&&t!==void 0?t:!1},I(r)))};var mt=class extends x{_parse(r){if(this._def.coerce&&(r.data=!!r.data),this._getType(r)!==C.boolean){let t=this._getOrReturnCtx(r);return P(t,{code:b.invalid_type,expected:C.boolean,received:t.parsedType}),k}return ee(r.data)}};mt.create=r=>new mt(g({typeName:M.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1},I(r)));var ft=class jn extends x{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==C.date){let s=this._getOrReturnCtx(t);return P(s,{code:b.invalid_type,expected:C.date,received:s.parsedType}),k}if(isNaN(t.data.getTime())){let s=this._getOrReturnCtx(t);return P(s,{code:b.invalid_date}),k}let e=new ie,i;for(let s of this._def.checks)s.kind==="min"?t.data.getTime()<s.value&&(i=this._getOrReturnCtx(t,i),P(i,{code:b.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),e.dirty()):s.kind==="max"?t.data.getTime()>s.value&&(i=this._getOrReturnCtx(t,i),P(i,{code:b.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),e.dirty()):B.assertNever(s);return{status:e.value,value:new Date(t.data.getTime())}}_addCheck(t){return new jn(R(g({},this._def),{checks:[...this._def.checks,t]}))}min(t,e){return this._addCheck({kind:"min",value:t.getTime(),message:T.toString(e)})}max(t,e){return this._addCheck({kind:"max",value:t.getTime(),message:T.toString(e)})}get minDate(){let t=null;for(let e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(let e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t!=null?new Date(t):null}};ft.create=r=>new ft(g({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:M.ZodDate},I(r)));var mi=class extends x{_parse(r){if(this._getType(r)!==C.symbol){let t=this._getOrReturnCtx(r);return P(t,{code:b.invalid_type,expected:C.symbol,received:t.parsedType}),k}return ee(r.data)}};mi.create=r=>new mi(g({typeName:M.ZodSymbol},I(r)));var gt=class extends x{_parse(r){if(this._getType(r)!==C.undefined){let t=this._getOrReturnCtx(r);return P(t,{code:b.invalid_type,expected:C.undefined,received:t.parsedType}),k}return ee(r.data)}};gt.create=r=>new gt(g({typeName:M.ZodUndefined},I(r)));var vt=class extends x{_parse(r){if(this._getType(r)!==C.null){let t=this._getOrReturnCtx(r);return P(t,{code:b.invalid_type,expected:C.null,received:t.parsedType}),k}return ee(r.data)}};vt.create=r=>new vt(g({typeName:M.ZodNull},I(r)));var ze=class extends x{constructor(){super(...arguments),this._any=!0}_parse(r){return ee(r.data)}};ze.create=r=>new ze(g({typeName:M.ZodAny},I(r)));var Ie=class extends x{constructor(){super(...arguments),this._unknown=!0}_parse(r){return ee(r.data)}};Ie.create=r=>new Ie(g({typeName:M.ZodUnknown},I(r)));var Pe=class extends x{_parse(r){let t=this._getOrReturnCtx(r);return P(t,{code:b.invalid_type,expected:C.never,received:t.parsedType}),k}};Pe.create=r=>new Pe(g({typeName:M.ZodNever},I(r)));var fi=class extends x{_parse(r){if(this._getType(r)!==C.undefined){let t=this._getOrReturnCtx(r);return P(t,{code:b.invalid_type,expected:C.void,received:t.parsedType}),k}return ee(r.data)}};fi.create=r=>new fi(g({typeName:M.ZodVoid},I(r)));var xe=class si extends x{_parse(t){let{ctx:e,status:i}=this._processInputParams(t),s=this._def;if(e.parsedType!==C.array)return P(e,{code:b.invalid_type,expected:C.array,received:e.parsedType}),k;if(s.exactLength!==null){let c=e.data.length>s.exactLength.value,o=e.data.length<s.exactLength.value;(c||o)&&(P(e,{code:c?b.too_big:b.too_small,minimum:o?s.exactLength.value:void 0,maximum:c?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),i.dirty())}if(s.minLength!==null&&e.data.length<s.minLength.value&&(P(e,{code:b.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),i.dirty()),s.maxLength!==null&&e.data.length>s.maxLength.value&&(P(e,{code:b.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),i.dirty()),e.common.async)return Promise.all([...e.data].map((c,o)=>s.type._parseAsync(new ge(e,c,e.path,o)))).then(c=>ie.mergeArray(i,c));let n=[...e.data].map((c,o)=>s.type._parseSync(new ge(e,c,e.path,o)));return ie.mergeArray(i,n)}get element(){return this._def.type}min(t,e){return new si(R(g({},this._def),{minLength:{value:t,message:T.toString(e)}}))}max(t,e){return new si(R(g({},this._def),{maxLength:{value:t,message:T.toString(e)}}))}length(t,e){return new si(R(g({},this._def),{exactLength:{value:t,message:T.toString(e)}}))}nonempty(t){return this.min(1,t)}};xe.create=(r,t)=>new xe(g({type:r,minLength:null,maxLength:null,exactLength:null,typeName:M.ZodArray},I(t)));function Ge(r){if(r instanceof oe){let t={};for(let e in r.shape){let i=r.shape[e];t[e]=me.create(Ge(i))}return new oe(R(g({},r._def),{shape:()=>t}))}else return r instanceof xe?new xe(R(g({},r._def),{type:Ge(r.element)})):r instanceof me?me.create(Ge(r.unwrap())):r instanceof Ae?Ae.create(Ge(r.unwrap())):r instanceof _e?_e.create(r.items.map(t=>Ge(t))):r}var oe=class ae extends x{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let t=this._def.shape(),e=B.objectKeys(t);return this._cached={shape:t,keys:e}}_parse(t){if(this._getType(t)!==C.object){let a=this._getOrReturnCtx(t);return P(a,{code:b.invalid_type,expected:C.object,received:a.parsedType}),k}let{status:e,ctx:i}=this._processInputParams(t),{shape:s,keys:n}=this._getCached(),c=[];if(!(this._def.catchall instanceof Pe&&this._def.unknownKeys==="strip"))for(let a in i.data)n.includes(a)||c.push(a);let o=[];for(let a of n){let l=s[a],u=i.data[a];o.push({key:{status:"valid",value:a},value:l._parse(new ge(i,u,i.path,a)),alwaysSet:a in i.data})}if(this._def.catchall instanceof Pe){let a=this._def.unknownKeys;if(a==="passthrough")for(let l of c)o.push({key:{status:"valid",value:l},value:{status:"valid",value:i.data[l]}});else if(a==="strict")c.length>0&&(P(i,{code:b.unrecognized_keys,keys:c}),e.dirty());else if(a!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let a=this._def.catchall;for(let l of c){let u=i.data[l];o.push({key:{status:"valid",value:l},value:a._parse(new ge(i,u,i.path,l)),alwaysSet:l in i.data})}}return i.common.async?Promise.resolve().then(()=>Ee(this,null,function*(){let a=[];for(let l of o){let u=yield l.key,p=yield l.value;a.push({key:u,value:p,alwaysSet:l.alwaysSet})}return a})).then(a=>ie.mergeObjectSync(e,a)):ie.mergeObjectSync(e,o)}get shape(){return this._def.shape()}strict(t){return T.errToObj,new ae(g(R(g({},this._def),{unknownKeys:"strict"}),t!==void 0?{errorMap:(e,i)=>{var s,n,c,o;let a=(c=(n=(s=this._def).errorMap)===null||n===void 0?void 0:n.call(s,e,i).message)!==null&&c!==void 0?c:i.defaultError;return e.code==="unrecognized_keys"?{message:(o=T.errToObj(t).message)!==null&&o!==void 0?o:a}:{message:a}}}:{}))}strip(){return new ae(R(g({},this._def),{unknownKeys:"strip"}))}passthrough(){return new ae(R(g({},this._def),{unknownKeys:"passthrough"}))}extend(t){return new ae(R(g({},this._def),{shape:()=>g(g({},this._def.shape()),t)}))}merge(t){return new ae({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>g(g({},this._def.shape()),t._def.shape()),typeName:M.ZodObject})}setKey(t,e){return this.augment({[t]:e})}catchall(t){return new ae(R(g({},this._def),{catchall:t}))}pick(t){let e={};return B.objectKeys(t).forEach(i=>{t[i]&&this.shape[i]&&(e[i]=this.shape[i])}),new ae(R(g({},this._def),{shape:()=>e}))}omit(t){let e={};return B.objectKeys(this.shape).forEach(i=>{t[i]||(e[i]=this.shape[i])}),new ae(R(g({},this._def),{shape:()=>e}))}deepPartial(){return Ge(this)}partial(t){let e={};return B.objectKeys(this.shape).forEach(i=>{let s=this.shape[i];t&&!t[i]?e[i]=s:e[i]=s.optional()}),new ae(R(g({},this._def),{shape:()=>e}))}required(t){let e={};return B.objectKeys(this.shape).forEach(i=>{if(t&&!t[i])e[i]=this.shape[i];else{let s=this.shape[i];for(;s instanceof me;)s=s._def.innerType;e[i]=s}}),new ae(R(g({},this._def),{shape:()=>e}))}keyof(){return $n(B.objectKeys(this.shape))}};oe.create=(r,t)=>new oe(g({shape:()=>r,unknownKeys:"strip",catchall:Pe.create(),typeName:M.ZodObject},I(t)));oe.strictCreate=(r,t)=>new oe(g({shape:()=>r,unknownKeys:"strict",catchall:Pe.create(),typeName:M.ZodObject},I(t)));oe.lazycreate=(r,t)=>new oe(g({shape:r,unknownKeys:"strip",catchall:Pe.create(),typeName:M.ZodObject},I(t)));var bt=class extends x{_parse(r){let{ctx:t}=this._processInputParams(r),e=this._def.options;function i(s){for(let c of s)if(c.result.status==="valid")return c.result;for(let c of s)if(c.result.status==="dirty")return t.common.issues.push(...c.ctx.common.issues),c.result;let n=s.map(c=>new ue(c.ctx.common.issues));return P(t,{code:b.invalid_union,unionErrors:n}),k}if(t.common.async)return Promise.all(e.map(s=>Ee(this,null,function*(){let n=R(g({},t),{common:R(g({},t.common),{issues:[]}),parent:null});return{result:yield s._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}}))).then(i);{let s,n=[];for(let o of e){let a=R(g({},t),{common:R(g({},t.common),{issues:[]}),parent:null}),l=o._parseSync({data:t.data,path:t.path,parent:a});if(l.status==="valid")return l;l.status==="dirty"&&!s&&(s={result:l,ctx:a}),a.common.issues.length&&n.push(a.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;let c=n.map(o=>new ue(o));return P(t,{code:b.invalid_union,unionErrors:c}),k}}get options(){return this._def.options}};bt.create=(r,t)=>new bt(g({options:r,typeName:M.ZodUnion},I(t)));var we=r=>r instanceof Et?we(r.schema):r instanceof de?we(r.innerType()):r instanceof Pt?[r.value]:r instanceof At?r.options:r instanceof Ct?B.objectValues(r.enum):r instanceof wt?we(r._def.innerType):r instanceof gt?[void 0]:r instanceof vt?[null]:r instanceof me?[void 0,...we(r.unwrap())]:r instanceof Ae?[null,...we(r.unwrap())]:r instanceof Nr||r instanceof _t?we(r.unwrap()):r instanceof Tt?we(r._def.innerType):[],Gn=class Wn extends x{_parse(t){let{ctx:e}=this._processInputParams(t);if(e.parsedType!==C.object)return P(e,{code:b.invalid_type,expected:C.object,received:e.parsedType}),k;let i=this.discriminator,s=e.data[i],n=this.optionsMap.get(s);return n?e.common.async?n._parseAsync({data:e.data,path:e.path,parent:e}):n._parseSync({data:e.data,path:e.path,parent:e}):(P(e,{code:b.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),k)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,e,i){let s=new Map;for(let n of e){let c=we(n.shape[t]);if(!c.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(let o of c){if(s.has(o))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(o)}`);s.set(o,n)}}return new Wn(g({typeName:M.ZodDiscriminatedUnion,discriminator:t,options:e,optionsMap:s},I(i)))}};function Pr(r,t){let e=Te(r),i=Te(t);if(r===t)return{valid:!0,data:r};if(e===C.object&&i===C.object){let s=B.objectKeys(t),n=B.objectKeys(r).filter(o=>s.indexOf(o)!==-1),c=g(g({},r),t);for(let o of n){let a=Pr(r[o],t[o]);if(!a.valid)return{valid:!1};c[o]=a.data}return{valid:!0,data:c}}else if(e===C.array&&i===C.array){if(r.length!==t.length)return{valid:!1};let s=[];for(let n=0;n<r.length;n++){let c=r[n],o=t[n],a=Pr(c,o);if(!a.valid)return{valid:!1};s.push(a.data)}return{valid:!0,data:s}}else return e===C.date&&i===C.date&&+r==+t?{valid:!0,data:r}:{valid:!1}}var yt=class extends x{_parse(r){let{status:t,ctx:e}=this._processInputParams(r),i=(s,n)=>{if(vr(s)||vr(n))return k;let c=Pr(s.value,n.value);return c.valid?((br(s)||br(n))&&t.dirty(),{status:t.value,value:c.data}):(P(e,{code:b.invalid_intersection_types}),k)};return e.common.async?Promise.all([this._def.left._parseAsync({data:e.data,path:e.path,parent:e}),this._def.right._parseAsync({data:e.data,path:e.path,parent:e})]).then(([s,n])=>i(s,n)):i(this._def.left._parseSync({data:e.data,path:e.path,parent:e}),this._def.right._parseSync({data:e.data,path:e.path,parent:e}))}};yt.create=(r,t,e)=>new yt(g({left:r,right:t,typeName:M.ZodIntersection},I(e)));var _e=class Vn extends x{_parse(t){let{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==C.array)return P(i,{code:b.invalid_type,expected:C.array,received:i.parsedType}),k;if(i.data.length<this._def.items.length)return P(i,{code:b.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),k;!this._def.rest&&i.data.length>this._def.items.length&&(P(i,{code:b.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),e.dirty());let s=[...i.data].map((n,c)=>{let o=this._def.items[c]||this._def.rest;return o?o._parse(new ge(i,n,i.path,c)):null}).filter(n=>!!n);return i.common.async?Promise.all(s).then(n=>ie.mergeArray(e,n)):ie.mergeArray(e,s)}get items(){return this._def.items}rest(t){return new Vn(R(g({},this._def),{rest:t}))}};_e.create=(r,t)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new _e(g({items:r,typeName:M.ZodTuple,rest:null},I(t)))};var Hn=class Cr extends x{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==C.object)return P(i,{code:b.invalid_type,expected:C.object,received:i.parsedType}),k;let s=[],n=this._def.keyType,c=this._def.valueType;for(let o in i.data)s.push({key:n._parse(new ge(i,o,i.path,o)),value:c._parse(new ge(i,i.data[o],i.path,o)),alwaysSet:o in i.data});return i.common.async?ie.mergeObjectAsync(e,s):ie.mergeObjectSync(e,s)}get element(){return this._def.valueType}static create(t,e,i){return e instanceof x?new Cr(g({keyType:t,valueType:e,typeName:M.ZodRecord},I(i))):new Cr(g({keyType:He.create(),valueType:t,typeName:M.ZodRecord},I(e)))}},gi=class extends x{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(r){let{status:t,ctx:e}=this._processInputParams(r);if(e.parsedType!==C.map)return P(e,{code:b.invalid_type,expected:C.map,received:e.parsedType}),k;let i=this._def.keyType,s=this._def.valueType,n=[...e.data.entries()].map(([c,o],a)=>({key:i._parse(new ge(e,c,e.path,[a,"key"])),value:s._parse(new ge(e,o,e.path,[a,"value"]))}));if(e.common.async){let c=new Map;return Promise.resolve().then(()=>Ee(this,null,function*(){for(let o of n){let a=yield o.key,l=yield o.value;if(a.status==="aborted"||l.status==="aborted")return k;(a.status==="dirty"||l.status==="dirty")&&t.dirty(),c.set(a.value,l.value)}return{status:t.value,value:c}}))}else{let c=new Map;for(let o of n){let a=o.key,l=o.value;if(a.status==="aborted"||l.status==="aborted")return k;(a.status==="dirty"||l.status==="dirty")&&t.dirty(),c.set(a.value,l.value)}return{status:t.value,value:c}}}};gi.create=(r,t,e)=>new gi(g({valueType:t,keyType:r,typeName:M.ZodMap},I(e)));var vi=class wr extends x{_parse(t){let{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==C.set)return P(i,{code:b.invalid_type,expected:C.set,received:i.parsedType}),k;let s=this._def;s.minSize!==null&&i.data.size<s.minSize.value&&(P(i,{code:b.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),e.dirty()),s.maxSize!==null&&i.data.size>s.maxSize.value&&(P(i,{code:b.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),e.dirty());let n=this._def.valueType;function c(a){let l=new Set;for(let u of a){if(u.status==="aborted")return k;u.status==="dirty"&&e.dirty(),l.add(u.value)}return{status:e.value,value:l}}let o=[...i.data.values()].map((a,l)=>n._parse(new ge(i,a,i.path,l)));return i.common.async?Promise.all(o).then(a=>c(a)):c(o)}min(t,e){return new wr(R(g({},this._def),{minSize:{value:t,message:T.toString(e)}}))}max(t,e){return new wr(R(g({},this._def),{maxSize:{value:t,message:T.toString(e)}}))}size(t,e){return this.min(t,e).max(t,e)}nonempty(t){return this.min(1,t)}};vi.create=(r,t)=>new vi(g({valueType:r,minSize:null,maxSize:null,typeName:M.ZodSet},I(t)));var zn=class ni extends x{constructor(){super(...arguments),this.validate=this.implement}_parse(t){let{ctx:e}=this._processInputParams(t);if(e.parsedType!==C.function)return P(e,{code:b.invalid_type,expected:C.function,received:e.parsedType}),k;function i(o,a){return di({data:o,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,ui(),Ve].filter(l=>!!l),issueData:{code:b.invalid_arguments,argumentsError:a}})}function s(o,a){return di({data:o,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,ui(),Ve].filter(l=>!!l),issueData:{code:b.invalid_return_type,returnTypeError:a}})}let n={errorMap:e.common.contextualErrorMap},c=e.data;if(this._def.returns instanceof $e){let o=this;return ee(function(...a){return Ee(this,null,function*(){let l=new ue([]),u=yield o._def.args.parseAsync(a,n).catch(d=>{throw l.addIssue(i(a,d)),l}),p=yield Reflect.apply(c,this,u);return yield o._def.returns._def.type.parseAsync(p,n).catch(d=>{throw l.addIssue(s(p,d)),l})})})}else{let o=this;return ee(function(...a){let l=o._def.args.safeParse(a,n);if(!l.success)throw new ue([i(a,l.error)]);let u=Reflect.apply(c,this,l.data),p=o._def.returns.safeParse(u,n);if(!p.success)throw new ue([s(u,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new ni(R(g({},this._def),{args:_e.create(t).rest(Ie.create())}))}returns(t){return new ni(R(g({},this._def),{returns:t}))}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,e,i){return new ni(g({args:t||_e.create([]).rest(Ie.create()),returns:e||Ie.create(),typeName:M.ZodFunction},I(i)))}},Et=class extends x{get schema(){return this._def.getter()}_parse(r){let{ctx:t}=this._processInputParams(r);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Et.create=(r,t)=>new Et(g({getter:r,typeName:M.ZodLazy},I(t)));var Pt=class extends x{_parse(r){if(r.data!==this._def.value){let t=this._getOrReturnCtx(r);return P(t,{received:t.data,code:b.invalid_literal,expected:this._def.value}),k}return{status:"valid",value:r.data}}get value(){return this._def.value}};Pt.create=(r,t)=>new Pt(g({value:r,typeName:M.ZodLiteral},I(t)));function $n(r,t){return new At(g({values:r,typeName:M.ZodEnum},I(t)))}var At=class Tr extends x{constructor(){super(...arguments),at.set(this,void 0)}_parse(t){if(typeof t.data!="string"){let e=this._getOrReturnCtx(t),i=this._def.values;return P(e,{expected:B.joinValues(i),received:e.parsedType,code:b.invalid_type}),k}if(hi(this,at,"f")||Fn(this,at,new Set(this._def.values),"f"),!hi(this,at,"f").has(t.data)){let e=this._getOrReturnCtx(t),i=this._def.values;return P(e,{received:e.data,code:b.invalid_enum_value,options:i}),k}return ee(t.data)}get options(){return this._def.values}get enum(){let t={};for(let e of this._def.values)t[e]=e;return t}get Values(){let t={};for(let e of this._def.values)t[e]=e;return t}get Enum(){let t={};for(let e of this._def.values)t[e]=e;return t}extract(t,e=this._def){return Tr.create(t,g(g({},this._def),e))}exclude(t,e=this._def){return Tr.create(this.options.filter(i=>!t.includes(i)),g(g({},this._def),e))}};at=new WeakMap;At.create=$n;var Ct=class extends x{constructor(){super(...arguments),ct.set(this,void 0)}_parse(r){let t=B.getValidEnumValues(this._def.values),e=this._getOrReturnCtx(r);if(e.parsedType!==C.string&&e.parsedType!==C.number){let i=B.objectValues(t);return P(e,{expected:B.joinValues(i),received:e.parsedType,code:b.invalid_type}),k}if(hi(this,ct,"f")||Fn(this,ct,new Set(B.getValidEnumValues(this._def.values)),"f"),!hi(this,ct,"f").has(r.data)){let i=B.objectValues(t);return P(e,{received:e.data,code:b.invalid_enum_value,options:i}),k}return ee(r.data)}get enum(){return this._def.values}};ct=new WeakMap;Ct.create=(r,t)=>new Ct(g({values:r,typeName:M.ZodNativeEnum},I(t)));var $e=class extends x{unwrap(){return this._def.type}_parse(r){let{ctx:t}=this._processInputParams(r);if(t.parsedType!==C.promise&&t.common.async===!1)return P(t,{code:b.invalid_type,expected:C.promise,received:t.parsedType}),k;let e=t.parsedType===C.promise?t.data:Promise.resolve(t.data);return ee(e.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}};$e.create=(r,t)=>new $e(g({type:r,typeName:M.ZodPromise},I(t)));var de=class extends x{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===M.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(r){let{status:t,ctx:e}=this._processInputParams(r),i=this._def.effect||null,s={addIssue:n=>{P(e,n),n.fatal?t.abort():t.dirty()},get path(){return e.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="preprocess"){let n=i.transform(e.data,s);if(e.common.async)return Promise.resolve(n).then(c=>Ee(this,null,function*(){if(t.value==="aborted")return k;let o=yield this._def.schema._parseAsync({data:c,path:e.path,parent:e});return o.status==="aborted"?k:o.status==="dirty"||t.value==="dirty"?pi(o.value):o}));{if(t.value==="aborted")return k;let c=this._def.schema._parseSync({data:n,path:e.path,parent:e});return c.status==="aborted"?k:c.status==="dirty"||t.value==="dirty"?pi(c.value):c}}if(i.type==="refinement"){let n=c=>{let o=i.refinement(c,s);if(e.common.async)return Promise.resolve(o);if(o instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return c};if(e.common.async===!1){let c=this._def.schema._parseSync({data:e.data,path:e.path,parent:e});return c.status==="aborted"?k:(c.status==="dirty"&&t.dirty(),n(c.value),{status:t.value,value:c.value})}else return this._def.schema._parseAsync({data:e.data,path:e.path,parent:e}).then(c=>c.status==="aborted"?k:(c.status==="dirty"&&t.dirty(),n(c.value).then(()=>({status:t.value,value:c.value}))))}if(i.type==="transform")if(e.common.async===!1){let n=this._def.schema._parseSync({data:e.data,path:e.path,parent:e});if(!ut(n))return n;let c=i.transform(n.value,s);if(c instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:c}}else return this._def.schema._parseAsync({data:e.data,path:e.path,parent:e}).then(n=>ut(n)?Promise.resolve(i.transform(n.value,s)).then(c=>({status:t.value,value:c})):n);B.assertNever(i)}};de.create=(r,t,e)=>new de(g({schema:r,typeName:M.ZodEffects,effect:t},I(e)));de.createWithPreprocess=(r,t,e)=>new de(g({schema:t,effect:{type:"preprocess",transform:r},typeName:M.ZodEffects},I(e)));var me=class extends x{_parse(r){return this._getType(r)===C.undefined?ee(void 0):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}};me.create=(r,t)=>new me(g({innerType:r,typeName:M.ZodOptional},I(t)));var Ae=class extends x{_parse(r){return this._getType(r)===C.null?ee(null):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}};Ae.create=(r,t)=>new Ae(g({innerType:r,typeName:M.ZodNullable},I(t)));var wt=class extends x{_parse(r){let{ctx:t}=this._processInputParams(r),e=t.data;return t.parsedType===C.undefined&&(e=this._def.defaultValue()),this._def.innerType._parse({data:e,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};wt.create=(r,t)=>new wt(g({innerType:r,typeName:M.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default},I(t)));var Tt=class extends x{_parse(r){let{ctx:t}=this._processInputParams(r),e=R(g({},t),{common:R(g({},t.common),{issues:[]})}),i=this._def.innerType._parse({data:e.data,path:e.path,parent:g({},e)});return dt(i)?i.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ue(e.common.issues)},input:e.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new ue(e.common.issues)},input:e.data})}}removeCatch(){return this._def.innerType}};Tt.create=(r,t)=>new Tt(g({innerType:r,typeName:M.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch},I(t)));var bi=class extends x{_parse(r){if(this._getType(r)!==C.nan){let t=this._getOrReturnCtx(r);return P(t,{code:b.invalid_type,expected:C.nan,received:t.parsedType}),k}return{status:"valid",value:r.data}}};bi.create=r=>new bi(g({typeName:M.ZodNaN},I(r)));var rl=Symbol("zod_brand"),Nr=class extends x{_parse(r){let{ctx:t}=this._processInputParams(r),e=t.data;return this._def.type._parse({data:e,path:t.path,parent:t})}unwrap(){return this._def.type}},Fr=class Zn extends x{_parse(t){let{status:e,ctx:i}=this._processInputParams(t);if(i.common.async)return Ee(this,null,function*(){let s=yield this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return s.status==="aborted"?k:s.status==="dirty"?(e.dirty(),pi(s.value)):this._def.out._parseAsync({data:s.value,path:i.path,parent:i})});{let s=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return s.status==="aborted"?k:s.status==="dirty"?(e.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:i.path,parent:i})}}static create(t,e){return new Zn({in:t,out:e,typeName:M.ZodPipeline})}},_t=class extends x{_parse(r){let t=this._def.innerType._parse(r),e=i=>(ut(i)&&(i.value=Object.freeze(i.value)),i);return dt(t)?t.then(i=>e(i)):e(t)}unwrap(){return this._def.innerType}};_t.create=(r,t)=>new _t(g({innerType:r,typeName:M.ZodReadonly},I(t)));function Jn(r,t={},e){return r?ze.create().superRefine((i,s)=>{var n,c;if(!r(i)){let o=typeof t=="function"?t(i):typeof t=="string"?{message:t}:t,a=(c=(n=o.fatal)!==null&&n!==void 0?n:e)!==null&&c!==void 0?c:!0,l=typeof o=="string"?{message:o}:o;s.addIssue(R(g({code:"custom"},l),{fatal:a}))}}):ze.create()}var sl={object:oe.lazycreate},M;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(M||(M={}));var nl=(r,t={message:`Input not instance of ${r.name}`})=>Jn(e=>e instanceof r,t),qn=He.create,Kn=pt.create,ol=bi.create,al=ht.create,Yn=mt.create,cl=ft.create,ll=mi.create,ul=gt.create,dl=vt.create,pl=ze.create,hl=Ie.create,ml=Pe.create,fl=fi.create,gl=xe.create,vl=oe.create,bl=oe.strictCreate,yl=bt.create,El=Gn.create,Pl=yt.create,Cl=_e.create,wl=Hn.create,Tl=gi.create,_l=vi.create,Al=zn.create,Ol=Et.create,Sl=Pt.create,Ml=At.create,Ll=Ct.create,Rl=$e.create,dn=de.create,kl=me.create,Il=Ae.create,xl=de.createWithPreprocess,Nl=Fr.create,Fl=()=>qn().optional(),Dl=()=>Kn().optional(),Bl=()=>Yn().optional(),Ul={string:r=>He.create(R(g({},r),{coerce:!0})),number:r=>pt.create(R(g({},r),{coerce:!0})),boolean:r=>mt.create(R(g({},r),{coerce:!0})),bigint:r=>ht.create(R(g({},r),{coerce:!0})),date:r=>ft.create(R(g({},r),{coerce:!0}))},jl=k,ce=Object.freeze({__proto__:null,defaultErrorMap:Ve,setErrorMap:jc,getErrorMap:ui,makeIssue:di,EMPTY_PATH:Gc,addIssueToContext:P,ParseStatus:ie,INVALID:k,DIRTY:pi,OK:ee,isAborted:vr,isDirty:br,isValid:ut,isAsync:dt,get util(){return B},get objectUtil(){return gr},ZodParsedType:C,getParsedType:Te,ZodType:x,datetimeRegex:Un,ZodString:He,ZodNumber:pt,ZodBigInt:ht,ZodBoolean:mt,ZodDate:ft,ZodSymbol:mi,ZodUndefined:gt,ZodNull:vt,ZodAny:ze,ZodUnknown:Ie,ZodNever:Pe,ZodVoid:fi,ZodArray:xe,ZodObject:oe,ZodUnion:bt,ZodDiscriminatedUnion:Gn,ZodIntersection:yt,ZodTuple:_e,ZodRecord:Hn,ZodMap:gi,ZodSet:vi,ZodFunction:zn,ZodLazy:Et,ZodLiteral:Pt,ZodEnum:At,ZodNativeEnum:Ct,ZodPromise:$e,ZodEffects:de,ZodTransformer:de,ZodOptional:me,ZodNullable:Ae,ZodDefault:wt,ZodCatch:Tt,ZodNaN:bi,BRAND:rl,ZodBranded:Nr,ZodPipeline:Fr,ZodReadonly:_t,custom:Jn,Schema:x,ZodSchema:x,late:sl,get ZodFirstPartyTypeKind(){return M},coerce:Ul,any:pl,array:gl,bigint:al,boolean:Yn,date:cl,discriminatedUnion:El,effect:dn,enum:Ml,function:Al,instanceof:nl,intersection:Pl,lazy:Ol,literal:Sl,map:Tl,nan:ol,nativeEnum:Ll,never:ml,null:dl,nullable:Il,number:Kn,object:vl,oboolean:Bl,onumber:Dl,optional:kl,ostring:Fl,pipeline:Nl,preprocess:xl,promise:Rl,record:wl,set:_l,strictObject:bl,string:qn,symbol:ll,transformer:dn,tuple:Cl,undefined:ul,union:yl,unknown:hl,void:fl,NEVER:jl,ZodIssueCode:b,quotelessJson:Uc,ZodError:ue}),Gl=ce.object({serverUrl:ce.string()}),Wl=Gl.parse({serverUrl:"https://io.superviz.com"}),Vl=class{constructor(r){this.socket=r,this.onConnect=()=>{this.logger.log("connection @ on connect","Connected to the socket"),this.changeState("CONNECTED")},this.onDisconnect=t=>{this.logger.log("connection @ on disconnect","Disconnected from the socket"),this.changeState("DISCONNECTED",t)},this.onConnectError=t=>{this.logger.log("connection @ on connect error","Connection error",t),this.changeState("CONNECTION_ERROR",t.message)},this.onConnectionError=t=>{this.logger.log("connection @ on connection error","Connection error",t),this.changeState("CONNECTION_ERROR",t.message)},this.onReconnect=()=>{this.logger.log("connection @ on reconnect","Reconnected to the socket"),this.changeState("CONNECTED")},this.onReconnectError=t=>{this.logger.log("connection @ on reconnect error","Reconnect error",t),this.changeState("RECONNECT_ERROR",t.message)},this.onReconnectFailed=()=>{this.logger.log("connection @ on reconnect failed","Failed to reconnect to the socket"),this.changeState("RECONNECT_ERROR")},this.onReconnecAttempt=t=>{this.logger.log("connection @ on reconnect attempt",`Reconnect attempt #${t}`),this.changeState("RECONNECTING",`Reconnect attempt #${t}`)},this.onCustomError=t=>{t.needsToDisconnect&&(this.socket.disconnect(),this.changeState("DISCONNECTED",t.errorType));let e=`[SuperViz] 
    - Error: ${t.errorType}
    - Message: ${t.message}
    `;if(t.level==="error"){console.error(e);return}console.warn(e)},this.logger=new Sr("@superviz/socket-client/connection"),this.subscribeToManagerEvents(),this.stateObserver=new he}on(r,t){this.stateObserver.closed&&(this.stateObserver=new he),this.stateObserver.subscribe({next:r,error:t})}off(){this.stateObserver.closed||this.stateObserver.unsubscribe()}subscribeToManagerEvents(){this.socket.on("connect",this.onConnect),this.socket.on("disconnect",this.onDisconnect),this.socket.on("connect_error",this.onConnectError),this.socket.io.on("error",this.onConnectionError),this.socket.io.on("reconnect",this.onReconnect),this.socket.io.on("reconnect_attempt",this.onReconnecAttempt),this.socket.io.on("reconnect_error",this.onReconnectError),this.socket.io.on("reconnect_failed",this.onReconnectFailed),this.socket.on("socket-event.error",this.onCustomError)}changeState(r,t){this.state=r,!this.stateObserver.closed&&this.stateObserver.next({state:r,reason:t})}},Hl=class Xn{constructor(t,e,i,s,n=100){this.io=t,this.user=e,this.roomId=i,this.apiKey=s,this.maxConnections=n,this.isJoined=!1,this.subscriptions=new Map,this.observers=new Map,this.onJoinedRoom=o=>{var a;this.roomId===((a=o==null?void 0:o.data)==null?void 0:a.name)&&(this.isJoined=!0,this.io.emit("room.joined",this.roomId,o.data),this.logger.log("room @ joined",o))},this.onHttpEvent=o=>{this.publishEventToClient(o.name,o)},this.logger=new Sr("@superviz/socket-client/room");let c={name:i,user:e,maxConnections:n};this.presence=qa.register(t,e,i),this.io.emit("room.join",c),this.subscribeToRoomEvents()}static register(t,e,i,s,n){return new Xn(t,e,i,s,n)}on(t,e){this.logger.log("room @ on",t);let i=this.observers.get(t);i||(i=new he,this.observers.set(t,i),this.io.on(t,s=>{this.publishEventToClient(t,s)})),this.subscriptions.set(e,i.subscribe(e))}off(t,e){var i;if(this.logger.log("room @ off",t),!e){this.observers.delete(t),this.io.off(t);return}(i=this.subscriptions.get(e))==null||i.unsubscribe()}emit(t,e){if(!this.isJoined){this.logger.log("Cannot emit event. Not joined to room");return}let i={name:t,roomId:this.roomId,presence:this.user,connectionId:this.io.id,data:e,timestamp:Date.now()};this.io.emit("room.update",this.roomId,i),this.logger.log("room @ emit",t,e)}history(t,e){let i=new he;i.subscribe({next:t,error:e});let s=n=>{this.logger.log("room @ history",n),this.io.off("room.get",s),i.next(n),i.complete(),i.unsubscribe()};this.io.on("room.get",s),this.io.emit("room.get",this.roomId)}disconnect(){this.logger.log("room @ disconnect","Leaving room...",this.roomId),this.io.emit("room.leave",this.roomId),this.subscriptions.forEach(t=>t.unsubscribe()),this.subscriptions.clear(),this.observers.forEach(t=>t.unsubscribe()),this.observers.clear(),this.presence.destroy()}publishEventToClient(t,e){let i=this.observers.get(t);!i||e.roomId!==this.roomId||i.next(e)}subscribeToRoomEvents(){this.io.on("room.joined",this.onJoinedRoom),this.io.on("room.error",t=>{this.logger.log("Error:",t.data)}),this.io.on(`http:${this.roomId}:${this.apiKey}`,this.onHttpEvent)}},Qn=class{constructor(r,t,e,i,s){this.apiKey=r,this.environment=t,this.presence=e,this.secret=i,this.clientId=s,this.manager=new li(Wl.serverUrl,{addTrailingSlash:!1,secure:!0,withCredentials:!0,reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:5,extraHeaders:{"sv-api-key":this.apiKey}});let n;typeof window!="undefined"&&(n=window.location.origin),this.socket=this.manager.socket(`/${t}`,{auth:{apiKey:this.apiKey,origin:n,envirioment:this.environment,secret:this.secret,clientId:this.clientId}}),this.connection=new Vl(this.socket)}get state(){return this.connection.state}connect(r,t){return Hl.register(this.socket,this.presence,r,this.apiKey,t)}destroy(){this.socket.disconnect(),this.connection.off()}},Ad=ce.object({name:ce.string(),user:ce.object({id:ce.string(),name:ce.string().nullable()}),maxConnections:ce.union([ce.number(),ce.literal("unlimited"),ce.undefined()])});var to=pe(tt());m();var Ot=class{constructor(){this.observers=new Map;this.subscribe=(t,e)=>{this.logger.log("event bus service @ subscribe",{event:t,callback:e}),this.observers.has(t)||this.observers.set(t,new j),this.observers.get(t).subscribe(e)};this.unsubscribe=(t,e)=>{this.logger.log("event bus service @ unsubscribe",{event:t,callback:e}),this.observers.has(t)&&(this.observers.get(t).reset(),this.observers.delete(t))};this.publish=(t,e)=>{this.logger.log("event bus service @ publish",{event:t,data:e}),this.observers.has(t)&&this.observers.get(t).publish(e)};this.destroy=()=>{this.logger.log("event bus service @ destroy"),this.observers.forEach(t=>{t.reset(),t.destroy()}),this.observers.clear()};this.logger=new N("@superviz/sdk/event-bus"),this.logger.log("event bus created")}};m();m();var wi=class{constructor(t){this.participant=t;this.stateSubject=new Xr;this.handleConnectionState=t=>{if(t.reason==="Unauthorized connection"){console.error("[Superviz] Unauthorized connection. Please check your API key and if your domain is white listed."),this.state={state:Ar.DISCONNECTED,reason:"Unauthorized connection"},this.stateSubject.next("AUTH_ERROR");return}if(t.reason==="user-already-in-room"){this.state=t,this.stateSubject.next("SAME_ACCOUNT_ERROR");return}this.state=t,this.stateSubject.next(t.state)};this.createClient()}destroy(){this.stateSubject.complete(),this.client.destroy()}subscribeToDefaultEvents(){this.client.connection.on(this.handleConnectionState)}createClient(){let t=A.get("environment");t=["dev","prod"].includes(t)?t:"dev",this.client=new Qn(A.get("apiKey"),t,{id:this.participant.id,name:this.participant.name}),this.subscribeToDefaultEvents()}createRoom(t,e=50){let i=A.get("roomId");return this.client.connect(`${i}:${t}`,e)}};m();m();var Dr=(o=>(o.comments="presence",o.presence3dMatterport="presence",o.presence3dAutodesk="presence",o.presence3dThreejs="presence",o.whoIsOnline="presence",o.formElements="presence",o.yjsProvider="presence",o))(Dr||{});var qe=class{static checkComponentLimit(t){var s,n;let e=A.get("limits"),i=(s=Dr[t])!=null?s:t;return(n=e==null?void 0:e[i])!=null?n:{canUse:!1,maxParticipants:50}}};m();var eo=pe(tt());m();var $l=1e3,Ti=class{constructor(t,e){this.participants3DObservers=[];this.initializeParticipantsList=()=>{this.room.presence.get(t=>{t.forEach(e=>{this.unthrottledUpdatePresence3D(e.data)})})};this.onLocalParticipantJoined=t=>{var i;if(!t.slot||((i=t.slot)==null?void 0:i.index)===null){setTimeout(()=>{this.onLocalParticipantJoined(this.localParticipant)},2e3);return}if(!this.room.isJoined){setTimeout(()=>{this.onLocalParticipantJoined(t)},2e3);return}let{hasJoined3D:e}=this.useStore("presence-3d-store");e.publish(!0),this.room.emit("participant-joined",t),this.room.presence.update(t),this.initializeParticipantsList()};this.subscribeToRoomEvents=()=>{this.room.on("participant-joined",this.onJoinedRoom),this.room.presence.on(_.LEAVE,this.onLeaveRoom),this.room.presence.on(_.UPDATE,this.onParticipantUpdate),this.room.presence.on(_.JOINED_ROOM,this.onJoinedPresence)};this.unsubscribeFromRoomEvents=()=>{this.room.off("participant-joined",this.onJoinedRoom),this.room.presence.off(_.LEAVE),this.room.presence.off(_.UPDATE),this.room.presence.off(_.JOINED_ROOM)};this.onJoinedRoom=t=>{let{participants:e}=this.useStore("presence-3d-store"),i=e.value.find(s=>s.id===t.data.id);e.publish([...e.value.filter(s=>s.id!==t.data.id),y(y({},i),t.data)])};this.onLeaveRoom=t=>{if(t.id===this.localParticipant.id){this.unsubscribeFromRoomEvents(),this.useStore("presence-3d-store").destroy();return}let{participants:e}=this.useStore("presence-3d-store"),i=e.value.filter(s=>s.id!==t.id);e.publish(i)};this.unthrottledUpdatePresence3D=t=>{if(!(t!=null&&t.id))return;let{participants:e,hasJoined3D:i}=this.useStore("presence-3d-store"),s=y(y({},e.value.find(n=>n.id===t.id)),t);e.publish([...e.value.filter(n=>n.id!==t.id),s]),!(!i.value||s.id!==this.localParticipant.id)&&this.room.presence.update(s)};this.onJoinedPresence=t=>{t.id===this.localParticipant.id&&(this.logger.log("participant joined 3D room",t.id,this.localParticipant),this.onLocalParticipantJoined(this.localParticipant))};this.updatePresence3D=(0,eo.throttle)(t=>{this.unthrottledUpdatePresence3D(t)},$l);this.onParticipantUpdate=t=>{if(t.id===this.localParticipant.id)return;let{participants:e}=this.useStore("presence-3d-store"),i=y(y({},e.value.filter(n=>n.id===t.id)[0]),t.data),s=e.value.map(n=>n.id===t.id?i:n);e.publish(s),this.participants3DObservers[t.id]&&this.participants3DObservers[t.id].publish(i)};this.setParticipantData=t=>{this.updatePresence3D(t)};this.room=t,this.logger=new N("@superviz/sdk/presence3D-manager"),this.useStore=e,this.subscribeToRoomEvents();let{localParticipant:i}=this.useStore("global-store");i.subscribe(s=>{this.room.presence.update(s);let{participants:n}=this.useStore("presence-3d-store"),c=y(y({},n.value.find(o=>o.id===s.id)),s);n.publish([...n.value.filter(o=>o.id!==s.id),c]),this.localParticipant=c})}subscribeToUpdates(t,e){this.participants3DObservers[t]||(this.participants3DObservers[t]=new j({logger:this.logger})),this.participants3DObservers[t].subscribe(e)}unsubscribeFromUpdates(t,e){this.participants3DObservers[t]&&this.participants3DObservers[t].unsubscribe(e)}get getParticipants(){return this.useStore("presence-3d-store").participants.value}};m();m();var Ke=(i=>(i.HOST="host",i.GUEST="guest",i.AUDIENCE="audience",i))(Ke||{});var _i=class{constructor(t,e){this.room=t;this.useStore=e;this.isAssigningSlot=!1;this.slot={index:null,color:te.gray,textColor:"#fff",colorName:"gray",timestamp:Date.now()};this.onPresenceUpdate=t=>S(this,null,function*(){var i,s,n;let{localParticipant:e}=this.useStore("global-store");if(t.id===e.value.id){let c=yield this.validateSlotType(t.data);e.publish(L(y({},e.value),{slot:c}));return}if(!(((i=t.data.slot)==null?void 0:i.index)===null||this.slot.index===null)&&((s=t.data.slot)==null?void 0:s.index)===((n=this.slot)==null?void 0:n.index)){let c=yield this.assignSlot();e.publish(L(y({},e.value),{slot:c})),console.debug(`[SuperViz] - Slot reassigned to ${e.value.id}, slot: ${c.colorName}`)}});this.participantNeedsSlot=t=>{var c;let i=["formElements","whoIsOnline","presence","presence3dAutodesk","presence3dMatterport","presence3dThreejs","yjsProvider"].some(o=>{var a;return(a=t==null?void 0:t.activeComponents)==null?void 0:a.includes(o)}),s=((c=t==null?void 0:t.activeComponents)==null?void 0:c.includes("videoConference"))&&t.type!=="audience";return i||s};this.validateSlotType=t=>S(this,null,function*(){var i,s;if(this.isAssigningSlot)return this.slot;let e=this.participantNeedsSlot(t);if(((i=t.slot)==null?void 0:i.index)===null&&e){let n=yield this.assignSlot();this.slot=n}return((s=t.slot)==null?void 0:s.index)!==null&&!e&&this.setDefaultSlot(),this.slot});this.room=t,this.room.presence.on(_.UPDATE,this.onPresenceUpdate)}assignSlot(){return S(this,null,function*(){if(this.isAssigningSlot)return this.slot;this.isAssigningSlot=!0;let t=Array.from({length:50},(n,c)=>c),e=Math.floor(Math.random()*50),{localParticipant:i,participants:s}=q("global-store");try{yield new Promise((a,l)=>{this.room.presence.get(u=>{if((!u||!u.length)&&a(!0),u.length>=50){t=[],l(new Error("[SuperViz] - No more slots available"));return}u.forEach(p=>{p.id!==i.value.id&&(t=t.filter(d=>{var h,f;return d!==((f=(h=p.data)==null?void 0:h.slot)==null?void 0:f.index)}))}),a(!0)})}),!t.includes(e)&&(e=t.shift());let c=Object.keys(te)[e],o={index:e,color:te[c],textColor:is.includes(c)?"#fff":"#000",colorName:c,timestamp:Date.now()};return this.slot=o,i.publish(L(y({},i.value),{slot:o})),s.publish(L(y({},s.value),{[i.value.id]:L(y({},s.value[i.value.id]),{slot:o})})),this.room.presence.update({slot:o}),this.isAssigningSlot=!1,o}catch(n){return console.error(n),null}})}setDefaultSlot(){let{localParticipant:t,participants:e}=q("global-store"),i={index:null,color:te.gray,textColor:"#fff",colorName:"gray",timestamp:Date.now()};this.slot=i,t.publish(L(y({},t.value),{slot:i})),e.publish(L(y({},e.value),{[t.value.id]:L(y({},e.value[t.value.id]),{slot:i})})),this.room.presence.update({slot:i})}};m();var Br=class extends be{constructor({participant:e,group:i}){super();this.isDestroyed=!1;this.activeComponents=[];this.componentsToAttachAfterJoin=[];this.activeComponentsInstances=[];this.eventBus=new Ot;this.useStore=q.bind(this);this.addComponent=e=>S(this,null,function*(){if(!this.canAddComponent(e))return;let{hasJoinedRoom:i,group:s,localParticipant:n}=q("global-store");if(!i.value){this.logger.log("launcher service @ addComponent - not joined yet"),this.componentsToAttachAfterJoin.push(e);return}let c=qe.checkComponentLimit(e.name);e.attach({ioc:this.ioc,config:A.configuration,eventBus:this.eventBus,useStore:q,Presence3DManagerService:Ti,connectionLimit:c.maxParticipants}),this.activeComponents.push(e.name),this.activeComponentsInstances.some(o=>o.name===e.name)?this.activeComponentsInstances=this.activeComponentsInstances.map(o=>o.name===e.name?e:o):this.activeComponentsInstances.push(e),n.publish(L(y({},n.value),{activeComponents:this.activeComponents})),this.room.presence.update(L(y({},n.value),{slot:this.slotService.slot,activeComponents:this.activeComponents})),H.sendActivity(this.participant.id,s.value.id,s.value.name,e.name)});this.attachComponentsAfterJoin=()=>{this.logger.log("launcher service @ attachComponentsAfterJoin"),this.componentsToAttachAfterJoin.forEach(e=>{this.logger.log("launcher service @ attachComponentsAfterJoin - attaching component",e.name),this.addComponent(e)}),this.componentsToAttachAfterJoin=[]};this.removeComponent=e=>{if(!this.activeComponents.includes(e.name)){let i=`[SuperViz] Component ${e.name} is not initialized yet.`;this.logger.log(i),console.error(i);return}e.detach(),this.activeComponentsInstances=this.activeComponentsInstances.filter(i=>i.name!==e.name),this.activeComponents.splice(this.activeComponents.indexOf(e.name),1),this.room.presence.update(L(y({},this.participant),{activeComponents:this.activeComponents}))};this.destroy=()=>{var e,i,s,n,c,o;this.logger.log("launcher service @ destroy"),this.activeComponentsInstances.forEach(a=>{this.logger.log("launcher service @ destroy - removing component",a.name),this.removeComponent(a)}),this.activeComponents=[],this.activeComponentsInstances=[],(e=rt())==null||e.destroy(),(i=this.eventBus)==null||i.destroy(),this.eventBus=void 0,(s=this.room)==null||s.presence.off(_.JOINED_ROOM),(n=this.room)==null||n.presence.off(_.LEAVE),(c=this.room)==null||c.presence.off(_.UPDATE),(o=this.ioc)==null||o.destroy(),this.isDestroyed=!0,typeof window!="undefined"&&(window.SUPERVIZ=void 0)};this.canAddComponent=e=>{var o;let i=A.get(`features.${e.name}`),s=qe.checkComponentLimit(e.name),n=(o=this.activeComponents)==null?void 0:o.includes(e.name),c=[{isValid:i,message:`[SuperViz] Component ${e.name} is not enabled in the room`},{isValid:!this.isDestroyed,message:"[SuperViz] Component can not be added because the superviz room is destroyed. Initialize a new room to add and use components."},{isValid:!n,message:`[SuperViz] Component ${e.name} is already active. Please remove it first`},{isValid:s.canUse,message:`[SuperViz] You reached the limit usage of ${e.name}`}];for(let a=0;a<c.length;a++){let{isValid:l,message:u}=c[a];if(!l)return this.logger.log(u),console.error(u),!1}return!0};this.onAuthentication=e=>{e||(this.destroy(),console.error("[SuperViz] Room cannot be initialized because this website's domain is not whitelisted. If you are the developer, please add your domain in https://dashboard.superviz.com/developer"))};this.onLocalParticipantUpdateOnStore=e=>{this.participant=e,this.activeComponents=e.activeComponents||[]};this.onLocalParticipantUpdateOnCore=e=>{this.room&&this.room.presence.update(e)};this.onParticipantsListUpdateOnCore=e=>{let{participants:i}=this.useStore("global-store");i.publish(e)};this.onSameAccount=()=>{this.publish("participant.same-account-error"),this.destroy()};this.startIOC=()=>{this.logger.log("launcher service @ startIOC");let{participants:e}=q("global-store");this.ioc.stateSubject.subscribe(this.onConnectionStateChange),this.room.presence.get(i=>{let s={};i.forEach(n=>{s[n.id]=L(y({},n.data),{name:n.name,id:n.id,timestamp:n.timestamp})}),s[this.participant.id]=y(y({},s[this.participant.id]),this.participant),e.publish(s)}),this.room.presence.on(_.JOINED_ROOM,this.onParticipantJoinedIOC),this.room.presence.on(_.LEAVE,this.onParticipantLeaveIOC),this.room.presence.on(_.UPDATE,this.onParticipantUpdatedIOC)};this.onConnectionStateChange=e=>{if(e==="AUTH_ERROR"){this.onAuthentication(!1);return}e==="SAME_ACCOUNT_ERROR"&&this.onSameAccount()};this.onParticipantJoinedIOC=e=>S(this,null,function*(){if(e.id!==this.participant.id)return;this.room.presence.update(this.participant),this.logger.log("launcher service @ onParticipantJoined - local participant joined");let{hasJoinedRoom:i}=q("global-store");i.publish(!0),this.attachComponentsAfterJoin(),this.publish("participant.local-joined",this.participant),this.publish("participant.joined",this.participant)});this.onParticipantLeaveIOC=e=>{let{participants:i,localParticipant:s}=q("global-store"),n=y({},i.value);delete n[e.id],i.publish(n),e.id===s.value.id&&(this.logger.log("launcher service @ onParticipantLeave - local participant left"),this.publish("participant.local-left",e.data)),this.logger.log("launcher service @ onParticipantLeave - participant left",e.data),this.publish("participant.left",e.data),this.publish("participant.list-updated",Object.values(n))};this.onParticipantUpdatedIOC=e=>{let{localParticipant:i}=q("global-store");if(i.value&&e.id===i.value.id){let a=y(y({},i.value),e.data);i.publish(L(y({},a),{timestamp:e.timestamp})),this.publish("participant.updated",a),this.logger.log("Publishing ParticipantEvent.UPDATED",e.data)}let{participants:s}=q("global-store"),n=y({id:e.id,name:e.name,timestamp:e.timestamp},e.data);s.value[e.id]||this.publish("participant.joined",n);let c=Object.assign({},s.value);if(c[e.id]=n,(0,to.isEqual)(c,s.value))return;s.publish(c);let o=Object.values(s.value);this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",s.value),this.publish("participant.list-updated",o)};this.logger=new N("@superviz/sdk/launcher");let{localParticipant:s,group:n,isDomainWhitelisted:c}=this.useStore("global-store"),{localParticipant:o,participants:a}=this.useStore("core-store");s.publish(y({},e)),c.subscribe(this.onAuthentication),s.subscribe(this.onLocalParticipantUpdateOnStore),o.subscribe(this.onLocalParticipantUpdateOnCore),a.subscribe(this.onParticipantsListUpdateOnCore),n.publish(i),this.ioc=new wi(s.value),this.room=this.ioc.createRoom("launcher","unlimited"),this.slotService=new _i(this.room,this.useStore),s.publish(L(y({},s.value),{slot:this.slotService.slot,activeComponents:[]})),this.participant=s.value,this.eventBus=new Ot,this.logger.log("launcher created"),this.startIOC()}},io=r=>{if(typeof window!="undefined"&&window.SUPERVIZ)return console.warn("[SUPERVIZ] Room already initialized"),{destroy:window.SUPERVIZ.destroy,subscribe:window.SUPERVIZ.subscribe,unsubscribe:window.SUPERVIZ.unsubscribe,addComponent:window.SUPERVIZ.addComponent,removeComponent:window.SUPERVIZ.removeComponent};let t=new Br(r);return typeof window!="undefined"&&(window.SUPERVIZ=t),{destroy:t.destroy,subscribe:t.subscribe,unsubscribe:t.unsubscribe,addComponent:t.addComponent,removeComponent:t.removeComponent}};function ro(r){let t=/^.{2,64}$/,e=/^[-_&@+=,(){}\[\]\/.:|'"#a-zA-Z0-9-\s]*$/;return!(!t.test(r)||!e.test(r))}function Zl(r){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(r)}var Jl=({group:r,participant:t,roomId:e,customColors:i})=>{if(i&&ql(i),!r||!r.name||!r.id)throw new Error("[SuperViz] Group fields is required");if(!t||!t.id)throw new Error("[SuperViz] Participant id is required");if(!e)throw new Error("[SuperViz] Room id is required");if(!ro(e))throw new Error(`[SuperViz] Room id is invalid, it should be between 2 and 64 characters and only accept letters, numbers and special characters: -_&@+=,(){}[]/\xAB\xBB.:|'"`);if(!ro(t.id))throw new Error(`[SuperViz] Participant id is invalid, it should be between 2 and 64 characters and only accept letters, numbers and special characters: -_&@+=,(){}[]/\xAB\xBB.:|'"`);if(t.email&&!Zl(t.email))throw new Error("[SuperViz] Participant email is invalid")},ql=r=>{Object.entries(r).forEach(([t,e])=>{if(!Object.values(Ji).includes(t))throw new Error(`[SuperViz] Color ${t} is not a valid color variable name. Please check the documentation for more information.`);if(!/^(\d{1,3}\s){2}\d{1,3}$/.test(e))throw new Error(`[SuperViz] Color ${t} is not a valid color variable value. Please check the documentation for more information.`)})},Kl=r=>{r&&Object.entries(r).forEach(([t,e])=>{let i=e.replace(/\s/g,", ");document.documentElement.style.setProperty(`--${t}`,i)})},Yl=(r,t)=>S(void 0,null,function*(){var h,f,v,O,w;if(!(r&&r.trim()))throw new Error("API key is required");if(!t)throw new Error("Options is required");Jl(t),t.debug?Ur.debug.enable("*"):Ur.debug.disable();let[{apiUrl:i,conferenceLayerUrl:s},n]=yield Promise.all([Re.getRemoteConfig(t.environment),Re.getFeatures(r)]);if(!(yield Hs(i,r)))throw new Error("Failed to validate API key");let[o,a]=yield Promise.all([H.fetchWaterMark(i,r),H.fetchLimits(i,r)]).catch(()=>{throw new Error("[SuperViz] Failed to load configuration from server")}),{participant:l,roomId:u,customColors:p}=t;A.setConfig({apiUrl:i,apiKey:r,conferenceLayerUrl:s,environment:(h=t.environment)!=null?h:"prod",roomId:u,debug:t.debug,limits:a,waterMark:o,colors:p,features:n}),Kl(p);let d=yield H.fetchParticipant(l.id).catch(()=>null);if(!d&&!l.name)throw new Error("[SuperViz] - Participant does not exist, create the user in the API or add the name in the initialization to initialize the SuperViz room.");return d||(yield H.createParticipant({participantId:l.id,name:l==null?void 0:l.name,avatar:(f=l.avatar)==null?void 0:f.imageUrl,email:l==null?void 0:l.email})),io(L(y({},t),{participant:{id:l.id,name:(v=l.name)!=null?v:d==null?void 0:d.name,avatar:(O=l.avatar)!=null?O:d==null?void 0:d.avatar,email:(w=l.email)!=null?w:d==null?void 0:d.email}}))}),jr=Yl;m();typeof window!="undefined"&&typeof HTMLElement!="undefined"&&(import("./chunks/icon-3HSZY4BG.js"),import("./chunks/dropdown-OIZAL2LO.js"),import("./chunks/tooltip-JQUVL2QH.js"),import("./chunks/modal-YJCZEQ42.js"),import("./chunks/comments-MGTDGIFZ.js"),import("./chunks/topbar-ZPQKL3NR.js"),import("./chunks/content-BR3JBVI3.js"),import("./chunks/comment-item-7VNMGU4V.js"),import("./chunks/comment-input-VDWSGSQW.js"),import("./chunks/annotation-pin-K67PIXO5.js"),import("./chunks/annotation-item-VHKOJQVW.js"),import("./chunks/delete-comment-modal-JX3K2H44.js"),import("./chunks/annotation-resolved-6VJKFGWE.js"),import("./chunks/annotation-filter-E7SCYW2G.js"),import("./chunks/float-button-X32X4R7I.js"),import("./chunks/mention-list-PEJOF3VQ.js"),import("./chunks/who-is-online-4MQU4252.js"),import("./chunks/hello-world-DBOTV35Y.js"));m();m();function so(r){if(typeof document!="undefined"){let t=document.createElement("style");t.id="superviz-style";let e=document.createTextNode(r);t.appendChild(e),document.head.appendChild(t)}}var no=`@import"https://unpkg.com/@superviz/sv-icons@0.8.13/css/style.css";@import"https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap";:root{--sv-primary: 98, 16, 204}html,body{width:100%;height:100%;overflow:hidden}#sv-video-wrapper iframe{position:fixed;border:none;margin:0;padding:0;overflow:hidden;z-index:1000}#sv-video-wrapper iframe.sv-video-frame--right{top:var(--superviz-offset-top);right:var(--superviz-offset-right)}#sv-video-wrapper iframe.sv-video-frame--left{top:var(--superviz-offset-top);left:var(--superviz-offset-left)}#sv-video-wrapper iframe.sv-video-frame--bottom{bottom:var(--superviz-offset-bottom);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--top{top:var(--superviz-offset-top);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--no-overlay{display:none}.pointer-mouse{display:flex;height:15px;width:16px;background-image:url(https://production.cdn.superviz.com/static/pointers/0.svg);background-repeat:no-repeat}.mouse-user-name{display:block;position:absolute;border-radius:30px;padding:2px 8px;font-weight:700;font-size:14px;font-family:Roboto,sans-serif;line-height:22px;margin-left:10px;margin-top:-6px;background:#ff0;white-space:nowrap}.mouse-follower{position:absolute;display:block;z-index:2}
`;so(no);m();var St=(i=>(i.RIGHT="right",i.CENTER="center",i.LEFT="left",i))(St||{}),Ai=(e=>(e.GRID="grid",e.LIST="list",e))(Ai||{}),Oi=(s=>(s.RIGHT="right",s.LEFT="left",s.TOP="top",s.BOTTOM="bottom",s))(Oi||{});m();var Si=(e=>(e.STARTED="STARTED",e.STOPPED="STOPPED",e))(Si||{});var Mi=(t=>(t.REALTIME_STATE_CHANGED="realtime-component.state-changed",t))(Mi||{});m();var Li=(s=>(s.BLUR="field.blur",s.FOCUS="field.focus",s.CONTENT_CHANGE="field.content-change",s.INTERACTION="field.interaction",s))(Li||{});m();m();m();var X=class extends be{constructor(){super(...arguments);this.isAttached=!1;this.unsubscribeFrom=[];this.useStore=q.bind(this);this.attach=e=>{var a;if(Object.values(e).includes(null)||Object.values(e).includes(void 0)){let l=`${this.name} @ attach - params are required`;throw this.logger.log(l),new Error(l)}let{config:i,eventBus:s,ioc:n}=e,{isDomainWhitelisted:c,hasJoinedRoom:o}=this.useStore("global-store");if(!c.value){let l=`Component ${this.name} can't be used because this website's domain is not whitelisted. Please add your domain in https://dashboard.superviz.com/developer`;this.logger.log(l);return}if(A.setConfig(i),this.eventBus=s,this.isAttached=!0,this.ioc=n,this.connectionLimit=(a=e.connectionLimit)!=null?a:50,this.room=n.createRoom(this.name,this.connectionLimit),!o.value){this.logger.log(`${this.name} @ attach - not joined yet`),setTimeout(()=>{this.logger.log(`${this.name} @ attach - retrying`),this.attach(e)},1e3);return}this.logger.log(`${this.name} @ attached`),this.observers={},this.start(),this.publish("mount")};this.detach=()=>{if(!this.isAttached){this.logger.log(`${this.name} @ detach - component is not attached`);return}this.logger.log("detached"),this.publish("unmount"),this.destroy(),this.room.disconnect(),this.room=void 0,this.unsubscribeFrom.forEach(e=>e(this)),Object.values(this.observers).forEach(e=>{e.reset(),e.destroy()}),this.observers=void 0,this.isAttached=!1}}};var Mt=class extends X{constructor(e,i){var c,o,a;super();this.sidebarOpen=!1;this.layoutOptions={};this.openThreads=()=>{var e;this.sidebarOpen||((e=this.element)==null||e.setAttribute("open",""),this.sidebarOpen=!0,document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0})))};this.closeThreads=()=>{var e;this.sidebarOpen&&((e=this.element)==null||e.removeAttribute("open"),this.sidebarOpen=!1,document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0})))};this.togglePinActive=()=>{if(this.pinActive){this.disable();return}this.enable()};this.onPinFixed=e=>{this.coordinates=e};this.toggleAnnotationSidebar=()=>{this.element.toggleAttribute("open"),this.sidebarOpen=this.element.hasAttribute("open"),document.body.dispatchEvent(new CustomEvent("prepare-to-create-annotation",{detail:void 0,composed:!0,bubbles:!0})),document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0}))};this.onSelectAnnotation=e=>{this.sidebarOpen||this.toggleAnnotationSidebar()};this.positionFloatingButton=()=>{var a,l;this.button=document.createElement("superviz-comments-button");let e=(a=this.layoutOptions)==null?void 0:a.buttonLocation,i=(l=this.layoutOptions)==null?void 0:l.position;if(!e){document.body.appendChild(this.button),this.button.commentsPosition=i;return}let s="",n=Object.values(rs),c=!1,o=!n.includes(e.toLocaleLowerCase());if(o){let u=window.document.body.querySelector(`#${e}`);u?(u.appendChild(this.button),s="position: relative"):(c=!0,e="top-left")}if(!o||c){document.body.appendChild(this.button);let[u,p]=e.split("-");s=`${u}: 20px; ${p}: 20px;`}this.button.positionStyles=s,this.button.commentsPosition=i};this.positionComments=()=>{var s;this.element=document.createElement("superviz-comments"),this.element.setAttribute("comments",JSON.stringify([])),this.element.side="left",this.element.offset=this.offset,document.body.appendChild(this.element);let e=(s=this.layoutOptions)==null?void 0:s.position;if(!e)return;let i=e.toUpperCase();$i[i]&&(this.element.side=$i[i])};this.createAnnotation=i=>S(this,[i],function*({detail:e}){try{let{text:s,mentions:n}=e,c=y({},this.coordinates),o=yield H.createAnnotations(A.get("apiUrl"),A.get("apiKey"),{roomId:A.get("roomId"),position:JSON.stringify(c),userId:this.localParticipantId}),a=yield this.createComment(o.uuid,s,n);this.addAnnotation(L(y({},o),{comments:[a]})),this.pinAdapter.removeAnnotationPin("temporary-pin"),document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:o.uuid,haltGoToPin:!0,newPin:!0},composed:!0,bubbles:!0}))}catch(s){this.logger.log("error when creating annotation",s)}});this.deleteAnnotation=i=>S(this,[i],function*({detail:e}){try{let{uuid:s}=e;yield H.deleteAnnotation(A.get("apiUrl"),A.get("apiKey"),s);let n=this.annotations.filter(c=>c.uuid!==s);this.updateAnnotationList(n),this.pinAdapter.removeAnnotationPin(s),this.element.updateAnnotations(this.annotations)}catch(s){this.logger.log("error when deleting annotation",s)}});this.updateComment=i=>S(this,[i],function*({detail:e}){try{let{uuid:s,text:n,mentions:c}=e,o=yield H.updateComment(A.get("apiUrl"),A.get("apiKey"),s,n);yield H.createMentions({commentsId:o.uuid,participants:c.map(l=>({id:l.userId}))});let a=this.annotations.map(l=>Object.assign({},l,{comments:l.comments.map(u=>u.uuid===s?Object.assign({},u,{text:n,mentions:c}):u)}));this.updateAnnotationList(a)}catch(s){this.logger.log("error when updating comment",s)}});this.resolveAnnotation=i=>S(this,[i],function*({detail:e}){try{let{uuid:s}=e,{resolved:n}=yield H.resolveAnnotation(A.get("apiUrl"),A.get("apiKey"),s),c=this.annotations.map(o=>o.uuid===s?Object.assign({},o,{resolved:n}):o);if(this.updateAnnotationList(c),n){this.pinAdapter.removeAnnotationPin(s);return}this.pinAdapter.updateAnnotations(this.annotations)}catch(s){this.logger.log("error when resolve annotation",s)}});this.deleteComment=i=>S(this,[i],function*({detail:e}){try{let{uuid:s,annotationId:n}=e;if(!s||!n)return;yield H.deleteComment(A.get("apiUrl"),A.get("apiKey"),s);let c=this.annotations.find(a=>a.uuid===n);c.comments=c.comments.filter(a=>a.uuid!==s);let o=this.annotations.map(a=>a.uuid===n?c:a);this.element.updateAnnotations(o),this.updateAnnotationList(o)}catch(s){this.logger.log("error when deleting comment",s)}});this.onAnnotationListUpdate=e=>{let{data:i,clientId:s}=e;this.localParticipantId!==s&&(this.annotations=i,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations))};this.name="comments",this.logger=new N("@superviz/sdk/comments-component"),this.annotations=[],this.layoutOptions={buttonLocation:(c=i==null?void 0:i.buttonLocation)!=null?c:"top-left",position:(o=i==null?void 0:i.position)!=null?o:"left"},this.hideDefaultButton=(a=i==null?void 0:i.hideDefaultButton)!=null?a:!1,this.setStyles(i==null?void 0:i.styles),this.offset=i==null?void 0:i.offset,setTimeout(()=>{var l,u;e.setCommentsMetadata((u=(l=this.layoutOptions)==null?void 0:l.position)!=null?u:"left")}),this.pinAdapter=e;let{group:s,localParticipant:n}=this.useStore("global-store");s.subscribe(),n.subscribe(l=>{this.localParticipantId=l.id})}enable(){this.pinAdapter.setActive(!0),this.pinActive=!0,this.publish("pin-mode.active"),document.body.dispatchEvent(new CustomEvent("toggle-pin-active",{detail:{isActive:!0}}))}disable(){this.pinAdapter.setActive(!1),this.pinActive=!1,this.publish("pin-mode.inactive"),document.body.dispatchEvent(new CustomEvent("toggle-pin-active",{detail:{isActive:!1}}))}start(){typeof window!="undefined"&&(this.clientUrl=window.location.href,this.positionComments(),this.hideDefaultButton||this.positionFloatingButton(),this.fetchAnnotations(),this.waterMarkState(),this.participantsList(),this.addListeners(),this.pinAdapter.setPinsVisibility(!0))}destroy(){var e;this.logger.log("comments component @ destroy"),this.destroyListeners(),(e=this.button)==null||e.remove(),this.element.remove(),this.element=void 0,this.pinAdapter.destroy()}addListeners(){var e;(e=this.button)==null||e.addEventListener("toggle",this.togglePinActive),this.element.addEventListener("close-threads",this.closeThreads),document.body.addEventListener("create-annotation",this.createAnnotation),this.element.addEventListener("resolve-annotation",this.resolveAnnotation),this.element.addEventListener("delete-annotation",this.deleteAnnotation),this.element.addEventListener("create-comment",({detail:i})=>{this.createComment(i.uuid,i.text,i.mentions,!0)}),this.element.addEventListener("update-comment",this.updateComment),this.element.addEventListener("delete-comment",this.deleteComment),document.body.addEventListener("select-annotation",this.onSelectAnnotation),this.room.on("update-comments",this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.subscribe(this.onPinFixed)}destroyListeners(){var e;(e=this.button)==null||e.removeEventListener("toggle",this.togglePinActive),this.element.removeEventListener("close-threads",this.closeThreads),this.element.removeEventListener("resolve-annotation",this.resolveAnnotation),this.element.removeEventListener("create-comment",({detail:i})=>{this.createComment(i.uuid,i.text,i.mentions,!0)}),this.element.removeEventListener("update-comment",this.updateComment),this.element.removeEventListener("delete-comment",this.deleteComment),document.body.removeEventListener("select-annotation",this.onSelectAnnotation),document.body.removeEventListener("create-annotation",this.createAnnotation),this.room.off("update-comments",this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.unsubscribe(this.onPinFixed)}setStyles(e=""){if(!e)return;let i=document.createElement("style");i.textContent=e,i.id="superviz-comments-styles",document.head.appendChild(i)}createComment(c,o){return S(this,arguments,function*(e,i,s=[],n=!1){try{let a=yield H.createComment(A.get("apiUrl"),A.get("apiKey"),{annotationId:e,userId:this.localParticipantId,text:i});return yield H.createMentions({commentsId:a.uuid,participants:s.map(l=>({id:l.userId,readed:0}))}),a.mentions=s,n&&this.addComment(e,a),a}catch(a){this.logger.log("error when creating comment",a)}})}addAnnotation(e){let i=[e,...this.annotations];this.element.updateAnnotations(i),this.pinAdapter.updateAnnotations(i),this.updateAnnotationList(i)}updateAnnotationList(e){this.annotations=e,this.room.emit("update-comments",e)}addComment(e,i){let s=this.annotations.find(c=>c.uuid===e);s.comments.push(i);let n=this.annotations.map(c=>c.uuid===e?s:c);this.updateAnnotationList(n),this.element.updateAnnotations(n)}fetchAnnotations(){return S(this,null,function*(){try{let e=yield H.fetchAnnotation(A.get("apiUrl"),A.get("apiKey"),{roomId:A.get("roomId")});this.annotations=e,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations)}catch(e){this.logger.log("error when fetching annotations",e)}})}waterMarkState(){return S(this,null,function*(){try{let e=yield H.fetchWaterMark(A.get("apiUrl"),A.get("apiKey"));this.element.waterMarkStatus(e)}catch(e){this.logger.log("error when fetching waterMark",e)}})}participantsList(){return S(this,null,function*(){try{let i=(yield H.fetchParticipantsByGroup(this.group.id)).data;this.pinAdapter.participantsList=i,this.element.participantsList=i}catch(e){this.logger.log("error when fetching participantsList",e)}})}};m();var Lt=class{constructor(t,e){this.isPinsVisible=!0;this.selectedPin=null;this.temporaryPinCoordinates=null;this.commentsSide="left";this.setCommentsMetadata=t=>{this.commentsSide=t};this.resetPins=t=>{t&&(t==null?void 0:t.key)!=="Escape"||(this.resetSelectedPin(),this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)};this.animate=()=>{(this.isActive||this.isPinsVisible)&&(this.renderAnnotationsPins(),this.divWrapper=this.renderDivWrapper()),this.temporaryPinCoordinates&&this.renderTemporaryPin(),this.animateFrame=requestAnimationFrame(this.animate)};this.setMouseDownCoordinates=({x:t,y:e})=>{this.mouseDownCoordinates={x:t,y:e}};this.annotationSelected=({detail:{uuid:t,haltGoToPin:e,newPin:i}})=>{var c,o;if(!t)return;i&&this.pins.get(t).setAttribute("newPin","");let s=JSON.parse((o=(c=this.selectedPin)==null?void 0:c.getAttribute("annotation"))!=null?o:"{}");if(this.resetPins(),(s==null?void 0:s.uuid)===t)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let n=this.pins.get(t);n&&(n.setAttribute("active",""),this.selectedPin=n,!e&&this.goToPin(t))};this.onClick=t=>{if(!this.isActive)return;let e=this.canvas.getBoundingClientRect(),{x:i,y:s}=this.mouseDownCoordinates,n=i-e.x,c=s-e.y,o=t.clientX-e.left,a=t.clientY-e.top;if(Math.hypot(o-n,a-c)>10)return;let d=this.canvas.getContext("2d").getTransform().inverse(),h=new DOMPoint(o,a-31).matrixTransform(d);this.onPinFixedObserver.publish({x:h.x,y:h.y,type:"canvas"}),this.resetSelectedPin(),this.temporaryPinCoordinates={x:h.x,y:h.y},this.renderTemporaryPin();let f=document.getElementById("superviz-temporary-pin");this.movedTemporaryPin=!this.movedTemporaryPin,f.setAttribute("movedPosition",String(this.movedTemporaryPin)),!this.selectedPin&&document.body.dispatchEvent(new CustomEvent("unselect-annotation"))};this.onToggleAnnotationSidebar=({detail:t})=>{let{open:e}=t;e||(this.pins.forEach(i=>{i.removeAttribute("active")}),this.pins.has("temporary-pin")&&this.removeAnnotationPin("temporary-pin"))};this.hideTemporaryPin=t=>{var p;let e=t.target,i=e.contains(this.canvas),{x:s,y:n}=t,{left:c,top:o,right:a,bottom:l}=this.canvas.getBoundingClientRect(),u=s>c&&s<a&&n>o&&n<l;this.canvas.contains(e)||(p=this.pins.get("temporary-pin"))!=null&&p.contains(e)||i&&u||(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)};if(this.logger=new N("@superviz/sdk/comments-component/canvas-pin-adapter"),this.canvas=document.getElementById(t),this.isActive=!1,this.pins=new Map,this.goToPinCallback=e==null?void 0:e.onGoToPin,!this.canvas){let i=`Canvas with id ${t} not found`;throw this.logger.log(i),new Error(i)}this.canvasSides=this.canvas.getBoundingClientRect(),document.body.style.position="relative",this.onPinFixedObserver=new j({logger:this.logger}),this.divWrapper=this.renderDivWrapper(),this.annotations=[],this.renderAnnotationsPins(),this.animateFrame=requestAnimationFrame(this.animate),document.body.addEventListener("select-annotation",this.annotationSelected),document.body.addEventListener("keyup",this.resetPins)}destroy(){this.isActive=!1,this.removeListeners(),this.removeAnnotationsPins(),this.pins=new Map,this.divWrapper.remove(),this.divWrapper=null,this.onPinFixedObserver.destroy(),this.onPinFixedObserver=null,this.canvas.style.cursor="default",this.annotations=[],cancelAnimationFrame(this.animateFrame),document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("keyup",this.resetPins)}setPinsVisibility(t){if(this.isPinsVisible=t,this.isPinsVisible){this.renderAnnotationsPins();return}this.removeAnnotationsPins()}setActive(t){if(this.isActive!==t){if(this.isActive=t,this.isActive){this.originalCanvasCursor=this.canvas.style.cursor,this.canvas.style.cursor='url("https://production.cdn.superviz.com/static/pin-html.png") 0 100, pointer',this.addListeners();return}this.resetPins(),this.removeListeners(),this.canvas.style.cursor=this.originalCanvasCursor}}updateAnnotations(t){this.logger.log("updateAnnotations",t),this.annotations=t,!(!this.isActive&&!this.isPinsVisible)&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}removeAnnotationPin(t){let e=this.pins.get(t);e&&(e.remove(),this.pins.delete(t),t!=="temporary-pin"&&(this.annotations=this.annotations.filter(i=>i.uuid!==t)))}renderTemporaryPin(){let t=document.getElementById("superviz-temporary-pin");t||(t=document.createElement("superviz-comments-annotation-pin"),t.id="superviz-temporary-pin",t.setAttribute("type","add"),t.setAttribute("showInput",""),t.setAttribute("containerSides",JSON.stringify(this.canvasSides)),t.setAttribute("commentsSide",this.commentsSide),t.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),t.setAttribute("annotation",JSON.stringify({})),t.setAttribute("participantsList",JSON.stringify(this.participants)),t.setAttributeNode(document.createAttribute("active")),this.divWrapper.appendChild(t));let{x:e,y:i}=this.temporaryPinCoordinates,n=this.canvas.getContext("2d").getTransform(),c=n.e,o=n.f,a=n.a,l=n.d,u=e*a+c,p=i*l+o;t.setAttribute("position",JSON.stringify({x:u,y:p})),this.pins.set("temporary-pin",t)}addListeners(){this.canvas.addEventListener("click",this.onClick),this.canvas.addEventListener("mousedown",this.setMouseDownCoordinates),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){this.canvas.removeEventListener("click",this.onClick),this.canvas.removeEventListener("mousedown",this.setMouseDownCoordinates),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}resetSelectedPin(){this.selectedPin&&(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}renderDivWrapper(){let t=this.canvas.getBoundingClientRect(),e=this.divWrapper;return e||(e=document.createElement("div"),e.id="superviz-canvas-wrapper",["","static"].includes(this.canvas.parentElement.style.position)&&(this.canvas.parentElement.style.position="relative")),e.style.position="absolute",e.style.top=`${this.canvas.offsetTop}px`,e.style.left=`${this.canvas.offsetLeft}px`,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`,e.style.pointerEvents="none",e.style.overflow="hidden",document.getElementById("superviz-canvas-wrapper")||this.canvas.parentElement.appendChild(e),e}renderAnnotationsPins(){if((!this.annotations.length||this.canvas.style.display==="none")&&!this.pins.get("temporary-pin")){this.removeAnnotationsPins();return}this.annotations.forEach(t=>{if(t.resolved)return;let e=JSON.parse(t.position);if((e==null?void 0:e.type)!=="canvas")return;let{x:i,y:s}=e,c=this.canvas.getContext("2d").getTransform(),o=c.e,a=c.f,l=c.a,u=c.d,p=i*l+o,d=s*u+a;if(this.pins.has(t.uuid)){let f=this.pins.get(t.uuid);if(this.divWrapper.clientWidth>p&&this.divWrapper.clientHeight>d){f.setAttribute("style","opacity: 1"),this.pins.get(t.uuid).setAttribute("position",JSON.stringify({x:p,y:d}));return}f.setAttribute("style","opacity: 0");return}let h=document.createElement("superviz-comments-annotation-pin");h.setAttribute("type","show"),h.setAttribute("participantsList",JSON.stringify(this.participants)),h.setAttribute("annotation",JSON.stringify(t)),h.setAttribute("position",JSON.stringify({x:p,y:d})),h.id=t.uuid,this.divWrapper.appendChild(h),this.pins.set(t.uuid,h)})}removeAnnotationsPins(){this.pins.forEach(t=>{t.remove()}),this.pins.clear()}set participantsList(t){this.participants=t}goToPin(t){let e=this.annotations.find(h=>h.uuid===t);if(!e)return;let i=JSON.parse(e.position);if((i==null?void 0:i.type)!=="canvas")return;let s=this.canvas.getBoundingClientRect(),{width:n,height:c}=s,{x:o,y:a}=i,l=n/2,u=c/2,p=l-o,d=u-a;this.goToPinCallback&&this.goToPinCallback({x:p,y:d})}};m();var oo=pe(tt());var Rt=class{constructor(t,e={}){this.isPinsVisible=!0;this.selectedPin=null;this.dataAttribute="data-superviz-id";this.commentsSide="left";this.temporaryPinCoordinates={};this.elementsWithDataId={};this.divWrappers=new Map;this.voidElementsWrappers=new Map;this.VOID_ELEMENTS=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr","svg","rect","ellipse"];this.animate=()=>{this.voidElementsWrappers&&(this.updatePinsPositions(),this.animateFrame=requestAnimationFrame(this.animate))};this.setCommentsMetadata=t=>{this.commentsSide=t};this.hideTemporaryPin=t=>{var c;let e=t.target,i=this.divWrappers.get(this.temporaryPinCoordinates.elementId);if(!i)return;let s=i.contains(e),n=(c=this.pins.get("temporary-pin"))==null?void 0:c.contains(e);s||n||(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates={})};this.resetPins=t=>{t&&(t==null?void 0:t.key)!=="Escape"||(this.resetSelectedPin(),this.resetHoveredWrapper(),this.temporaryPinCoordinates.elementId&&(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates={}))};this.annotationSelected=({detail:{uuid:t,newPin:e}})=>{if(!t)return;e&&this.pins.get(t).setAttribute("newPin","");let i=this.annotations.find(c=>{var o;return c.uuid===((o=this.selectedPin)==null?void 0:o.id)});if(this.resetPins(),(i==null?void 0:i.uuid)===t)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let s=this.pins.get(t);if(!s)return;s.setAttribute("active",""),this.selectedPin=s;let n=this.annotations.find(c=>c.uuid===t);this.selectedPin.setAttribute("elementId",JSON.parse(n.position).elementId)};this.onClick=t=>{if(!this.isActive||t.target===this.pins.get("temporary-pin"))return;let e=t.target,i=t.currentTarget;if(e!==i&&this.pins.has(e.id))return;let s=i.getAttribute("data-wrapper-id"),n=i.getBoundingClientRect(),{x:c,y:o}=this.mouseDownCoordinates,a=t.clientX-n.left,l=t.clientY-n.top,u=c-n.x,p=o-n.y;if(Math.hypot(a-u,l-p)>10)return;let{width:h,height:f}=i.getBoundingClientRect(),v=32,O=i.getBoundingClientRect().width/i.offsetWidth||1;a=a*100/h,l=(l-v*O)*100/f,this.onPinFixedObserver.publish({x:a,y:l,type:"html",elementId:s}),this.resetSelectedPin(),this.temporaryPinCoordinates=L(y({},this.temporaryPinCoordinates),{x:a,y:l}),this.renderTemporaryPin(s);let w=this.pins.get("temporary-pin");this.movedTemporaryPin=!this.movedTemporaryPin,w.setAttribute("movedPosition",String(this.movedTemporaryPin)),document.body.dispatchEvent(new CustomEvent("unselect-annotation"))};this.onMouseDown=({x:t,y:e})=>{this.mouseDownCoordinates={x:t,y:e}};this.handleMutationObserverChanges=t=>{t.forEach(e=>{var l;let{target:i,oldValue:s}=e,n=i.getAttribute(this.dataAttribute);if(!n&&!s||n===s)return;let c=this.dataAttributeValueFilters.some(u=>s.match(u));if(!n&&s&&!c){this.removeAnnotationPin("temporary-pin"),this.clearElement(s),((l=this.selectedPin)==null?void 0:l.getAttribute("elementId"))===s&&(document.body.dispatchEvent(new CustomEvent("unselect-annotation")),this.selectedPin=null);return}let a=this.dataAttributeValueFilters.some(u=>n.match(u));(s&&this.elementsWithDataId[s]||a)&&this.clearElement(s),!a&&(this.setElementReadyToPin(i,n),this.renderAnnotationsPins())})};this.onToggleAnnotationSidebar=({detail:t})=>{let{open:e}=t;e||(this.resetSelectedPin(),this.pins.has("temporary-pin")&&(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates.elementId=void 0))};this.onMouseEnter=t=>{var n;let e=t.target;if(this.hoveredWrapper=e,!((n=e.getAttribute("data-wrapper-type"))==null?void 0:n.includes("ellipse"))){this.hoveredWrapper.style.setProperty("outline","1px solid rgb(var(--sv-primary))");return}let s=e.querySelector("ellipse");s.setAttribute("stroke","rgb(var(--sv-primary))"),s.setAttribute("stroke-width","1")};this.onMouseLeave=t=>{var n;let e=t.target;if(this.hoveredWrapper=e,!((n=e.getAttribute("data-wrapper-type"))==null?void 0:n.includes("ellipse"))){this.hoveredWrapper.style.setProperty("outline","");return}let s=e.querySelector("ellipse");s.removeAttribute("stroke"),s.removeAttribute("stroke-width")};if(this.logger=new N("@superviz/sdk/comments-component/container-pin-adapter"),this.container=document.getElementById(t),!this.container){let n=`Element with id ${t} not found`;throw this.logger.log(n),new Error(n)}if(typeof e!="object")throw new Error("Second argument of the HTMLPin constructor must be an object");let{dataAttributeName:i,dataAttributeValueFilters:s}=e;if(i==="")throw new Error("dataAttributeName must be a non-empty string");if(i===null)throw new Error("dataAttributeName cannot be null");if(i!==void 0&&typeof i!="string")throw new Error("dataAttributeName must be a non-empty string");this.dataAttribute=i||this.dataAttribute,this.dataAttributeValueFilters=s||[],this.isActive=!1,this.prepareElements(),this.mutationObserver=new MutationObserver(this.handleMutationObserverChanges),this.observeContainer(),this.pins=new Map,this.onPinFixedObserver=new j({logger:this.logger}),this.annotations=[],document.body.addEventListener("select-annotation",this.annotationSelected),document.body.addEventListener("keyup",this.resetPins),this.voidElementsWrappers.size&&(this.animateFrame=requestAnimationFrame(this.animate))}destroy(){var t;this.logger.log("Destroying HTML Pin Adapter for Comments"),this.removeListeners(),this.removeObservers(),this.divWrappers.forEach(e=>e.remove()),this.divWrappers.clear(),this.pins.forEach(e=>e.remove()),this.pins.clear(),this.divWrappers=void 0,this.pins=void 0,this.elementsWithDataId=void 0,this.logger=void 0,this.onPinFixedObserver.destroy(),this.onPinFixedObserver=void 0,this.container=void 0,this.voidElementsWrappers.clear(),this.voidElementsWrappers=void 0,this.annotations=[],(t=this.svgWrappers)==null||t.remove(),this.svgWrappers=void 0,document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),cancelAnimationFrame(this.animateFrame)}addElementListeners(t){this.divWrappers.get(t).addEventListener("click",this.onClick,!0),this.divWrappers.get(t).addEventListener("mousedown",this.onMouseDown),this.divWrappers.get(t).addEventListener("mouseenter",this.onMouseEnter),this.divWrappers.get(t).addEventListener("mouseleave",this.onMouseLeave)}removeElementListeners(t){this.divWrappers.get(t).removeEventListener("click",this.onClick,!0),this.divWrappers.get(t).removeEventListener("mousedown",this.onMouseDown),this.divWrappers.get(t).removeEventListener("mouseenter",this.onMouseEnter),this.divWrappers.get(t).removeEventListener("mouseleave",this.onMouseLeave)}set participantsList(t){this.participants=t}removeObservers(){this.mutationObserver.disconnect(),this.mutationObserver=void 0}addListeners(){this.divWrappers.forEach((t,e)=>this.addElementListeners(e)),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){this.divWrappers.forEach((t,e)=>this.removeElementListeners(e)),document.body.removeEventListener("keyup",this.resetPins),document.body.removeEventListener("click",this.hideTemporaryPin)}observeContainer(){this.mutationObserver.observe(this.container,{subtree:!0,attributes:!0,attributeFilter:[this.dataAttribute],attributeOldValue:!0})}prepareElements(){this.container.querySelectorAll(`[${this.dataAttribute}]`).forEach(e=>{let i=e.getAttribute(this.dataAttribute);this.dataAttributeValueFilters.some(n=>i.match(n))||this.setElementReadyToPin(e,i)})}addAllCursors(){this.divWrappers.forEach((t,e)=>{this.addCursor(t,e)})}removeAddCursor(){this.divWrappers.forEach((t,e)=>{let i=t,s=t.getAttribute("data-wrapper-type");if(s){let n=s.split("-")[1];i=this.divWrappers.get(e).querySelector(n)}i.style.setProperty("cursor","default"),i.style.setProperty("pointer-events","none")})}setPinsVisibility(t){this.isPinsVisible=t,this.isPinsVisible&&this.renderAnnotationsPins(),this.removeAnnotationsPins()}removeAnnotationPin(t){let e=this.pins.get(t);!e&&t==="temporary-pin"||(e&&(e.remove(),this.pins.delete(t)),t!=="temporary-pin"&&(this.annotations=this.annotations.filter(i=>i.uuid!==t)))}updateAnnotations(t){this.logger.log("updateAnnotations",t),this.annotations=t,this.isPinsVisible&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}setActive(t){if(this.isActive!==t){if(this.isActive=t,this.isActive){this.addListeners(),this.addAllCursors(),this.prepareElements();return}this.resetPins(),this.removeListeners(),this.removeAddCursor()}}renderTemporaryPin(t){var n,c;(n=this.temporaryPinCoordinates).elementId||(n.elementId=t);let e=this.pins.get("temporary-pin");if(t&&t!==this.temporaryPinCoordinates.elementId&&(this.pins.get("temporary-pin").remove(),this.pins.delete("temporary-pin"),this.temporaryPinCoordinates.elementId=t,e=null),!e){let o=(c=this.elementsWithDataId[t])==null?void 0:c.getBoundingClientRect();e=document.createElement("superviz-comments-annotation-pin"),e.id="superviz-temporary-pin",e.setAttribute("type","add"),e.setAttribute("showInput",""),e.setAttribute("containerSides",JSON.stringify(o)),e.setAttribute("commentsSide",this.commentsSide),e.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),e.setAttribute("annotation",JSON.stringify({})),e.setAttribute("participantsList",JSON.stringify(this.participants)),e.setAttribute("keepPositionRatio",""),e.setAttributeNode(document.createAttribute("active")),this.addTemporaryPinToElement(t,e)}let{x:i,y:s}=this.temporaryPinCoordinates;e.setAttribute("position",JSON.stringify({x:i,y:s})),this.pins.set("temporary-pin",e)}renderAnnotationsPins(){if(!this.annotations.length){this.removeAnnotationsPins();return}this.annotations.forEach(t=>{if(t.resolved)return;let{x:e,y:i,elementId:s,type:n}=JSON.parse(t.position);if(n!=="html"||this.pins.has(t.uuid)||!this.elementsWithDataId[s])return;let o=this.divWrappers.get(s);if(!o)return;let a=this.createPin(t,e,i);o.appendChild(a),this.pins.set(t.uuid,a)})}updatePinsPositions(){this.voidElementsWrappers.forEach((t,e)=>{let i=JSON.stringify(t.getBoundingClientRect()),s=this.elementsWithDataId[e].getBoundingClientRect();this.elementsWithDataId[e].tagName.toLowerCase()==="ellipse"&&(s=this.elementsWithDataId[e].viewportElement.getBoundingClientRect()),!(0,oo.isEqual)(JSON.stringify(s),i)&&(t.style.setProperty("top",`${s.top}px`),t.style.setProperty("left",`${s.left}px`),t.style.setProperty("width",`${s.width}px`),t.style.setProperty("height",`${s.height}px`))})}clearElement(t){if(!this.elementsWithDataId[t])return;let i=this.divWrappers.get(t);if(i){let s=i.children,{length:n}=s;for(let c=0;c<n;++c){let o=s.item(c);this.pins.delete(o.id)}i.remove()}this.voidElementsWrappers.delete(t),this.removeElementListeners(t),this.divWrappers.delete(t),this.elementsWithDataId[t]=void 0,this.voidElementsWrappers.size||(cancelAnimationFrame(this.animateFrame),this.animateFrame=void 0)}resetSelectedPin(){this.selectedPin&&(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}resetHoveredWrapper(){this.hoveredWrapper&&this.onMouseLeave({target:this.hoveredWrapper})}removeAnnotationsPins(){this.pins.forEach(t=>{t.remove()}),this.pins.clear()}setElementReadyToPin(t,e){if(!this.elementsWithDataId[e]){if(this.elementsWithDataId[e]=t,!this.divWrappers.get(e)){let i=this.createWrapper(t,e);this.divWrappers.set(e,i)}!this.isActive||!this.isPinsVisible||(this.addCursor(this.divWrappers.get(e),e),this.addElementListeners(e))}}handleSvgElement(t,e){let i=t.viewportElement;if(i===void 0)return;if(t.tagName.toLowerCase()==="svg"){let w=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return w.setAttribute("height","100%"),w.setAttribute("width","100%"),w.style.setProperty("overflow","visible"),w.appendChild(e),t.appendChild(w),t.style.setProperty("overflow","visible"),e}let c=t.tagName.toLowerCase(),o=c==="ellipse",a=c==="rect";if(!o&&!a)return;let l=document.createElementNS("http://www.w3.org/2000/svg","svg"),u=document.createElementNS("http://www.w3.org/2000/svg",c),p,d,h,f,v,O;if(a){let w=t;p=w.getAttribute("x"),d=w.getAttribute("y"),h=w.getAttribute("width"),f=w.getAttribute("height"),v=w.getAttribute("rx"),O=w.getAttribute("ry"),u.setAttribute("fill","transparent"),u.setAttribute("stroke","transparent"),u.setAttribute("x","0"),u.setAttribute("y","0"),u.setAttribute("rx",v),u.setAttribute("ry",O)}if(o){let w=t.getAttribute("cx"),G=t.getAttribute("cy");v=t.getAttribute("rx"),O=t.getAttribute("ry"),p=Number(w)-Number(v),d=Number(G)-Number(O);let{width:W,height:V}=i.getBoundingClientRect();h=`${W}px`,f=`${V}px`,u.setAttribute("fill","transparent"),u.setAttribute("stroke","transparent"),u.setAttribute("cx",w),u.setAttribute("cy",G),u.setAttribute("rx",v),u.setAttribute("ry",O)}return u.setAttribute("height",f),u.setAttribute("width",h),l.setAttribute("height",f),l.setAttribute("width",h),l.appendChild(u),e.appendChild(l),t.style.setProperty("overflow","visible"),e.setAttribute("data-wrapper-type",`svg-${c}`),e}addTemporaryPinToElement(t,e){if(!this.elementsWithDataId[t])return;let s=this.divWrappers.get(t);s&&s.appendChild(e)}createPin(t,e,i){let s=document.createElement("superviz-comments-annotation-pin");return s.setAttribute("type","show"),s.setAttribute("annotation",JSON.stringify(t)),s.setAttribute("position",JSON.stringify({x:e,y:i})),s.setAttribute("keepPositionRatio",""),s.setAttribute("participantsList",JSON.stringify(this.participants)),s.id=t.uuid,s}addCursor(t,e){let i=t,s=t.getAttribute("data-wrapper-type");if(s){let n=s.split("-")[1];i=this.divWrappers.get(e).querySelector(n)}i.style.setProperty("cursor",'url("https://production.cdn.superviz.com/static/pin-html.png") 0 100, pointer'),i.style.setProperty("pointer-events","auto")}createWrapper(t,e){var a;let i=`superviz-id-${e}`;if(this.divWrappers.get(e))return;let s=t.getBoundingClientRect(),n=document.createElement("div");n.setAttribute("data-wrapper-id",e),n.id=i,n.style.position="absolute",n.style.pointerEvents="none",n.style.transform="translateX(0) translateY(0) scale(1)",n.style.cursor="default",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none";let c=window.getComputedStyle(t).getPropertyValue("border-radius");if(n.style.borderRadius=c,!this.VOID_ELEMENTS.includes(this.elementsWithDataId[e].tagName.toLowerCase()))return this.elementsWithDataId[e].appendChild(n),this.setPositionNotStatic(this.elementsWithDataId[e]),n;n=(a=this.handleSvgElement(t,n))!=null?a:n,n.style.position="fixed",n.style.top=`${s.top}px`,n.style.left=`${s.left}px`,n.style.width=`${s.width}px`,n.style.height=`${s.height}px`;let o=this.elementsWithDataId[e].parentElement;return(!o||t.viewportElement)&&(o=document.body),this.setPositionNotStatic(o),o.appendChild(n),this.voidElementsWrappers.set(e,n),this.animateFrame||(this.animateFrame=requestAnimationFrame(this.animate)),n}setPositionNotStatic(t){let{position:e}=window.getComputedStyle(t);e==="static"&&t.style.setProperty("position","relative")}};m();m();var ve=pe(ao()),Ri=class{constructor(){this.browser=ve.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(ve.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(ve.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(ve.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(ve.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(ve.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(ve.default.PLATFORMS_MAP.mobile)||this.browser.is(ve.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(ve.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};m();var ki=class{constructor(){this.updateMeetingConnectionStatus=t=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=t,this.connectionStatusObserver.publish(t),this.logger.log("CONNECTION STATUS CHANGE",t)};this.onUpdateBrowserOnlineStatus=t=>{let{type:e}=t;if(e==="online"){this.updateMeetingConnectionStatus(1);return}this.updateMeetingConnectionStatus(4)};this.logger=new N("@superviz/sdk/connection-service"),this.connectionStatus=0,this.connectionStatusObserver=new j({logger:this.logger})}addListeners(){typeof window!="undefined"&&(window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus))}removeListeners(){typeof window!="undefined"&&(window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus))}};m();m();var Ii=class{constructor(t,e,i){this.myParticipant={};this.localRoomProperties=null;this.drawingData=null;this.state=0;this.MESSAGE_SIZE_LIMIT=6e4;this.useStore=q.bind(this);this.join=()=>{this.room.presence.on(_.LEAVE,this.onParticipantLeave),this.room.presence.on(_.JOINED_ROOM,this.onPresenceEnter),this.enableSync&&(this.room.on("update",this.updateLocalRoomState),this.drawingRoom.presence.on(_.UPDATE,this.updateDrawing))};this.updateMyProperties=t=>{let e=t!=null?t:{};this.isMessageTooBig(e)||this.left||!this.enableSync||this.isSyncFrozen||(e.avatar===void 0&&delete e.avatar,this.myParticipant=y(y({},this.myParticipant),e),this.room.presence.update(this.myParticipant),this.logger.log("REALTIME","updating my properties",this.myParticipant))};this.isMessageTooBig=(t,e=this.MESSAGE_SIZE_LIMIT)=>{let i=JSON.stringify(t);return new TextEncoder().encode(i).length>e?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.updateRoomProperties=t=>{if(this.isMessageTooBig(t)||this.isSyncFrozen||this.left)return;let e=y(y({},this.localRoomProperties),t);this.localRoomProperties=e,this.room.emit("update",e)};this.updateDrawingProperties=t=>{this.isMessageTooBig(t)||this.isSyncFrozen||this.left||(this.drawingData=y(y({},this.drawingData),t),this.drawingRoom.presence.update(this.drawingData))};this.setHost=t=>{this.updateRoomProperties({hostClientId:t})};this.setKickParticipant=t=>{if(!t)return;let{participants:e}=q("global-store"),i=e.value[t];this.updateRoomProperties({kickParticipant:i})};this.initializeRoomProperties=()=>{let t={isGridModeEnabled:!1,hostClientId:null,followParticipantId:null,gather:!1,transcript:"transcript.stop",kickParticipant:null};this.localRoomProperties=t,this.updateRoomProperties(t)};this.onParticipantLeave=t=>{var i;t.id===this.myParticipant.id&&(this.left=!0),t.id===((i=this.localRoomProperties)==null?void 0:i.followParticipantId)&&this.setFollowParticipant()};this.start=()=>S(this,null,function*(){this.started||(this.started=!0,this.room.isJoined||(this.logger.log("room state service - not joined room yet"),setTimeout(()=>{this.logger.log("room state service - retrying"),this.start()},2e3)),this.localRoomProperties=yield this.fetchRoomProperties(),this.localRoomProperties?this.updateLocalRoomState({data:this.localRoomProperties}):this.initializeRoomProperties(),this.publishStateUpdate(4),this.logger.log("REALTIME","Joined realtime room"))});this.onPresenceEnter=()=>{this.updateMyProperties()};this.updateLocalRoomState=e=>S(this,[e],function*({data:t}){this.logger.log("REALTIME","Room update received",t),this.localRoomProperties=Object.assign({},this.localRoomProperties,t);let{followParticipantId:i,gather:s,hostId:n,isGridModeEnabled:c,transcript:o}=this.useStore("video-store");i.publish(t.followParticipantId),s.publish(t.gather),n.publish(t.hostClientId),c.publish(t.isGridModeEnabled),o.publish(t.transcript),t.kickParticipant&&t.kickParticipant.id===this.myParticipant.id&&(this.updateRoomProperties({kickParticipant:null}),this.kickParticipantObserver.publish(this.myParticipant.id))});this.updateDrawing=t=>{if(t.id===this.myParticipant.id)return;let{drawing:e}=this.useStore("video-store");e.publish(t.data)};this.freezeSync=t=>{if(this.isSyncFrozen=t,t){this.destroy();return}this.join()};this.room=t,this.drawingRoom=e,this.logger=i,this.kickParticipantObserver=new j({logger:this.logger});let{localParticipant:s,participants:n}=this.useStore("global-store");s.subscribe(c=>{this.enableSync=c.type!=="audience",this.myParticipant=y(y({},this.myParticipant),c)}),n.subscribe(),this.join()}setGridMode(t){this.updateRoomProperties({isGridModeEnabled:t})}setDrawing(t){this.updateDrawingProperties(t)}setTranscript(t){this.updateRoomProperties({transcript:t})}fetchRoomProperties(){return S(this,null,function*(){if((yield new Promise(n=>{this.room.presence.get(c=>{c||n(0),n(c.length)})}))<=1)return null;let e=yield new Promise((n,c)=>{this.room.history(o=>{o||c(o),o.events.length||n(null);let a=o.events.pop();n(a)})}),i=1e3*60*60,s=(e==null?void 0:e.timestamp)<Date.now()-i;return!(e!=null&&e.data)||s?null:e.data})}publishStateUpdate(t){if(this.state===t)return;this.state=t,this.logger.log("REALTIME",`Realtime state did change. New state: ${ts[this.state]}`);let{meetingState:e}=this.useStore("video-store");e.publish(this.state)}setFollowParticipant(t){this.updateRoomProperties({followParticipantId:t})}setGather(t){this.updateRoomProperties({gather:t})}destroy(){this.room.presence.off(_.LEAVE),this.room.presence.off(_.JOINED_ROOM),this.drawingRoom.presence.off(_.UPDATE),this.room.off("update",this.updateLocalRoomState)}};m();m();var xi=class{build(t,e,i,s={},n={}){let c=document.querySelector(`#${t}`),o=new URL(e);if(this.wrapperId||this.element)throw new Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(s).forEach(([a,l])=>{o.searchParams.set(a,l)}),Object.entries(n).forEach(([a,l])=>{this.element.setAttribute(a,l)}),this.element.src=o.toString(),this.element.id=i,c.appendChild(this.element),this.wrapperId=t}destroy(){if(!this.wrapperId)throw new Error("Tried to destroy a frame before it was initialized");let t=document.querySelector(`#${this.wrapperId}`);t&&t.querySelector(`#${this.element.id}`)&&t.removeChild(this.element),this.wrapperId=null,this.element=null}};m();var Ni=class{constructor(t){this.observers={};this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"];this.originBlockList=["https://sketchfab.com"];this.publish=(t,e={})=>{this.logger.log("MessageBridge","Posting message to frame",t,e),this.contentWindow.postMessage({type:t,data:e},this.allowedOrigins)};this.listen=(t,e)=>{this.observers[t]||(this.observers[t]=new j({logger:this.logger})),this.observers[t].subscribe(e)};this.onReceiveMessage=t=>{let{type:e,data:i,source:s}=t.data;if(this.sourceBlockList.includes(s)||this.originBlockList.includes(t.origin))return;let n=!!e,c=!this.domains.length||this.domains.includes(t.origin),o=this.observers.hasOwnProperty(e);if(this.logger.log("MessageBridge",`Message received -
        TYPE: ${t.type}
        ORIGIN: ${t.origin}
        DATA: ${JSON.stringify(t.data)} `),!n||!c||!o){this.logger.log("MessageBridge","Message discarded");return}this.observers[e].publish(i)};let{contentWindow:e,domains:i=[],allowedOrigins:s="*",sourceBlockList:n=[],logger:c}=t;if(this.logger=c,this.domains=i,this.allowedOrigins=s,this.sourceBlockList.push(...n),typeof window=="undefined")throw new Error("MessageBridge: window is undefined");this.contentWindow=e,window.addEventListener("message",this.onReceiveMessage)}destroy(){Object.entries(this.observers).forEach(([t,e])=>{e.reset(),delete this.observers[t]}),typeof window!="undefined"&&window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observers,delete this.sourceBlockList}};var co="sv-video-frame",It=class{constructor(t){this.logger=new N("@superviz/sdk/video-conference-manager");this.frameStateObserver=new j({logger:this.logger});this.frameSizeObserver=new j({logger:this.logger});this.waitingForHostObserver=new j({logger:this.logger});this.realtimeEventsObserver=new j({logger:this.logger});this.sameAccountErrorObserver=new j({logger:this.logger});this.devicesObserver=new j({logger:this.logger});this.meetingStateObserver=new j({logger:this.logger});this.meetingConnectionObserver=new j({logger:this.logger});this.participantJoinedObserver=new j({logger:this.logger});this.participantLeftObserver=new j({logger:this.logger});this.participantListObserver=new j({logger:this.logger});this.frameState=0;this.layoutModalsAndCamerasConfig=(t,e)=>{let i=t,s=e,n=["left","right","bottom","top"].includes(s),c=["left","right","center"].includes(i);return n||(s="right"),c||(i="right"),this.browserService.isMobileDevice?(s="bottom",{layoutPosition:i,camerasPosition:s}):(i==="left"&&s==="right"&&(i="right"),i==="right"&&s==="left"&&(i="left"),{layoutPosition:i,camerasPosition:s})};this.onFrameLoad=()=>{this.messageBridge=new Ni({logger:this.logger,contentWindow:this.bricklayer.element.contentWindow}),this.addMessagesListeners(),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize(),this.setCustomColors(),this.setCallbacks()};this.setFrameOffset=t=>{let e=t!=null?t:{};["top","bottom","left","right"].forEach(i=>{Object.keys(e).includes(i)||(e[i]=0)}),this.frameOffset=e};this.setCustomColors=()=>{this.customColors&&this.messageBridge.publish("frame.color-list-update",this.customColors),this.styles&&this.messageBridge.publish("frame.styles-update",this.styles)};this.setCallbacks=()=>{if(!this.callbacks)return;let t={onToggleMicrophone:!!this.callbacks.onToggleMicrophone,onToggleCam:!!this.callbacks.onToggleCam,onToggleRecording:!!this.callbacks.onToggleRecording,onToggleChat:!!this.callbacks.onToggleChat,onToggleScreenShare:!!this.callbacks.onToggleScreenShare,onClickHangup:!!this.callbacks.onClickHangup,onToggleMeetingSetup:!!this.callbacks.onToggleMeetingSetup};this.messageBridge.listen("callback-called",e=>{var i,s;(s=(i=this.callbacks)[e])==null||s.call(i)}),this.messageBridge.publish("frame.callbacks-update",JSON.stringify(t))};this.setFrameStyle=t=>{let e=document.createElement("style"),{bottom:i,left:s,right:n,top:c}=this.frameOffset;if(e.innerHTML=`
      :root {
        --superviz-offset-top: ${c}px;
        --superviz-offset-right: ${n}px;
        --superviz-offset-left: ${s}px;
        --superviz-offset-bottom: ${i}px;
      }     
    `,document.head.appendChild(e),this.browserService.isMobileDevice){this.bricklayer.element.classList.add("sv-video-frame--bottom");return}this.bricklayer.element.classList.add(`sv-video-frame--${t}`)};this.onFrameDimensionsUpdate=({width:t,height:e})=>{if(typeof window=="undefined")return;let i=document.getElementById(co),{bottom:s,right:n,left:c,top:o}=this.frameOffset,a=this.isWaterMarkEnabled?40:0,l=`${t}px`,u=`${e+a}px`;(t>=window.innerWidth||this.isHorizontalCameraEnabled)&&(l=`calc(100% - ${n}px - ${c}px)`),e>=window.innerHeight&&(u=`calc(100% - ${o}px - ${s}px)`),i.style.width=l,i.style.height=u,this.frameSizeObserver.publish({width:i.offsetWidth,height:i.offsetHeight})};this.onWindowResize=()=>{let{top:t,bottom:e,right:i,left:s}=this.frameOffset,{innerHeight:n,innerWidth:c}=window,o=n-t-e,a=c-i-s;this.messageBridge&&this.messageBridge.publish("frame.parent-window-size-update",{height:o,width:a})};this.updateFrameLocale=()=>{var n,c;if(!this.frameLocale||!((n=this.frameLocale)!=null&&n.language)&&((c=this.frameLocale)!=null&&c.locales))return;let{language:t,locales:e}=this.frameLocale,s=["en",...e.map(o=>o==null?void 0:o.language)];if(t&&!s.includes(t))throw new Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)};this.updateMeetingAvatars=()=>{this.messageBridge.publish("frame.avatar-list-update",this.meetingAvatars)};this.onParticipantJoined=t=>{this.participantJoinedObserver.publish(t)};this.onParticipantLeft=t=>{this.participantLeftObserver.publish(t)};this.onMeetingHostChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.host-change",data:t})};this.onMeetingKickParticipant=t=>{this.realtimeEventsObserver.publish({event:"meeting.kick-participant",data:t})};this.onFollowParticipantDidChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.follow-participant",data:t})};this.onGoToDidChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.go-to-participant",data:t})};this.onGather=()=>{this.realtimeEventsObserver.publish({event:"realtime.gather",data:!0})};this.onGridModeChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.grid-mode-change",data:t})};this.onDrawingChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.drawing-change",data:t})};this.onTranscriptChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.transcript-change",data:t})};this.onSameAccountError=t=>{this.sameAccountErrorObserver.publish(t)};this.onDevicesChange=t=>{this.devicesObserver.publish(t)};this.meetingStateUpdate=t=>{this.meetingStateObserver.publish(t)};this.onConnectionStatusChange=t=>{this.meetingConnectionObserver.publish(t)};this.onWaitingForHostDidChange=t=>{this.waitingForHostObserver.publish(t)};this.onParticipantListUpdate=t=>{this.participantListObserver.publish(t)};var Ye,Xe,Qe,et;let{language:e,canUseCams:i,canUseChat:s,canUseScreenshare:n,canUseDefaultAvatars:c,canUseFollow:o,canUseGoTo:a,canUseGather:l,canShowAudienceList:u,canUseDefaultToolbar:p,canUseRecording:d,browserService:h,offset:f,locales:v,avatars:O,customColors:w,styles:G,waterMark:W,layoutPosition:V,camerasPosition:J,skipMeetingSettings:F,devices:U,layoutMode:z,collaborationMode:$,callbacks:se}=t;this.browserService=h;let Ce=this.layoutModalsAndCamerasConfig(V,J),Se=document.createElement("div");this.frameConfig={apiKey:A.get("apiKey"),apiUrl:A.get("apiUrl"),debug:A.get("debug"),roomId:A.get("roomId"),limits:A.get("limits"),collaborationMode:$,canUseFollow:o,canUseGoTo:a,canUseCams:i,canUseChat:s,canUseGather:l,canUseScreenshare:n,canUseDefaultAvatars:c,canUseRecording:d,canShowAudienceList:u,camerasPosition:(Ye=Ce.camerasPosition)!=null?Ye:"right",canUseDefaultToolbar:p,devices:{audioInput:(Xe=U==null?void 0:U.audioInput)!=null?Xe:!0,audioOutput:(Qe=U==null?void 0:U.audioOutput)!=null?Qe:!0,videoInput:(et=U==null?void 0:U.videoInput)!=null?et:!0},waterMark:W,layoutMode:z,skipMeetingSettings:F,layoutPosition:Ce.layoutPosition,transcriptLangs:A.get("features.transcriptLangs")},this.customColors=w,this.callbacks=se,this.styles=G,Se.classList.add("sv_video_wrapper"),Se.id="sv-video-wrapper",document.body.appendChild(Se),this.updateFrameState(1),this.bricklayer=new xi,this.bricklayer.build(Se.id,A.get("conferenceLayerUrl"),co,void 0,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(f),this.setFrameStyle(Ce.camerasPosition),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:e,locales:v},this.meetingAvatars=O,typeof window!="undefined"&&(window.addEventListener("resize",this.onWindowResize),window.addEventListener("orientationchange",this.onWindowResize))}get isWaterMarkEnabled(){return this.browserService.isMobileDevice?!1:this.frameConfig.waterMark}get isHorizontalCameraEnabled(){return this.browserService.isMobileDevice?!1:["top","bottom"].includes(this.frameConfig.camerasPosition)}addMessagesListeners(){this.messageBridge.listen("meeting.waiting-for-host",this.onWaitingForHostDidChange),this.messageBridge.listen("meeting.participant-joined",this.onParticipantJoined),this.messageBridge.listen("meeting.participant-list-update",this.onParticipantListUpdate),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.kick-participant",this.onMeetingKickParticipant),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("realtime.drawing-change",this.onDrawingChange),this.messageBridge.listen("realtime.transcript-change",this.onTranscriptChange),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather)}updateFrameState(t){t!==this.frameState&&(this.frameState=t,this.frameStateObserver.publish(this.frameState));let e={1:6,2:7,0:8};this.meetingStateUpdate(e[t])}start(t){this.messageBridge.publish("meeting.start",L(y({},t),{config:this.frameConfig}))}leave(){this.messageBridge.publish("meeting.leave"),this.destroy()}destroy(){var t,e,i,s,n,c,o,a,l,u;(t=this.messageBridge)==null||t.destroy(),(e=this.bricklayer)==null||e.destroy(),(i=this.frameSizeObserver)==null||i.destroy(),(s=this.realtimeEventsObserver)==null||s.destroy(),(n=this.sameAccountErrorObserver)==null||n.destroy(),(c=this.devicesObserver)==null||c.destroy(),(o=this.meetingStateObserver)==null||o.destroy(),(a=this.meetingConnectionObserver)==null||a.destroy(),(l=this.participantJoinedObserver)==null||l.destroy(),(u=this.participantLeftObserver)==null||u.destroy(),this.bricklayer=null,this.frameState=null,typeof window!="undefined"&&(window.removeEventListener("resize",this.onWindowResize),window.removeEventListener("orientationchange",this.onWindowResize))}publishMessageToFrame(t,e){this.messageBridge&&this.messageBridge.publish(t,e)}};m();var Wr=class{constructor(){this.logger=new N("@superviz/sdk/core-bridge"),this.logger.log("CoreBridge initialized")}updateLocalParticipant(t){this.logger.log("updateLocalParticipant",t);let{localParticipant:e}=q("core-store");e.publish(t)}updateParticipantsList(t){this.logger.log("updateParticipantsList",t);let{participants:e}=q("core-store");e.publish(t)}},xt=new Wr;var eu=1e3*60,Oe=null,Nt=class extends X{constructor(e){var i,s;super();this.participantsOnMeeting=[];this.kickParticipantsOnHostLeave=!1;this.startVideo=()=>{var i,s,n,c,o,a,l,u,p,d,h,f,v,O,w,G,W,V,J,F,U,z,$,se,Ce,Se,Ye,Xe,Qe,et,Vr,Hr,zr,$r,Zr,Jr,qr,Kr;let e=((i=this.params)==null?void 0:i.userType)!=="audience"&&((s=this.params)==null?void 0:s.defaultAvatars)===!0;this.videoConfig={language:(n=this.params)==null?void 0:n.language,canUseRecording:!!((c=this.params)!=null&&c.enableRecording),canShowAudienceList:(a=(o=this.params)==null?void 0:o.showAudienceList)!=null?a:!0,canUseChat:!((l=this.params)!=null&&l.chatOff),canUseCams:!((u=this.params)!=null&&u.camsOff),canUseScreenshare:!((p=this.params)!=null&&p.screenshareOff),canUseDefaultAvatars:e&&!((h=(d=this.localParticipant)==null?void 0:d.avatar)!=null&&h.model3DUrl),canUseGather:!!((f=this.params)!=null&&f.enableGather),canUseFollow:!!((v=this.params)!=null&&v.enableFollow),canUseGoTo:!!((O=this.params)!=null&&O.enableGoTo),canUseDefaultToolbar:(G=(w=this.params)==null?void 0:w.defaultToolbar)!=null?G:!0,camerasPosition:(V=(W=this.params)==null?void 0:W.collaborationMode)==null?void 0:V.position,devices:(J=this.params)==null?void 0:J.devices,skipMeetingSettings:(F=this.params)==null?void 0:F.skipMeetingSettings,browserService:this.browserService,offset:(U=this.params)==null?void 0:U.offset,locales:($=(z=this.params)==null?void 0:z.locales)!=null?$:[],avatars:(Ce=(se=this.params)==null?void 0:se.avatars)!=null?Ce:[],customColors:A.get("colors"),waterMark:A.get("waterMark"),styles:(Se=this.params)==null?void 0:Se.styles,collaborationMode:(Qe=(Xe=(Ye=this.params)==null?void 0:Ye.collaborationMode)==null?void 0:Xe.enabled)!=null?Qe:!0,layoutPosition:((Vr=(et=this.params)==null?void 0:et.collaborationMode)==null?void 0:Vr.enabled)===!1?"center":($r=(zr=(Hr=this.params)==null?void 0:Hr.collaborationMode)==null?void 0:zr.modalPosition)!=null?$r:"center",layoutMode:(qr=(Jr=(Zr=this.params)==null?void 0:Zr.collaborationMode)==null?void 0:Jr.initialView)!=null?qr:"list",callbacks:(Kr=this.params)==null?void 0:Kr.callbacks},this.logger.log("video conference @ start video",this.videoConfig),this.videoManager=new It(this.videoConfig),this.subscribeToVideoEvents()};this.subscribeToVideoEvents=()=>{this.logger.log("video conference @ subscribe to video events"),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.subscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.subscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.subscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.subscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.subscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.subscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.devicesObserver.subscribe(this.onDevicesChange)};this.unsubscribeFromVideoEvents=()=>{this.videoManager&&(this.logger.log("video conference @ unsubscribe from video events"),this.videoManager.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.unsubscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.unsubscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.unsubscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.unsubscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.unsubscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.unsubscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),this.videoManager.devicesObserver.unsubscribe(this.onDevicesChange))};this.suscribeToRealtimeEvents=()=>{this.logger.log("video conference @ subscribe to realtime events"),this.room.presence.on(_.UPDATE,this.onParticipantUpdateOnRealtime),this.room.presence.on(_.JOINED_ROOM,this.onParticipantJoinedOnRealtime),this.room.presence.on(_.LEAVE,this.onParticipantLeftOnRealtime)};this.unsubscribeFromRealtimeEvents=()=>{var e;this.logger.log("video conference @ unsubscribe from realtime events"),this.room.presence.off(_.UPDATE),this.room.presence.off(_.LEAVE),this.room.presence.off(_.JOINED_ROOM),(e=this.roomState)==null||e.kickParticipantObserver.unsubscribe(this.onKickLocalParticipant)};this.subscribeToStoreUpdates=()=>{let{localParticipant:e,group:i,participants:s}=this.useStore("global-store");s.subscribe(p=>{let d=Object.values(p);this.onRealtimeParticipantsDidChange(d)});let{drawing:n,hostId:c,isGridModeEnabled:o,transcript:a,followParticipantId:l,gather:u}=this.useStore("video-store");e.subscribe(p=>{this.localParticipant=L(y(y({},this.localParticipant),p),{type:this.params.userType})}),n.subscribe(this.setDrawing),c.subscribe(this.setHost),o.subscribe(this.setGridMode),a.subscribe(this.setTranscript),l.subscribe(this.setFollowParticipant),u.subscribe(this.setGather),i.subscribe()};this.createParticipantFromPresence=e=>{var i;return{participantId:e.id,id:e.id,color:((i=e.data.slot)==null?void 0:i.color)||te.gray,avatar:e.data.avatar,type:e.data.type,name:e.data.name,isHost:e.data.isHost,timestamp:e.timestamp,slot:e.data.slot}};this.onFrameSizeDidChange=e=>{this.publish("frame.dimensions-update",e)};this.onWaitingForHost=e=>{this.publish("meeting.waiting-for-host",e)};this.onConnectionStatusChange=e=>{this.logger.log("video conference @ on connection status change",e);let i=[2,4,3,6];i.includes(e)&&this.roomState.freezeSync(!0),i.includes(this.connectionService.oldConnectionStatus)&&!i.includes(e)&&this.roomState.freezeSync(!1),this.publish("meeting.connection-status-change",e)};this.onMeetingStateChange=e=>{this.logger.log("video conference @ on meeting state change",e),this.publish("meeting.state-update",e)};this.onSameAccountError=e=>{this.publish("meeting.same-participant-error",e),this.detach()};this.onDevicesChange=e=>{this.publish("meeting.devices-change",e)};this.onFrameStateChange=e=>{this.logger.log("video conference @ on frame state change",e),e===2&&(this.roomState=new Ii(this.room,this.drawingRoom,this.logger),this.roomState.kickParticipantObserver.subscribe(this.onKickLocalParticipant),this.roomState.start(),this.params.userType!=="guest"&&(this.localParticipant=Object.assign(this.localParticipant,{type:this.params.userType}),this.roomState.updateMyProperties(y({},this.localParticipant))),this.videoManager.start({group:this.group,participant:this.localParticipant,roomId:A.get("roomId")}),this.publish("meeting.start"))};this.onRealtimeEventFromFrame=({event:e,data:i})=>{this.logger.log("video conference @ on realtime event from frame",e,i);let s={"realtime.host-change":n=>this.roomState.setHost(n),"realtime.gather":n=>this.roomState.setGather(n),"realtime.grid-mode-change":n=>this.roomState.setGridMode(n),"realtime.drawing-change":n=>{this.roomState.setDrawing(n)},"realtime.follow-participant":n=>{this.roomState.setFollowParticipant(n)},"meeting.kick-participant":n=>{this.roomState.setKickParticipant(n)},"realtime.transcript-change":n=>{this.roomState.setTranscript(n)},"realtime.go-to-participant":n=>{this.eventBus.publish("realtime.go-to-participant",n)}}[e](i);this.publish(e,i)};this.onParticipantJoined=e=>{var c;this.logger.log("video conference @ on participant joined",e),this.publish("meeting.participant-joined",e),this.publish("my-participant.joined",e),this.kickParticipantsOnHostLeave=!((c=this.params)!=null&&c.allowGuests);let{localParticipant:i,participants:s}=this.useStore("global-store"),n=e.name.trim();if(this.videoConfig.canUseDefaultAvatars){this.roomState.updateMyProperties({avatar:e.avatar,name:e.name,type:e.type,joinedMeeting:!0}),xt.updateLocalParticipant(L(y({},i.value),{avatar:e.avatar,name:e.name,type:this.params.userType})),xt.updateParticipantsList(L(y({},s.value),{[e.id]:L(y({},s.value[e.id]),{avatar:e.avatar,name:e.name})}));return}xt.updateLocalParticipant(L(y({},i.value),{name:n,type:this.params.userType})),xt.updateParticipantsList(L(y({},s.value),{[e.id]:L(y({},s.value[e.id]),{name:n,type:this.params.userType})})),this.roomState.updateMyProperties({name:e.name,type:e.type,joinedMeeting:!0})};this.onParticipantLeft=e=>{var n,c;this.logger.log("video conference @ on participant left",this.localParticipant);let{localParticipant:i,participants:s}=this.useStore("global-store");i.publish(L(y({},i.value),{activeComponents:(n=i.value.activeComponents)==null?void 0:n.filter(o=>o!=="videoConference")})),s.publish(L(y({},s.value),{[this.localParticipant.id]:L(y({},i.value),{activeComponents:(c=i.value.activeComponents)==null?void 0:c.filter(o=>o!=="videoConference")})})),this.connectionService.removeListeners(),this.publish("my-participant.left",this.localParticipant),this.unsubscribeFromVideoEvents(),this.videoManager.leave(),this.videoManager=void 0,this.connectionService=void 0,this.detach()};this.onParticipantListUpdate=e=>{this.logger.log("video conference @ on participant list update",e);let i=Object.values(e).map(s=>{var n,c;return{id:s.id,slot:s.slot,avatar:s.avatar,name:s.name,type:s.type,isHost:(n=s.isHost)!=null?n:!1,timestamp:s.timestamp,color:((c=s.slot)==null?void 0:c.color)||te.gray}});this.publish("meeting.participant-list-update",i),this.participantsOnMeeting.length!==i.length&&this.publish("meeting.amount-of-participants-update",i.length),this.participantsOnMeeting=i,this.validateIfInTheRoomHasHost()};this.onKickLocalParticipant=()=>{this.logger.log("video conference @ on kick local participant"),this.publish("meeting.kick-participant",this.localParticipant),this.detach()};this.setDrawing=e=>{var i;(i=this.videoManager)==null||i.publishMessageToFrame("realtime.drawing-change",e)};this.setHost=e=>{var i;(i=this.videoManager)==null||i.publishMessageToFrame("realtime.host-change",e),this.onHostParticipantDidChange(e)};this.setGridMode=e=>{var i;(i=this.videoManager)==null||i.publishMessageToFrame("realtime.grid-mode-change",e)};this.setTranscript=e=>{var i;(i=this.videoManager)==null||i.publishMessageToFrame("realtime.transcript-change",e)};this.setFollowParticipant=e=>{var i;(i=this.videoManager)==null||i.publishMessageToFrame("realtime.follow-participant",e),this.eventBus.publish("realtime.follow-participant",e)};this.setGather=e=>{if(!this.videoManager||!e)return;let{hostId:i,gather:s}=this.useStore("video-store");if(s.publish(!1),i.value!==this.localParticipant.id){this.eventBus.publish("realtime.go-to-participant",i.value);return}this.videoManager.publishMessageToFrame("realtime.gather",e)};this.onRealtimeParticipantsDidChange=e=>{var s;this.logger.log("video conference @ on participants did change",e);let i=e.map(n=>{var c,o;return{id:n.id,timestamp:n.timestamp,participantId:n.id,color:((c=n.slot)==null?void 0:c.color)||te.gray,name:n.name,isHost:(o=n.isHost)!=null?o:!1,avatar:n.avatar,type:n.type,slot:n.slot}});(s=this.videoManager)==null||s.publishMessageToFrame("realtime.participant-list-update",i)};this.onHostParticipantDidChange=e=>{var c,o;this.logger.log("video conference @ on host participant did change",e),(c=this.videoManager)==null||c.publishMessageToFrame("realtime.host-change",e);let{participants:i}=this.useStore("global-store"),s=Object.values(i.value).find(a=>a.id===e),n=s?{id:s.id,color:((o=s.slot)==null?void 0:o.color)||te.gray,avatar:s.avatar,type:s.type,name:s.name,isHost:s.id===e}:null;Oe&&n&&(this.logger.log("video conference @ on host participant did change - clear kick all participants timeout"),clearTimeout(Oe),Oe=null),this.publish("meeting.host-change",n)};this.onHostAvailabilityChange=e=>{if(this.logger.log("launcher service @ onHostAvailabilityChange"),e){this.publish("meeting.host-available");return}this.publish("meeting.no-host-available")};this.onParticipantJoinedOnRealtime=e=>{this.logger.log("video conference @ on participant joined on realtime",e),this.publish("meeting.participant-joined",this.createParticipantFromPresence(e)),e.id===this.localParticipant.id&&this.room.presence.update(this.localParticipant)};this.onParticipantLeftOnRealtime=e=>{this.logger.log("video conference @ on participant left on realtime",e),this.publish("meeting.participant-left",this.createParticipantFromPresence(e))};this.onParticipantUpdateOnRealtime=e=>{this.logger.log("video conference @ on participant update on realtime",e);let{localParticipant:i,participants:s}=this.useStore("global-store");e.data.id===this.localParticipant.id&&this.publish("my-participant.update",this.createParticipantFromPresence(e)),s.publish(L(y({},s.value),{[e.data.id]:y(y({},i.value),e.data)}))};this.validateIfInTheRoomHasHost=()=>{var a,l;if(!this.roomState)return;let{hostId:e}=this.useStore("video-store"),{participants:i}=this.useStore("global-store"),s=Object.values(i.value),n=s.filter(u=>u.type==="host"&&this.participantsOnMeeting.some(p=>p.id===u.id));!n.length&&this.kickParticipantsOnHostLeave&&((a=this.localParticipant)==null?void 0:a.type)!=="host"&&!Oe&&(this.logger.log("video conference @ validate if in the room has host - init kick all participants timeout"),Oe=setTimeout(()=>{this.logger.log("video conference @ validate if in the room has host - kick all participants"),this.onKickLocalParticipant()},eu)),n.length&&Oe&&(this.logger.log("video conference @ validade if in the room has host - clear kick all participants timeout"),clearTimeout(Oe),Oe=null),this.onHostAvailabilityChange(!!n.length);let c=s.find(u=>(u==null?void 0:u.id)===(e==null?void 0:e.value));if(!n.length||c)return;let o=n.reduce((u,p)=>(this.logger.log("video conference @ validate if in the room has host - reducing participants",{previous:u,current:p}),!u||(p==null?void 0:p.id)===e.value?p:(p==null?void 0:p.timestamp)>u.timestamp?u:p),null);this.room.presence.update(L(y({},this.localParticipant),{isHost:o.id===this.localParticipant.id})),!(!o||o.id!==((l=this.localParticipant)==null?void 0:l.id))&&(this.logger.log("video conference @ validate if in the room has host - set host",o),e.publish(o.id),this.roomState.setHost(o.id))};this.params=L(y({},e),{userType:(s=(i=e==null?void 0:e.participantType)!=null?i:e==null?void 0:e.userType)!=null?s:"guest"}),this.name="videoConference",this.logger=new N("@superviz/sdk/videoConference"),this.browserService=new Ri,this.connectionService=new ki,this.connectionService.addListeners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange)}toggleMeetingSetup(){var e;return(e=this.videoManager)==null?void 0:e.publishMessageToFrame("meeting-controls.toggle-setup")}toggleMicrophone(){var e;if(this.localParticipant.type==="audience"){console.warn("[SuperViz] Audience cannot toggle microphone");return}return(e=this.videoManager)==null?void 0:e.publishMessageToFrame("meeting-controls.toggle-microphone")}toggleCam(){var e;if(this.localParticipant.type==="audience"){console.warn("[SuperViz] Audience cannot toggle camera");return}(e=this.videoManager)==null||e.publishMessageToFrame("meeting-controls.toggle-cam")}toggleScreenShare(){var e;if(this.localParticipant.type==="audience"){console.warn("[SuperViz] Audience cannot toggle screen share");return}return(e=this.videoManager)==null?void 0:e.publishMessageToFrame("meeting-controls.toggle-screenshare")}toggleChat(){var e;return(e=this.videoManager)==null?void 0:e.publishMessageToFrame("meeting-controls.toggle-chat")}toggleRecording(){var e;if(this.localParticipant.isHost){console.warn("[SuperViz] Only host can toggle recording");return}return(e=this.videoManager)==null?void 0:e.publishMessageToFrame("meeting-controls.toggle-recording")}hangUp(){var e;(e=this.videoManager)==null||e.publishMessageToFrame("hang-up")}start(){this.logger.log("video conference @ start"),this.drawingRoom=this.ioc.createRoom("drawing"),this.subscribeToStoreUpdates(),this.suscribeToRealtimeEvents(),this.startVideo()}destroy(){var i,s,n;this.logger.log("video conference @ destroy");let{destroy:e}=this.useStore("video-store");e(),(i=this.roomState)==null||i.destroy(),this.drawingRoom.disconnect(),this.kickParticipantsOnHostLeave=!1,this.publish("destroy"),this.unsubscribeFromRealtimeEvents(),this.unsubscribeFromVideoEvents(),(s=this.videoManager)==null||s.leave(),(n=this.connectionService)==null||n.removeListeners()}};m();m();var lo=pe(tt());var Fi=class extends X{constructor(e,i){var n;super();this.camera={x:0,y:0,screen:{width:0,height:0},scale:1};this.subscribeToRealtimeEvents=()=>{this.logger.log("presence-mouse component @ subscribe to realtime events"),this.room.presence.on(_.JOINED_ROOM,this.onPresenceJoinedRoom),this.room.presence.on(_.LEAVE,this.onPresenceLeftRoom),this.room.presence.on(_.UPDATE,this.onPresenceUpdate)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.room.presence.off(_.JOINED_ROOM),this.room.presence.off(_.LEAVE),this.room.presence.off(_.UPDATE)};this.setParticipantPrivate=e=>{this.isPrivate=e,this.room.presence.update({visible:!e})};this.onPresenceJoinedRoom=e=>{e.id===this.localParticipant.id&&this.room.presence.update(this.localParticipant)};this.onPresenceLeftRoom=e=>{this.removePresenceMouseParticipant(e.id)};this.onPresenceUpdate=e=>{if(this.following&&this.presences.get(this.following)&&this.goToMouse(this.following),e.id===this.localParticipant.id)return;let i=e.data;if(this.following&&i.id!==this.following&&this.presences.has(i.id)){this.removePresenceMouseParticipant(i.id);return}this.presences.set(i.id,i)};this.animate=()=>{this.getCamera(),this.renderDivWrapper(),this.updateParticipantsMouses(),requestAnimationFrame(this.animate)};this.goToMouse=e=>{let i=this.presences.get(e);if(!(i!=null&&i.camera))return;let s=i.camera.x,n=i.camera.y,c=this.divWrapper.clientHeight/i.camera.screen.height,o=Math.min(c,1),a=this.divWrapper.clientWidth/i.camera.screen.width,l=Math.min(a,1);this.goToMouseCallback&&this.goToMouseCallback({x:s,y:n,scaleX:o,scaleY:l})};this.onMyParticipantMouseMove=(0,lo.throttle)(e=>{let i=this.canvas.getContext("2d"),s=this.canvas.getBoundingClientRect(),n=e.x-s.left,c=e.y-s.top,a=(i==null?void 0:i.getTransform()).inverse(),l=new DOMPoint(n,c).matrixTransform(a),u={x:l.x,y:l.y};this.room.presence.update(L(y(y({},this.localParticipant),u),{visible:!this.isPrivate,camera:this.camera}))},30);this.onMyParticipantMouseOut=e=>{let{x:i,y:s,width:n,height:c}=this.canvas.getBoundingClientRect();e.x>0&&e.y>0&&e.x<i+n&&e.y<s+c||this.room.presence.update({visible:!1})};this.updateParticipantsMouses=()=>{this.presences.forEach(e=>{if(!(e!=null&&e.visible)||this.following&&this.following!==e.id){this.removePresenceMouseParticipant(e.id);return}this.renderPresenceMouses(e)})};this.getCamera=()=>{var o;let e=(o=this.canvas)==null?void 0:o.getContext("2d"),i=e==null?void 0:e.getTransform(),s=i==null?void 0:i.e,n=i==null?void 0:i.f,c=i==null?void 0:i.a;this.camera={screen:{width:this.divWrapper.clientHeight,height:this.divWrapper.clientWidth},x:s,y:n,scale:c}};this.renderPresenceMouses=e=>{var V,J,F,U,z;let s=document.getElementById(`mouse-${e.id}`);s||(s=this.createMouseElement(e));let n=document.getElementById(`mouse-${e.id}`),c=document.getElementById(`mouse-${e.id}`);if(!n||!c)return;let o=n.getElementsByClassName("mouse-user-name")[0],a=c.getElementsByClassName("pointer-mouse")[0];a&&(a.style.backgroundImage=`url(https://production.cdn.superviz.com/static/mouse-pointers/${(V=e.slot)==null?void 0:V.colorName}.svg)`),o&&(o.style.color=(F=(J=e.slot)==null?void 0:J.textColor)!=null?F:"#fff",o.style.backgroundColor=(z=(U=e.slot)==null?void 0:U.color)!=null?z:te.gray,o.innerHTML=e.name);let{x:l,y:u}=e,p=this.canvas.getContext("2d"),d=p==null?void 0:p.getTransform(),h=d==null?void 0:d.e,f=d==null?void 0:d.f,v=d.a,O=d.d,w=l*v+h,G=u*O+f,W=this.divWrapper.clientWidth>w&&this.divWrapper.clientHeight>G&&e.visible;s.style.opacity=W?"1":"0",s.style.left=`${w}px`,s.style.top=`${G}px`};this.followMouse=e=>{this.following=e,this.goToMouse(e)};if(this.name="presence",this.logger=new N("@superviz/sdk/presence"),this.canvas=document.getElementById(e),this.presences=new Map,!this.canvas){let c=`Canvas with id ${e} not found`;throw this.logger.log(c),new Error(c)}this.divWrapper=this.renderDivWrapper(),this.animateFrame=requestAnimationFrame(this.animate),this.goToMouseCallback=(n=i==null?void 0:i.callbacks)==null?void 0:n.onGoToPresence;let{localParticipant:s}=this.useStore("global-store");s.subscribe(),this.getCamera()}start(){this.logger.log("presence-mouse component @ start"),this.canvas.addEventListener("mousemove",this.onMyParticipantMouseMove),this.canvas.addEventListener("mouseout",this.onMyParticipantMouseOut),this.eventBus.subscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.subscribe("realtime.local-follow-participant",this.followMouse),this.eventBus.subscribe("realtime.private-mode",this.setParticipantPrivate),this.subscribeToRealtimeEvents()}destroy(){this.logger.log("presence-mouse component @ destroy"),this.eventBus.unsubscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.unsubscribe("realtime.local-follow-participant",this.followMouse),this.eventBus.unsubscribe("realtime.private-mode",this.setParticipantPrivate),this.unsubscribeFromRealtimeEvents(),cancelAnimationFrame(this.animateFrame),this.canvas.removeEventListener("mousemove",this.onMyParticipantMouseMove),this.canvas.removeEventListener("mouseout",this.onMyParticipantMouseOut),this.divWrapper.remove()}renderDivWrapper(){let e=this.canvas.getBoundingClientRect(),i=document.getElementById("superviz-presence-mouse-wrapper");return i||(i=document.createElement("div"),i.id="superviz-presence-mouse-wrapper",this.canvas.parentElement.style.position="relative",this.canvas.parentElement.appendChild(i)),i.style.position="fixed",i.style.top=`${e.top}px`,i.style.left=`${e.left}px`,i.style.width=`${e.width}px`,i.style.height=`${e.height}px`,i.style.pointerEvents="none",i.style.overflow="hidden",i.style.zIndex="2",i}removePresenceMouseParticipant(e){let i=document.getElementById(`mouse-${e}`);i&&(i.remove(),this.presences.delete(e))}createMouseElement(e){let i=document.createElement("div");i.setAttribute("id",`mouse-${e.id}`),i.setAttribute("class","mouse-follower");let s=document.createElement("div");s.setAttribute("class","pointer-mouse");let n=document.createElement("div");return n.setAttribute("class","mouse-user-name"),n.innerHTML=e.name,i.appendChild(s),i.appendChild(n),i.style.left="0px",i.style.top="0px",this.divWrapper.appendChild(i),i}transform(e){console.warn("[SuperViz] - transform method not available when container is a canvas element.")}};m();var uo=pe(tt());m();var Di=(f=>(f.AREA="area",f.BASE="base",f.BR="br",f.COL="col",f.EMBED="embed",f.HR="hr",f.IMG="img",f.INPUT="input",f.LINK="link",f.META="meta",f.PARAM="param",f.SOURCE="source",f.TRACK="track",f.WBR="wbr",f))(Di||{}),Bi=(i=>(i.RECT="rect",i.ELLIPSE="ellipse",i.SVG="svg",i))(Bi||{});var Ui=class extends X{constructor(e,i){var n;super();this.presences=new Map;this.mouses=new Map;this.transformation={translate:{x:0,y:0},scale:1};this.onMyParticipantMouseMove=e=>{if(this.isPrivate)return;let i=e.currentTarget,{left:s,top:n}=i.getBoundingClientRect(),c=(e.x-s-this.transformation.translate.x)/this.transformation.scale,o=(e.y-n-this.transformation.translate.y)/this.transformation.scale;this.room.presence.update(L(y({},this.localParticipant),{x:c,y:o,visible:!0,camera:this.camera}))};this.onMyParticipantMouseLeave=e=>{if(typeof window=="undefined")return;let{left:i,top:s,right:n,bottom:c}=this.container.getBoundingClientRect(),o=e.x>i&&e.y>s&&e.x<n&&e.y<c,a=e.x>0&&e.y>0&&e.x<window.innerWidth&&e.y<window.innerHeight;o&&a||this.room.presence.update({visible:!1})};this.goToMouse=e=>{let i=this.mouses.get(e),s=this.presences.get(e);if(s){if(this.goToPresenceCallback){let n=this.camera.screen.width/s.camera.screen.width,c=this.camera.screen.height/s.camera.screen.height,o=s.camera.x*n,a=s.camera.y*c,l=s.camera.scale*n,u=s.camera.scale*c;this.goToPresenceCallback({x:o,y:a,scaleX:l,scaleY:u});return}i&&i.scrollIntoView({block:"center",inline:"center",behavior:"smooth"})}};this.followMouse=e=>{this.userBeingFollowedId=e,this.goToMouse(e)};this.setParticipantPrivate=e=>{this.isPrivate=e,this.room.presence.update({visible:!e})};this.onPresenceJoinedRoom=e=>{e.id===this.localParticipant.id&&this.room.presence.update(this.localParticipant)};this.onPresenceLeftRoom=e=>{this.removePresenceMouseParticipant(e.id)};this.onPresenceUpdate=e=>{if(e.id===this.localParticipant.id)return;let i=e.data;if(this.userBeingFollowedId&&i.id!==this.userBeingFollowedId&&this.presences.has(i.id)){this.removePresenceMouseParticipant(i.id);return}this.presences.set(i.id,i),this.animate(),this.updateParticipantsMouses()};this.animate=()=>{Di[this.containerTagname]&&this.updateVoidElementWrapper(),Bi[this.containerTagname]&&this.updateSVGElementWrapper(),this.animationFrame=requestAnimationFrame(this.animate)};this.updateParticipantsMouses=e=>{if(this.presences.forEach(s=>{if(s.id!==this.localParticipant.id){if(!(s!=null&&s.visible)){this.removePresenceMouseParticipant(s.id);return}this.renderPresenceMouses(s)}}),e)return;this.presences.has(this.userBeingFollowedId)&&this.goToMouse(this.userBeingFollowedId)};this.renderPresenceMouses=e=>{var p,d,h,f,v;if(e.id===this.localParticipant.id)return;let i=document.getElementById(`mouse-${e.id}`);if(i||(i=this.createMouseElement(e)),!i)return;let s=i.getElementsByClassName("mouse-user-name")[0],n=i.getElementsByClassName("pointer-mouse")[0];n&&(n.style.backgroundImage=`url(https://production.cdn.superviz.com/static/mouse-pointers/${(p=e.slot)==null?void 0:p.colorName}.svg)`),s&&(s.style.color=(h=(d=e.slot)==null?void 0:d.textColor)!=null?h:te.gray,s.style.backgroundColor=(v=(f=e.slot)==null?void 0:f.color)!=null?v:"#fff",s.innerHTML=e.name);let{x:c,y:o}=e,{translate:{x:a,y:l},scale:u}=this.transformation;i.style.left=`${a+c*u}px`,i.style.top=`${l+o*u}px`};this.renderVoidElementWrapper=()=>{let e=document.createElement("div"),{width:i,height:s,left:n,top:c}=this.container.getBoundingClientRect();e.style.position="absolute",e.style.width=`${i}px`,e.style.height=`${s}px`,e.style.top=`${c}px`,e.style.left=`${n}px`,e.style.overflow="visible",e.style.pointerEvents="none",this.container.parentElement.appendChild(e),this.wrapper=e};this.renderSVGElementWrapper=()=>{let e=this.containerTagname.toLowerCase();if(e==="svg"){this.createSVGWrapper();return}if(e==="rect"){this.createRectWrapper();return}e==="ellipse"&&this.createEllipseWrapper()};if(this.container=document.getElementById(e),this.logger=new N("@superviz/sdk/presence"),!this.container){let c=`Element with id ${e} not found`;throw this.logger.log(c),new Error(c)}this.camera={x:0,y:0,scale:1,screen:{width:this.container.clientWidth,height:this.container.clientHeight}},this.name="presence";let{localParticipant:s}=this.useStore("global-store");s.subscribe(),this.containerTagname=this.container.tagName.toUpperCase(),this.goToPresenceCallback=(n=i==null?void 0:i.callbacks)==null?void 0:n.onGoToPresence}start(){this.logger.log("presence-mouse component @ start"),this.renderWrapper(),this.addListeners(),this.subscribeToRealtimeEvents(),this.eventBus.subscribe("realtime.private-mode",this.setParticipantPrivate),this.animationFrame=requestAnimationFrame(this.animate),this.eventBus.subscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.subscribe("realtime.local-follow-participant",this.followMouse)}destroy(){cancelAnimationFrame(this.animationFrame),this.logger.log("presence-mouse component @ destroy"),this.removeListeners(),this.wrapper.remove(),this.presences.clear(),this.presences=void 0,this.container=void 0,this.wrapper=void 0,this.unsubscribeFromRealtimeEvents(),this.eventBus.unsubscribe("realtime.private-mode",this.setParticipantPrivate),this.eventBus.unsubscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.unsubscribe("realtime.local-follow-participant",this.followMouse),this.logger=void 0}subscribeToRealtimeEvents(){this.logger.log("presence-mouse component @ subscribe to realtime events"),this.room.presence.on(_.JOINED_ROOM,this.onPresenceJoinedRoom),this.room.presence.on(_.LEAVE,this.onPresenceLeftRoom),this.room.presence.on(_.UPDATE,this.onPresenceUpdate)}unsubscribeFromRealtimeEvents(){this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.room.presence.off(_.JOINED_ROOM),this.room.presence.off(_.LEAVE),this.room.presence.off(_.UPDATE)}addListeners(){this.pointerMoveObserver=Qr(this.container,"pointermove").pipe(es(30)).subscribe(this.onMyParticipantMouseMove),this.container.addEventListener("pointerleave",this.onMyParticipantMouseLeave)}removeListeners(){var e;(e=this.pointerMoveObserver)==null||e.unsubscribe(),this.container.removeEventListener("pointerleave",this.onMyParticipantMouseLeave)}setPositionNotStatic(){let{position:e}=window.getComputedStyle(this.container);e==="static"&&this.container.style.setProperty("position","relative")}createMouseElement(e){if(!this.wrapper)return;let i=document.createElement("div");i.setAttribute("id",`mouse-${e.id}`),i.setAttribute("class","mouse-follower");let s=document.createElement("div");s.setAttribute("class","pointer-mouse");let n=document.createElement("div");return n.setAttribute("class","mouse-user-name"),n.innerHTML=e.name,i.appendChild(s),i.appendChild(n),i.style.left="0px",i.style.top="0px",this.wrapper.appendChild(i),this.mouses.set(e.id,i),i}updateSVGPosition(){let e=this.container.parentElement.getBoundingClientRect(),i=this.container.getBoundingClientRect(),s=i.left-e.left,n=i.top-e.top,{width:c,height:o}=this.container.getBoundingClientRect();this.wrapper.style.setProperty("width",`${c}px`),this.wrapper.style.setProperty("height",`${o}px`),this.wrapper.style.setProperty("top",`${n}px`),this.wrapper.style.setProperty("left",`${s}px`)}createSVGWrapper(){let e=document.createElement("div"),i=this.container.parentElement.getBoundingClientRect(),s=this.container.getBoundingClientRect(),n=s.left-i.left,c=s.top-i.top,{width:o,height:a}=this.container.getBoundingClientRect();e.style.position="fixed",e.style.width=`${o}px`,e.style.height=`${a}px`,e.style.top=`${c}px`,e.style.left=`${n}px`,e.style.overflow="visible",e.style.pointerEvents="none",e.id="superviz-svg-wrapper",this.container.parentElement.appendChild(e),this.wrapper=e}createRectWrapper(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=document.createElement("div"),n=this.container.getAttribute("width"),c=this.container.getAttribute("height"),o=this.container.getAttribute("rx"),a=this.container.getAttribute("ry");i.setAttribute("fill","transparent"),i.setAttribute("stroke","transparent"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("rx",o),i.setAttribute("ry",a),i.setAttribute("height",c),i.setAttribute("width",n),e.setAttribute("height",c),e.setAttribute("width",n),e.appendChild(i),s.appendChild(e);let l=this.container.getBoundingClientRect();s.style.position="fixed",s.style.top=`${l.top}px`,s.style.left=`${l.left}px`,s.style.width=`${l.width}px`,s.style.height=`${l.height}px`,s.style.overflow="visible",s.style.pointerEvents="none",s.id="superviz-rect-wrapper";let u=this.container.viewportElement;for(;u.viewportElement;)u=u.viewportElement;u.parentElement.appendChild(s),this.wrapper=s}createEllipseWrapper(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),s=document.createElement("div"),n=this.container.getAttribute("cx"),c=this.container.getAttribute("cy"),o=this.container.getAttribute("rx"),a=this.container.getAttribute("ry"),l=Number(n)-Number(o),u=Number(c)-Number(a),p=String(2*Number(n)),d=String(2*Number(c));i.setAttribute("fill","transparent"),i.setAttribute("stroke","transparent"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("rx",o),i.setAttribute("ry",a),i.setAttribute("cx",`${Number(n)-l}`),i.setAttribute("cy",`${Number(c)-u}`),i.setAttribute("height",d),i.setAttribute("width",p),e.setAttribute("height",d),e.setAttribute("width",p),e.appendChild(i),s.appendChild(e);let h=this.container.getBoundingClientRect();s.style.position="fixed",s.style.top=`${h.top}px`,s.style.left=`${h.left}px`,s.style.width=`${h.width}px`,s.style.height=`${h.height}px`,s.style.overflow="visible",s.style.pointerEvents="none",s.id="superviz-ellipse-wrapper";let f=this.container.viewportElement;for(;f.viewportElement;)f=f.viewportElement;f.parentElement.appendChild(s),this.wrapper=s}transform(e){var i,s;this.transformation=e,this.camera={x:e.translate.x,y:e.translate.y,scale:e.scale,screen:{width:((i=this.wrapper)==null?void 0:i.clientWidth)||1,height:((s=this.wrapper)==null?void 0:s.clientHeight)||1}},this.updateParticipantsMouses(!0)}updateVoidElementWrapper(){let e=this.container.getBoundingClientRect(),i=this.wrapper.getBoundingClientRect(),s=this.container;if((0,uo.isEqual)(e,i))return;let n=s.offsetLeft,c=s.offsetTop;this.wrapper.style.setProperty("width",`${e.width}px`),this.wrapper.style.setProperty("height",`${e.height}px`),this.wrapper.style.setProperty("top",`${c}px`),this.wrapper.style.setProperty("left",`${n}px`),this.wrapper.id="superviz-void-wrapper"}updateSVGElementWrapper(){let{left:e,top:i,width:s,height:n}=this.container.getBoundingClientRect(),{left:c,top:o,width:a,height:l}=this.wrapper.getBoundingClientRect();if(!(e===c&&i===o&&s===a&&n===l)){if(this.containerTagname.toLowerCase()==="svg"){this.updateSVGPosition();return}this.wrapper.style.setProperty("width",`${s}px`),this.wrapper.style.setProperty("height",`${n}px`),this.wrapper.style.setProperty("top",`${i}px`),this.wrapper.style.setProperty("left",`${e}px`)}}renderWrapper(){if(!this.wrapper){if(Di[this.containerTagname]){this.renderVoidElementWrapper();return}if(Bi[this.containerTagname]){this.renderSVGElementWrapper();return}this.renderElementWrapper()}}removePresenceMouseParticipant(e){let i=document.getElementById(`mouse-${e}`);i&&(i.remove(),this.presences.delete(e),this.mouses.delete(e))}renderElementWrapper(){let e=document.createElement("div");e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.top="0",e.style.left="0",e.style.overflow="visible",e.style.pointerEvents="none",this.setPositionNotStatic(),this.container.appendChild(e),this.wrapper=e}};var Ft=class{constructor(t,e){let i=document.getElementById(t);if(!i)throw new Error(`[Superviz] Container with id ${t} not found`);return i.tagName.toLowerCase()==="canvas"?new Fi(t,e):new Ui(t,e)}transform(t){}};m();m();var po=pe(Xi());m();var ji=class{constructor(t){this.room=t;this.logger=new N("@superviz/sdk/realtime-presence")}update(t){this.logger.log("Realtime Presence @ update presence",t),this.room.presence.update(t)}subscribe(t,e){this.logger.log("Realtime Presence @ subscribe",t),this.room.presence.on(t,e)}unsubscribe(t){this.logger.log("Realtime Presence @ unsubscribe",t),this.room.presence.off(t)}getAll(){return S(this,null,function*(){return this.logger.log("Realtime Presence @ get all"),new Promise((t,e)=>{this.room.presence.get(i=>t(i),i=>{let s=`[SuperViz] ${i.name} - ${i.message}`;this.logger.log(i),console.error(s),e(i)})})})}};var Dt=class extends be{constructor(e,i,s,n){super();this.state="DISCONNECTED";this.callbacksToSubscribeWhenJoined=[];this.publish=(0,po.default)((e,i)=>{if(this.state!=="CONNECTED"){let s=`Realtime channel ${this.name} is not started yet. You can't publish event ${e} before start`;this.logger.log(s),console.warn(`[SuperViz] ${s}`);return}this.channel.emit(`message:${this.name}`,{name:e,payload:i})},30);this.subscribe=(e,i)=>{if(this.state!=="CONNECTED"){this.callbacksToSubscribeWhenJoined.push({event:e,callback:i});return}this.observers[e]||(this.observers[e]=new j),this.observers[e].subscribe(i)};this.unsubscribe=(e,i)=>{var s;(s=this.observers[e])==null||s.unsubscribe(i)};this.fetchHistory=e=>S(this,null,function*(){if(this.state!=="CONNECTED"){let s="Realtime component is not started yet. You can't retrieve history before start";return this.logger.log(s),console.warn(`[SuperViz] ${s}`),null}return yield new Promise((s,n)=>{let c=o=>{var l;(l=o.events)!=null&&l.length||s(null);let a=o.events.reduce((u,p)=>{var d;return u[p.data.name]||(u[p.data.name]=[]),u[p.data.name].push({data:p.data.payload,connectionId:p.connectionId,name:p.data.name,participantId:(d=p.presence)==null?void 0:d.id,timestamp:p.timestamp}),u},{});e&&!a[e]&&n(new Error(`Event ${e} not found in the history`)),e&&s(a[e]),s(a)};this.channel.history(c)})});this.publishEventToClient=(e,i)=>{var s;this.logger.log("realtime channel @ publishEventToClient",{event:e,data:i}),(s=this.observers[e])==null||s.publish(i)};this.name=e,this.ioc=i,this.logger=new N("@superviz/sdk/realtime-channel"),this.channel=this.ioc.createRoom(`realtime:${this.name}`,n),this.localParticipant=s,this.subscribeToRealtimeEvents(),this.logger.log("started"),this.participant=new ji(this.channel)}disconnect(){return S(this,null,function*(){if(this.state==="DISCONNECTED"){this.logger.log("Realtime channel is already disconnected");return}this.logger.log("destroyed"),this.changeState("DISCONNECTED"),this.channel.disconnect()})}changeState(e){this.logger.log("realtime component @ changeState - state changed",e),this.state=e,this.publishEventToClient("realtime-channel.state-changed",this.state)}subscribeToRealtimeEvents(){this.channel.presence.on(_.JOINED_ROOM,e=>{e.id===this.localParticipant.id&&(this.changeState("CONNECTED"),this.callbacksToSubscribeWhenJoined.forEach(({event:i,callback:s})=>{this.subscribe(i,s)}),this.logger.log("joined room"),this.changeState("CONNECTED"))}),this.channel.on(`message:${this.name}`,e=>{var i,s;this.logger.log("message received",e),this.publishEventToClient(e.data.name,{data:e.data.payload,participantId:(s=(i=e==null?void 0:e.presence)==null?void 0:i.id)!=null?s:null,name:e.data.name,timestamp:e.timestamp,connectionId:e.connectionId})})}};var Bt=class extends X{constructor(){super();this.state="STOPPED";this.channels=new Map;this.callbacksToSubscribeWhenJoined=[];this.subscribe=(e,i)=>{if(!this.channel){this.callbacksToSubscribeWhenJoined.push({event:e,callback:i});return}this.channel.subscribe(e,i)};this.publish=(e,i)=>{var s;if(it[e.toUpperCase()]){this.channel.publishEventToClient(e,i);return}(s=this.channel)==null||s.publish(e,i)};this.unsubscribe=(e,i)=>{var s;(s=this.channel)==null||s.unsubscribe(e,i)};this.name="realtime",this.logger=new N("@superviz/sdk/realtime-component");let{localParticipant:e}=this.useStore("global-store");e.subscribe()}connect(e){if(!this.channel)return new Promise(s=>{let{localParticipant:n}=rt();n.subscribe("connect-after-init",c=>{c.activeComponents.includes("realtime")&&(n.unsubscribe("connect-after-init"),s(this.connect(e)))})});let i=this.channels.get(e);return i||(i=new Dt(e,this.ioc,this.localParticipant,this.connectionLimit),this.channels.set(e,i),this.state==="STARTED")?i:new Promise(s=>{this.subscribe("realtime-component.state-changed",n=>{n==="STARTED"&&s(i)})})}start(){this.logger.log("started"),this.channel=new Dt("default",this.ioc,this.localParticipant,this.connectionLimit),this.channel.subscribe("realtime-channel.state-changed",e=>{e==="CONNECTED"&&(this.callbacksToSubscribeWhenJoined.forEach(({event:i,callback:s})=>{this.channel.subscribe(i,s)}),this.changeState("STARTED"),this.callbacksToSubscribeWhenJoined=[],this.channel.unsubscribe("realtime-channel.state-changed"),this.participant=this.channel.participant,this.channels.set("default",this.channel))})}destroy(){this.logger.log("destroyed"),this.changeState("STOPPED"),this.disconnectFromAllChannels()}disconnectFromAllChannels(){this.channels.forEach(e=>e.disconnect())}changeState(e){var i;this.logger.log("realtime component @ changeState - state changed",e),this.state=e,(i=this.channel)==null||i.publishEventToClient("realtime-component.state-changed",this.state)}};m();var Ut=class extends X{constructor(e){var u;super();this.onParticipantListUpdate=e=>{if(this.localParticipantId===void 0||this.localParticipantId==="")return;if(!this.initialized){this.initialized=!0,this.initializeList();return}let i=L(y({},e.data),{tooltip:this.getTooltipData(e.data),controls:this.getControls(e.data)}),{participants:s,extras:n}=this.useStore("who-is-online-store");if(s.value.some(({id:l})=>l===e.data.id)){this.updateParticipant(i);return}if(n.value.some(({id:l})=>l===e.data.id)){this.updateExtra(i);return}if(s.value.length<4){s.publish([...s.value,i]);return}n.publish([...n.value,i])};this.onParticipantLeave=e=>{let{participants:i,extras:s}=this.useStore("who-is-online-store");if(i.value.findIndex(o=>o.id===e.id)===-1){let o=s.value.filter(a=>a.id!==e.id);s.publish(o);return}let c=i.value.filter(o=>o.id!==e.id);if(s.value.length){c.push(s.value[0]);let o=s.value.slice(1);s.publish(o)}i.publish(c)};this.updateParticipant=e=>{let{participants:i,extras:s}=this.useStore("who-is-online-store");if(e.isPrivate&&e.id!==this.localParticipantId){let c=i.value.filter(({id:a})=>a!==e.id),o=s.value.splice(0,1);i.publish([...c,...o]),s.publish([...s.value]);return}let n=i.value.map(c=>c.id===e.id?e:c);i.publish(n)};this.updateExtra=e=>{let{extras:i}=this.useStore("who-is-online-store");if(e.isPrivate&&e.id!==this.localParticipantId){let n=i.value.filter(({id:c})=>c!==e.id);i.publish(n);return}let s=i.value.map(n=>n.id===e.id?e:n);i.publish(s)};this.subscribeToLocalParticipantUpdates=e=>{if(!e.slot)return;this.localParticipantId=e.id;let{privateMode:i,joinedPresence:s}=this.useStore("who-is-online-store"),n=this.isInPresence(e.activeComponents);s.publish(n);let c=this.getParticipant(e);this.room.presence.update(L(y({},c),{isPrivate:i.value}))};this.goToMousePointer=e=>{var s,n,c;let i=(c=(s=e.presence)==null?void 0:s.id)!=null?c:(n=e.detail)==null?void 0:n.id;i!==this.localParticipantId&&(this.eventBus.publish("realtime.go-to-participant",i),this.publish("who-is-online.go-to-participant",i))};this.followMousePointer=({detail:e})=>{this.eventBus.publish("realtime.local-follow-participant",e.id),this.following&&this.publish("who-is-online.start-following-participant",this.following),this.following||this.publish("who-is-online.stop-following-participant"),e.source==="extras"&&this.highlightParticipantBeingFollowed(),this.updateParticipantsControls(e.id)};this.setPrivate=({detail:{isPrivate:e,id:i}})=>{let{privateMode:s,participants:n}=this.useStore("who-is-online-store"),c=n.value.find(o=>o.id===i);s.publish(e),this.eventBus.publish("realtime.private-mode",e),this.room.presence.update(L(y({},c),{isPrivate:e})),e&&this.publish("who-is-online.enter-private-mode"),e||this.publish("who-is-online.leave-private-mode")};this.setFollow=e=>{let{id:i}=e.presence;if(i===this.localParticipantId)return;let{data:s}=e,{following:n}=this.useStore("who-is-online-store");n.publish(s),this.followMousePointer({detail:{id:s}})};this.follow=({detail:e})=>{let{everyoneFollowsMe:i}=this.useStore("who-is-online-store");i.publish(!!(e!=null&&e.id)),this.room.emit("who-is-online.start-follow-me",e),this.following&&this.publish("who-is-online.start-follow-me",this.following),this.following||this.publish("who-is-online.stop-follow-me"),this.updateParticipantsControls(e==null?void 0:e.id)};this.stopFollowing=e=>{var s;if(e.id!==((s=this.following)==null?void 0:s.id))return;let{following:i}=this.useStore("who-is-online-store");i.publish(void 0),this.eventBus.publish("realtime.local-follow-participant",void 0),this.publish("who-is-online.stop-following-participant")};this.gather=e=>{this.room.emit("who-is-online.gather-all",e.detail.id),this.publish("who-is-online.gather-all",e.detail.id)};this.onJoinedRoom=e=>{if(e.id!==this.localParticipantId)return;let{localParticipant:i}=this.useStore("global-store");i.subscribe(this.subscribeToLocalParticipantUpdates)};this.name="whoIsOnline",this.logger=new N("@superviz/sdk/who-is-online-component");let{disablePresenceControls:i,disableGoToParticipant:s,disableFollowParticipant:n,disablePrivateMode:c,disableGatherAll:o,disableFollowMe:a,following:l}=this.useStore("who-is-online-store");if(l.subscribe(),typeof e!="object"){this.position=e!=null?e:"top-right";return}typeof e=="object"&&(this.position=(u=e.position)!=null?u:"top-right",this.setStyles(e.styles),i.publish(e.disablePresenceControls),s.publish(e.disableGoToParticipant),n.publish(e.disableFollowParticipant),c.publish(e.disablePrivateMode),o.publish(e.disableGatherAll),a.publish(e.disableFollowMe))}start(){let{localParticipant:e}=this.useStore("global-store");this.localParticipantId=e.value.id,this.subscribeToRealtimeEvents(),this.positionWhoIsOnline(),this.addListeners()}destroy(){this.unsubscribeFromRealtimeEvents(),this.removeListeners(),this.element.remove(),this.element=null,this.initialized=!1;let{destroy:e}=this.useStore("who-is-online-store");e()}addListeners(){this.element.addEventListener("realtime.local-follow-participant",this.followMousePointer),this.element.addEventListener("realtime.go-to-participant",this.goToMousePointer),this.element.addEventListener("realtime.private-mode",this.setPrivate),this.element.addEventListener("realtime.follow-participant",this.follow),this.element.addEventListener("realtime.gather",this.gather)}removeListeners(){this.element.removeEventListener("realtime.local-follow-participant",this.followMousePointer),this.element.removeEventListener("realtime.go-to-participant",this.goToMousePointer),this.element.removeEventListener("realtime.private-mode",this.setPrivate),this.element.removeEventListener("realtime.follow-participant",this.follow),this.element.removeEventListener("realtime.gather",this.gather)}subscribeToRealtimeEvents(){this.room.presence.on(_.UPDATE,this.onParticipantListUpdate),this.room.presence.on(_.LEAVE,this.onParticipantLeave),this.room.presence.on(_.LEAVE,this.stopFollowing),this.room.presence.on(_.JOINED_ROOM,this.onJoinedRoom),this.room.on("who-is-online.gather-all",this.goToMousePointer),this.room.on("who-is-online.start-follow-me",this.setFollow)}unsubscribeFromRealtimeEvents(){this.room.presence.off(_.UPDATE),this.room.presence.off(_.LEAVE),this.room.presence.off(_.JOINED_ROOM),this.room.off("who-is-online.gather-all",this.goToMousePointer),this.room.off("who-is-online.start-follow-me",this.setFollow)}initializeList(){let{participants:e,extras:i}=this.useStore("who-is-online-store");this.room.presence.get(s=>{let n=s.filter(l=>l.data.id).map(({data:l})=>{let u=l.avatar;u||(u=this.getAvatar({avatar:l.avatar,color:l.slot.color,name:l.name,letterColor:l.slot.textColor}));let p=this.getTooltipData(l),d=this.getControls(l);return L(y({},l),{tooltip:p,controls:d,avatar:u,isLocalParticipant:l.id===this.localParticipantId})});if(!n.length)return;let c=n.findIndex(l=>l.id===this.localParticipantId),o=n.splice(c,1)[0],a=n.splice(0,3);e.publish([o,...a]),i.publish(n)})}setStyles(e=""){if(!e)return;let i=document.createElement("style");i.textContent=e,i.id="superviz-who-is-online-styles",document.head.appendChild(i)}positionWhoIsOnline(){if(this.element=document.createElement("superviz-who-is-online"),Object.values(ss).includes(this.position.toLowerCase())){document.body.appendChild(this.element);let[s,n]=this.position.split("-");this.element.position=`${s}: 20px; ${n}: 40px;`;return}let i=document.getElementById(this.position);if(!i){this.element.position="top: 20px; right: 40px;",document.body.appendChild(this.element);return}i.appendChild(this.element),this.element.position="position: relative;"}getParticipant(e){let{avatar:i,activeComponents:s,id:n,name:c,slot:{color:o,textColor:a}}=e,l=this.shouldDisableDropdown({activeComponents:s,participantId:n}),u=this.getAvatar({avatar:i,color:o,name:c,letterColor:a});return{id:n,name:c,avatar:u,disableDropdown:l,activeComponents:s,isPrivate:!1}}shouldDisableDropdown({activeComponents:e,participantId:i}){let{joinedPresence:{value:s},disablePresenceControls:{value:n},disableFollowMe:{value:c},disableFollowParticipant:{value:o},disableGoToParticipant:{value:a},disableGatherAll:{value:l},disablePrivateMode:{value:u}}=this.useStore("who-is-online-store");return s===!1||n===!0||i===this.localParticipantId&&c&&u&&l||i!==this.localParticipantId&&o&&a?!0:!(e!=null&&e.some(p=>p.toLowerCase().includes("presence")))}getTooltipData(e){let{name:i,disableDropdown:s,id:n}=e,c=n===this.localParticipantId,o={name:i};return c&&(o.name+=" (You)"),!s&&!c&&(o.info="Click to follow"),o}getAvatar({avatar:e,color:i,name:s,letterColor:n}){var a,l;let c=e==null?void 0:e.imageUrl,o=(l=(a=s==null?void 0:s.at(0))==null?void 0:a.toUpperCase())!=null?l:"A";return{imageUrl:c,firstLetter:o,color:i,letterColor:n}}getControls(e){let{disablePresenceControls:i}=this.useStore("who-is-online-store"),{disableDropdown:s,id:n}=e;return i.value||s?[]:n===this.localParticipantId?this.getLocalParticipantControls():this.getOtherParticipantsControls(n)}getOtherParticipantsControls(e){var o;let{disableGoToParticipant:i,disableFollowParticipant:s,following:n}=this.useStore("who-is-online-store"),c=[];if(i.value||c.push({label:"go to",icon:"place"}),!s.value){let a=((o=n.value)==null?void 0:o.id)===e,l=a?"unfollow":"follow",u=a?"send-off":"send";c.push({label:l,icon:u})}return c}getLocalParticipantControls(){let{disableFollowMe:{value:e},disableGatherAll:{value:i},disablePrivateMode:{value:s},everyoneFollowsMe:{value:n},privateMode:{value:c}}=this.useStore("who-is-online-store"),o=[];if(i||o.push({label:"gather all",icon:"gather"}),!e){let a=n?"send-off":"send",l=n?"stop followers":"everyone follows me";o.push({label:l,icon:a})}if(!s){let a=c?"eye_inative":"eye",l=c?"leave private mode":"private mode";o.push({label:l,icon:a})}return o}updateParticipantsControls(e){let{participants:i}=this.useStore("who-is-online-store"),s=i.value.map(n=>{if(e&&n.id!==e)return n;let{id:c}=n,o=this.getControls(n);return L(y({},n),{controls:o})});i.publish(s)}highlightParticipantBeingFollowed(){let{extras:e,participants:i,following:{value:s}}=this.useStore("who-is-online-store"),n=i.value[0],c=e.value.findIndex(l=>l.id===s.id),o=e.value.splice(c,1)[0];i.value.unshift(n),i.value[1]=o;let a=i.value.pop();e.value.push(a),e.publish(e.value),i.publish(i.value)}isInPresence(e){return e==null?void 0:e.some(i=>i.includes("presence"))}};m();var jt=class extends X{constructor(e={}){super();this.fields={};this.fieldsOriginalOutline={};this.focusList={};this.enabledOutlineFields={};this.enabledRealtimeSyncFields={};this.flags={};this.allowedTagNames=["input","textarea"];this.allowedInputTypes=["text","email","date","color","datetime-local","month","number","password","range","search","tel","time","url","week","checkbox","radio"];this.throwError={onInvalidFieldsProp:e=>{throw new Error(`"Fields" property must be either a string or an array of strings. Received type: ${e}`)},onFieldNotFound:e=>{throw new Error(`You must pass the id of an existing element. Element with id ${e} not found`)},onInvalidTagName:e=>{throw new Error(`You can't register an element with tag ${e}. Only the tags "${this.allowedTagNames.join(", ")}" are allowed`)},onInvalidInputType:e=>{throw new Error(`You can't register an input element of type ${e}. Only the types "${this.allowedInputTypes.join(", ")}" are allowed`)},onDeregisterInvalidField:e=>{throw new Error(`You can't deregister field of id ${e}. No field was registered with id ${e} `)}};this.sync=e=>{var o,a;let i=this.fields[e],s=this.hasCheckedProperty(i),c={value:s?i.checked:i.value,color:this.localParticipant.slot.color,fieldId:e,showOutline:this.canUpdateColor(e),syncContent:this.canSyncContent(e),attribute:s?"checked":"value"};(o=this.room)==null||o.emit("field.content-change"+e,c),(a=this.room)==null||a.emit("field.interaction"+e,c)};this.handleInput=e=>{var c,o,a,l;let i=e.target;(o=this.room)==null||o.emit("field.interaction"+i.id,{fieldId:i.id,color:(c=this.localParticipant.slot)==null?void 0:c.color});let s=this.canSyncContent(i.id);if(!s)return;let n={value:i.value,color:(a=this.localParticipant.slot)==null?void 0:a.color,fieldId:i.id,showOutline:this.canUpdateColor(i.id),syncContent:s,attribute:"value"};(l=this.room)==null||l.emit("field.content-change"+i.id,n)};this.handleChange=e=>{var c;let i=e.target;if(!this.canSyncContent(i.id))return;let n={fieldId:i.id,value:i.checked,color:this.localParticipant.slot.color,showOutline:this.canUpdateColor(i.id),syncContent:this.canSyncContent(i.id),attribute:"checked"};(c=this.room)==null||c.emit("field.content-change"+i.id,n)};this.handleFocus=e=>{var n;let i=e.target,s={color:this.localParticipant.slot.color,fieldId:i.id};(n=this.room)==null||n.emit("field.focus"+i.id,s)};this.handleBlur=e=>{var n;let i=e.target,s={fieldId:i.id};(n=this.room)==null||n.emit("field.blur"+i.id,s)};this.removeFieldColor=({presence:e,data:{fieldId:i}})=>{var s,n;((s=this.focusList[i])==null?void 0:s.id)!==e.id||!this.fields[i]||(this.fields[i].style.outline=(n=this.fieldsOriginalOutline[i])!=null?n:"",delete this.fieldsOriginalOutline[i],delete this.focusList[i])};this.updateFieldColor=({presence:e,data:{color:i,fieldId:s},timestamp:n})=>{var f;let c=(f=this.focusList[s])!=null?f:{},o=!c.id,a=e.id===this.localParticipant.id;if(o&&a){this.focusList[s]={id:e.id,color:i,firstInteraction:n,lastInteraction:n};return}if(c.id===e.id){this.focusList[s].lastInteraction=n;return}let u=n-c.lastInteraction>=3e3,p=n-c.firstInteraction>=1e4;if(!(u||p||o))return;this.focusList[s]={id:e.id,color:i,firstInteraction:n,lastInteraction:n};let h=a?this.fieldsOriginalOutline[s]:`1px solid ${i}`;this.fields[s].style.outline=h};this.updateFieldContent=p=>{var d=p,{presence:e,data:{value:i,fieldId:s,color:n,showOutline:c,syncContent:o,attribute:a},timestamp:l}=d,u=Gi(d,["presence","data","timestamp"]);this.publish("field.content-change",{value:i,fieldId:s,attribute:a,userId:e.id,userName:e.name,timestamp:l}),o&&this.canSyncContent(s)&&e.id!==this.localParticipant.id&&(this.fields[s][a]=i),c&&this.canUpdateColor(s)&&this.updateFieldColor(y({presence:e,data:{color:n,fieldId:s},timestamp:l},u))};this.publishTypedEvent=({presence:e,data:{fieldId:i,color:s}})=>{this.publish("field.interaction",{fieldId:i,userId:e.id,userName:e.name,color:s})};this.canSyncContent=e=>!this.flags.disableRealtimeSync&&this.enabledRealtimeSyncFields[e]!==!1||!!this.enabledRealtimeSyncFields[e];this.name="formElements",this.logger=new N("@superviz/sdk/presence-input-component");let n=e,{fields:i}=n,s=Gi(n,["fields"]);if(this.flags=s!=null?s:{},typeof i=="string"){this.validateField(i),this.fields[i]=null;return}if(Array.isArray(i)){i.forEach(c=>{this.validateField(c),this.fields[c]=null});return}i!==void 0&&this.throwError.onInvalidFieldsProp(typeof i)}enableOutline(e){let i=this.fields[e];i&&(this.enabledOutlineFields[e]=!0,this.fieldsOriginalOutline[e]=i.style.outline,i.addEventListener("focus",this.handleFocus),i.addEventListener("blur",this.handleBlur),this.room.on("field.focus"+e,this.updateFieldColor),this.room.on("field.blur"+e,this.removeFieldColor))}disableOutline(e){var s,n;let i=this.fields[e];i&&(this.enabledOutlineFields[e]=!1,i.style.outline=(s=this.fieldsOriginalOutline[e])!=null?s:"",i.removeEventListener("focus",this.handleFocus),i.removeEventListener("blur",this.handleBlur),this.room.off("field.focus"+e,this.updateFieldColor),this.room.off("field.blur"+e,this.removeFieldColor),(n=this.room)==null||n.emit("field.blur"+e,{fieldId:e}))}enableRealtimeSync(e){this.enabledRealtimeSyncFields[e]=!0}disableRealtimeSync(e){this.enabledRealtimeSyncFields[e]=!1}registerField(e){this.validateField(e);let i=document.getElementById(e);this.fields[e]=i,this.addListenersToField(i),this.addRealtimeListenersToField(e),this.fieldsOriginalOutline[e]=i.style.outline}deregisterField(e){var i;this.fields[e]||this.throwError.onDeregisterInvalidField(e),this.removeListenersFromField(this.fields[e]),this.removeRealtimeListenersFromField(e),this.fields[e].style.outline=this.fieldsOriginalOutline[e],this.fields[e]=void 0,delete this.enabledOutlineFields[e],delete this.enabledRealtimeSyncFields[e],delete this.fieldsOriginalOutline[e],delete this.focusList[e],(i=this.room)==null||i.emit("field.blur"+e,{fieldId:e})}start(){let{localParticipant:e}=this.useStore("global-store");e.subscribe(),Object.entries(this.fields).forEach(([i])=>{this.registerField(i)})}destroy(){this.restoreOutlines(),this.deregisterAllFields(),this.fieldsOriginalOutline=void 0,this.focusList=void 0}addListenersToField(e){let{type:i}=e;this.hasCheckedProperty(e)?e.addEventListener("change",this.handleChange):e.addEventListener("input",this.handleInput),!this.flags.disableOutline&&(e.addEventListener("focus",this.handleFocus),e.addEventListener("blur",this.handleBlur))}addRealtimeListenersToField(e){this.room&&(this.room.on("field.content-change"+e,this.updateFieldContent),this.room.on("field.interaction"+e,this.publishTypedEvent),!this.flags.disableOutline&&(this.room.on("field.focus"+e,this.updateFieldColor),this.room.on("field.blur"+e,this.removeFieldColor)))}removeListenersFromField(e){this.hasCheckedProperty(e)?e.removeEventListener("change",this.handleChange):e.removeEventListener("input",this.handleInput),!this.flags.disableOutline&&(e.removeEventListener("focus",this.handleFocus),e.removeEventListener("blur",this.handleBlur))}removeRealtimeListenersFromField(e){this.room&&(this.room.off("field.content-change"+e,this.updateFieldContent),this.room.off("field.interaction"+e,this.publishTypedEvent),!this.flags.disableOutline&&(this.room.off("field.focus"+e,this.updateFieldColor),this.room.off("field.blur"+e,this.removeFieldColor)))}deregisterAllFields(){Object.keys(this.fields).forEach(e=>{this.deregisterField(e)}),this.fields=void 0}validateField(e){this.validateFieldId(e);let i=document.getElementById(e);this.validateFieldTagName(i),this.validateFieldType(i)}validateFieldTagName(e){let i=e.tagName.toLowerCase();this.allowedTagNames.includes(i)||(this.logger.log("invalid element tagname"),this.throwError.onInvalidTagName(i))}validateFieldType(e){if(e.tagName.toLowerCase()!=="input")return;let i=e.getAttribute("type"),s=this.allowedInputTypes.includes(i);i&&!s&&(this.logger.log("invalid input type"),this.throwError.onInvalidInputType(i))}validateFieldId(e){document.getElementById(e)||this.throwError.onFieldNotFound(e)}restoreOutlines(){Object.entries(this.fields).forEach(([e])=>{this.fields[e].style.outline=this.fieldsOriginalOutline[e]})}hasCheckedProperty(e){let i=e.tagName.toLowerCase(),s=e.getAttribute("type");return i==="input"&&(s==="radio"||s==="checkbox")}canUpdateColor(e){return!this.flags.disableOutline&&this.enabledOutlineFields[e]!==!1||this.enabledOutlineFields[e]}};typeof window!="undefined"&&(window.SuperVizRoom={init:jr,CommentEvent:Hi,MeetingEvent:Gt,DeviceEvent:Yr,RealtimeEvent:Me,MeetingState:Wi,MeetingConnectionStatus:Ht,MeetingControlsEvent:Vt,ParticipantEvent:Vi,FrameEvent:Wt,LayoutMode:Ai,VideoConference:Nt,MousePointers:Ft,Realtime:Bt,Comments:Mt,CanvasPin:Lt,HTMLPin:Rt,WhoIsOnline:Ut,FormElements:jt,ParticipantType:Ke,LayoutPosition:St,CamerasPosition:Oi,RealtimeComponentState:Si,RealtimeComponentEvent:Mi,ComponentLifeCycleEvent:it,WhoIsOnlineEvent:zi,StoreType:Q,PresenceEvents:_,FieldEvents:Li,PinMode:zt,Comment});var ub=jr;export{Oi as CamerasPosition,Lt as CanvasPin,Hi as CommentEvent,Mt as Comments,it as ComponentLifeCycleEvent,Yr as DeviceEvent,Li as FieldEvents,jt as FormElements,Wt as FrameEvent,Rt as HTMLPin,Ai as LayoutMode,St as LayoutPosition,Ht as MeetingConnectionStatus,Vt as MeetingControlsEvent,Gt as MeetingEvent,Wi as MeetingState,Ft as MousePointers,Vi as ParticipantEvent,Ke as ParticipantType,zt as PinMode,_ as PresenceEvents,Bt as Realtime,Mi as RealtimeComponentEvent,Si as RealtimeComponentState,Me as RealtimeEvent,Q as StoreType,Nt as VideoConference,Ut as WhoIsOnline,zi as WhoIsOnlineEvent,ub as default};
//# sourceMappingURL=index.js.map
