"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const a=require("./index-N3n6WSly.cjs"),r=require("./chunk-K5TMEGOR-CjzheANK.cjs");require("./chunk-3MEZQQ2J-Bai2OMk0.cjs");const l=require("./chunk-SDMTFDEM-DMM8sQyi.cjs"),p=require("./chunk-6U6BYUHV-h-2X1uK0.cjs"),d=require("./chunk-MVFOLHBC-C85clPX2.cjs"),o=require("./chunk-WG46WHJF-D0x9jAhS.cjs");a.y();var c=d.D(o.C),u=[c.styles,l.c];exports.CommentsAnnotationPin=class extends c{constructor(){super(),this.focusInput=()=>{var t,n;this.inputElement||(this.inputElement=(n=(t=this.shadowRoot)==null?void 0:t.querySelector("superviz-comments-comment-input"))==null?void 0:n.shadowRoot.querySelector("textarea")),this.inputElement.focus()},this.setInputSide=()=>{let t=this.commentsSide==="right"?320:0,n=this.annotationSides.right+293,i=this.containerSides.right-t;if(n<i){this.horizontalSide="right";return}t=this.commentsSide==="left"?320:0;let e=this.annotationSides.left-293,s=this.containerSides.left+t;if(e>s){this.horizontalSide="left";return}this.horizontalSide=s-e>n-i?"right":"left"},this.createComment=({detail:t})=>{this.annotationSent=!0,document.body.dispatchEvent(new CustomEvent("create-annotation",{detail:a.B(a.A({},t),{position:a.B(a.A({},this.originalPosition),{type:"canvas"})})})),this.annotation=null},this.cancelTemporaryAnnotation=()=>{this.annotation=null},this.cancelTemporaryAnnotationEsc=t=>{this.annotation=null},this.avatar=()=>{if(this.type==="add"&&!this.showInput)return o.Vt`<div
        class="comments__annotation-pin__avatar comments__annotation-pin__avatar--add"
      >
        <superviz-icon name="add"></superviz-icon>
      </div>`;let t=this.userAvatar;return t?o.Vt`<div class="comments__annotation-pin__avatar">
        <img src=${t} />
      </div>`:o.Vt`<div class="comments__annotation-pin__avatar">
      <p class="text text-bold text-big">${this.userInitial}</p>
    </div>`},this.input=()=>{if(!(!this.showInput||this.annotationSent))return o.Vt`<div class="floating-input">
      <superviz-comments-comment-input
        @create-annotation=${this.createComment}
        eventType="create-annotation"
        @comment-input-ready=${this.focusInput}
        participantsList=${JSON.stringify(this.participantsList)}
      >
      </superviz-comments-comment-input>
    </div>`},this.position={x:0,y:0},setTimeout(()=>{this.firstLoad=!1},800)}updated(t){super.updated(t),!(!t.has("movedPosition")||!this.annotationSides)&&(this.annotationSides=this.pinAnnotation.getBoundingClientRect(),this.setInputSide(),this.inputElement&&this.focusInput())}firstUpdated(t){var n;super.firstUpdated(t),p.n.call(this,["comments"]),this.showInput&&(this.originalPosition=a.A({},this.position),this.pinAnnotation=(n=this.shadowRoot)==null?void 0:n.querySelector(".comments__annotation-pin"),this.annotationSides=this.pinAnnotation.getBoundingClientRect(),this.setInputSide())}connectedCallback(){if(super.connectedCallback(),this.type!=="add")return;let{localParticipant:t}=this.useStore("global-store");t.subscribe(n=>{var i;this.localAvatar=(i=n==null?void 0:n.avatar)==null?void 0:i.imageUrl,this.localName=n==null?void 0:n.name}),window.document.body.addEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.addEventListener("keyup",n=>{n.key==="Escape"&&this.cancelTemporaryAnnotationEsc(n)})}disconnectedCallback(){super.disconnectedCallback(),this.type==="add"&&(window.document.body.removeEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.removeEventListener("keyup",t=>{t.key==="Escape"&&this.cancelTemporaryAnnotationEsc(t)}))}get userAvatar(){var t,n,i,e;return((e=(i=(n=(t=this.annotation)==null?void 0:t.comments)==null?void 0:n.at(0))==null?void 0:i.participant)==null?void 0:e.avatar)||this.localAvatar}get userInitial(){var t,n,i,e,s;return(((s=(e=(i=(n=(t=this.annotation)==null?void 0:t.comments)==null?void 0:n.at(0))==null?void 0:i.participant)==null?void 0:e.name)!=null?s:this.localName)||"Anonymous")[0].toUpperCase()}emitClick(){var t;document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:(t=this.annotation)==null?void 0:t.uuid}}))}render(){let t={"comments__annotation-pin":!0,preload:this.firstLoad===void 0,"comments__annotation-pin--active":this.active,"comments__cursor-pointer":this.type==="add"&&!this.showInput,"comments__annotation-pin--add":this.type==="add"&&this.showInput,[this.horizontalSide]:!0},n={"comments__annotation-pin-wrapper":!0,"comments__annotation-pin-wrapper--new":this.newPin},i=this.keepPositionRatio?"%":"px",e=`top: ${this.position.y}${i}; left: ${this.position.x}${i};`;return this.type==="add"?o.Vt`
        <div class=${r.u(t)} style=${e}>${this.avatar()} ${this.input()}</div>
      `:o.Vt`<div class=${r.u(n)} style=${e}>
      <div @click=${this.emitClick} class=${r.u(t)}>${this.avatar()}</div>
    </div> `}};exports.CommentsAnnotationPin.styles=u,exports.CommentsAnnotationPin.properties={type:{type:String},annotation:{type:Object},position:{type:Object},active:{type:Boolean},showInput:{type:Boolean},containerSides:{type:Object},horizontalSide:{type:String},commentsSide:{type:String},movedPosition:{type:String},pinAnnotation:{type:Object},localAvatar:{type:String},annotationSent:{type:Boolean},localName:{type:String},keepPositionRatio:{type:Boolean},participantsList:{type:Object},firstLoad:{type:Boolean},newPin:{type:Boolean}},exports.CommentsAnnotationPin=a.F([o.ts("superviz-comments-annotation-pin")],exports.CommentsAnnotationPin);
