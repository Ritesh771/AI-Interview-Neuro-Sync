"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("react"),p=require("./room-DPWLzMyU.cjs"),m=require("./index-N3n6WSly.cjs");function C(b){const[s,l]=t.useState(!1),[c,f]=t.useState(!1),{component:n,room:d,...a}=p.useInternalFeatures("realtime"),i=t.useRef({}),r=t.useRef(null);t.useEffect(()=>{if(n){if(n.state===m.Si.STARTED){l(!0);return}n.subscribe("realtime-component.state-changed",e=>{l(e===m.Si.STARTED)})}},[n,i.current]),t.useEffect(()=>{(async()=>{if(!(!s&&!r.current||!n)){if(r.current=await n.connect(b),r.current.state==="CONNECTED"){f(!0);return}r.current.subscribe("realtime-channel.state-changed",e=>{f(e==="CONNECTED")})}})()},[s]),t.useEffect(()=>{r.current&&!d&&(r.current.disconnect(),r.current=null,f(!1),l(!1))},[n,d]),t.useEffect(()=>{c&&Object.keys(i.current).length&&(Object.entries(i.current).forEach(([e,u])=>{u.forEach(o=>{r.current.subscribe(e,o)})}),i.current={})},[c]);const y=t.useCallback((e,u)=>{if(!r.current){const o=i.current[e]||[];i.current[e]=o.includes(u)?o:[...o,u];return}r.current.subscribe(e,u)},[n,a,i.current]),h=t.useCallback((e,u)=>{!s||!c||r.current.publish(e,u)},[n,a,s]),E=t.useCallback((e,u)=>{!s||!c||r.current.unsubscribe(e,u)},[n,a,s]),S=t.useCallback(async e=>s?c?await r.current.fetchHistory(e):(console.warn(`[SuperViz] Channel ${b} is not ready - try again later`),Promise.resolve(null)):(console.warn("[SuperViz] Realtime component is not ready - try again later"),Promise.resolve(null)),[n,a,s]);return t.useMemo(()=>({isReady:c&&s,publish:h,subscribe:y,unsubscribe:E,fetchHistory:S}),[n,a,s,c])}exports.useRealtime=C;
