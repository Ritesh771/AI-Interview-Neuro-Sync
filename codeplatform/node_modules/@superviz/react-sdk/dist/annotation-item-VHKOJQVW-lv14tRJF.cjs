"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const p=require("./index-N3n6WSly.cjs"),s=require("./chunk-K5TMEGOR-CjzheANK.cjs");require("./chunk-3MEZQQ2J-Bai2OMk0.cjs");const C=require("./chunk-SDMTFDEM-DMM8sQyi.cjs"),g=require("./chunk-6U6BYUHV-h-2X1uK0.cjs"),A=require("./chunk-MVFOLHBC-C85clPX2.cjs"),a=require("./chunk-WG46WHJF-D0x9jAhS.cjs");p.y();var u=A.D(a.C),y=[u.styles,C.p];exports.CommentsAnnotationItem=class extends u{constructor(){super(...arguments),this.selectAnnotation=t=>{let{uuid:e}=this.annotation;document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:e}}))},this.resolveAnnotation=({detail:t})=>{let{uuid:e}=this.annotation,{resolved:n,type:i}=t,o=i==="resolve-annotation"&&this.annotationFilter==="All comments";this.emitEvent("resolve-annotation",{uuid:e,resolved:n}),o&&(this.shouldShowUndoResolved=!0)},this.hideUndoResolved=()=>{this.shouldShowUndoResolved=!1},this.generateExpandedCommentsTemplate=(t,e)=>{var n,i,o,l;return e===0?a.Vt``:a.Vt`
      <superviz-comments-comment-item
        uuid=${t.uuid}
        avatar=${(l=(o=(i=(n=this.annotation)==null?void 0:n.comments)==null?void 0:i.at(e))==null?void 0:o.participant)==null?void 0:l.avatar}
        username=${t.participant.name||"Anonymous"}
        text=${t.text}
        createdAt=${t.createdAt}
        annotationId=${this.annotation.uuid}
        participantsList=${JSON.stringify(this.participantsList)}
        mentions=${JSON.stringify(t.mentions)}
        class="comments__replies"
      ></superviz-comments-comment-item>
    `},this.updateEditMode=({detail:{editing:t}})=>{this.hideInput=t}}firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{g.n.call(this,["comments"])})}get filterIsAll(){return this.annotationFilter==="All comments"}get filterIsResolved(){return this.annotationFilter==="Resolved comments"}get shouldHideAnnotation(){return{hidden:this.resolved&&this.filterIsAll||!this.resolved&&this.filterIsResolved}}get replies(){return[...this.annotation.comments].splice(1).length}get repliesSize(){return this.replies>=5?5:this.replies}get replyText(){return this.replies!==1?"replies":"reply"}get isSelected(){return this.selected===this.annotation.uuid}get annotationClasses(){return{comments__thread:!0,"comments__thread--selected":this.isSelected,"extra-space-bottom":this.replies}}get mainAnnotationClasses(){return{"comments__main-annotation":!0,"comments__main-annotation--selected":this.isSelected}}get hrClasses(){return{"sv-hr":!0,hidden:this.isLastAnnotation}}get avatarCommentsClasses(){return{"avatars-comments":!0,"comment-avatar--expand":!this.expandComments&&this.replies>1,invisible:!(!this.expandComments&&this.replies>=1)}}get containerWrapperClasses(){return{"comments-container-wrapper":!0,show:this.isSelected&&this.expandComments}}get commentsClasses(){return{"comments-container":!0,"comment-item--expand":this.isSelected&&this.expandComments,show:this.isSelected&&this.expandComments}}updated(t){if(t.has("selected")){let e=this.selected===this.annotation.uuid;this.expandComments=e}}createComment({detail:t}){let{text:e,mentions:n}=t;this.emitEvent("create-comment",{uuid:this.annotation.uuid,mentions:n,text:e})}generateAvatarCommentsTemplate(){var t,e,n,i,o,l;let m=[];for(let r=1;r<=this.repliesSize;r++)(e=(t=this.annotation.comments[r])==null?void 0:t.participant)!=null&&e.avatar?m.push(a.Vt`
          <div class="avatar">
            <img src=${(i=(n=this.annotation.comments[r])==null?void 0:n.participant)==null?void 0:i.avatar} />
          </div>
        `):m.push(a.Vt`
          <div class="avatar">
            <p class="text text-bold">
              ${((l=(o=this.annotation.comments[r])==null?void 0:o.participant.name[0])==null?void 0:l.toUpperCase())||"A"}
            </p>
          </div>
        `);return a.Vt`
      ${m}
      <div class="text text-big sv-gray-500">${this.replies} ${this.replyText}</div>
    `}annotationResolvedTemplate(){return this.shouldShowUndoResolved?a.Vt`
      <superviz-comments-annotation-resolved
        @undo-resolve=${this.resolveAnnotation}
        @hide=${this.hideUndoResolved}
        class=${s.u({hidden:this.filterIsResolved,"comments__resolved-annotation-message":!0})}
      >
      </superviz-comments-annotation-resolved>
    `:a.Vt``}get inputClasses(){return{"hide-input":this.hideInput}}get wrapperClasses(){return{wrapper:!0,"show-wrapper":!this.resolved&&this.filterIsAll||this.resolved&&this.filterIsResolved}}render(){var t,e,n,i,o,l,m,r,d,c,h;let v={"comments__complete-annotation":!0,"comments__hide-complete-annotation":this.shouldShowUndoResolved};return a.Vt`
      <div class="${s.u(v)}">
        ${this.annotationResolvedTemplate()}

        <div class=${s.u(this.wrapperClasses)}>
          <div class=${s.u(this.shouldHideAnnotation)}>
            <div class=${s.u(this.annotationClasses)} @click=${this.selectAnnotation}>
              <div class=${s.u(this.mainAnnotationClasses)}>
                <superviz-comments-comment-item
                  uuid=${(t=this.annotation.comments)==null?void 0:t[0].uuid}
                  annotationId=${this.annotation.uuid}
                  username=${((n=(e=this.annotation.comments)==null?void 0:e[0].participant)==null?void 0:n.name)||"Anonymous"}
                  text=${(i=this.annotation.comments)==null?void 0:i[0].text}
                  createdAt=${(o=this.annotation.comments)==null?void 0:o[0].createdAt}
                  participantsList=${JSON.stringify(this.participantsList)}
                  primaryComment
                  avatar=${(d=(r=(m=(l=this.annotation)==null?void 0:l.comments)==null?void 0:m.at(0))==null?void 0:r.participant)==null?void 0:d.avatar}
                  resolvable
                  ?resolved=${this.resolved}
                  annotationFilter=${this.annotationFilter}
                  @resolve-annotation=${this.resolveAnnotation}
                  mentions=${JSON.stringify((c=this.annotation.comments)==null?void 0:c[0].mentions)}
                  class="comments__annotation"
                  @edit-comment=${this.updateEditMode}
                ></superviz-comments-comment-item>
              </div>

              <div class=${s.u(this.containerWrapperClasses)}>
                <div class=${s.u(this.commentsClasses)}>
                  ${(h=this.annotation.comments)==null?void 0:h.map(this.generateExpandedCommentsTemplate)}
                  <span class=${s.u(this.inputClasses)}>
                    <superviz-comments-comment-input
                      @create-comment=${this.createComment}
                      eventType="create-comment"
                      @click=${$=>$.stopPropagation()}
                      placeholder="Reply"
                      participantsList=${JSON.stringify(this.participantsList)}
                    ></superviz-comments-comment-input>
                  </span>
                </div>
              </div>
              <div class=${s.u(this.avatarCommentsClasses)}>
                <div class="avatar-container">${this.generateAvatarCommentsTemplate()}</div>
              </div>
            </div>
            <div class=${s.u(this.hrClasses)}></div>
          </div>
        </div>
      </div>
    `}};exports.CommentsAnnotationItem.styles=y,exports.CommentsAnnotationItem.properties={annotation:{type:Object},expandComments:{type:Boolean},selected:{type:String,reflect:!0},resolved:{type:Boolean},shouldShowUndoResolved:{type:Boolean},isLastAnnotation:{type:Boolean},annotationFilter:{type:String},participantsList:{type:Object},hideInput:{type:Boolean}},exports.CommentsAnnotationItem=p.F([a.ts("superviz-comments-annotation-item")],exports.CommentsAnnotationItem);
