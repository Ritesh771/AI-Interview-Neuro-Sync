"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const r=require("react"),R=require("./room-DPWLzMyU.cjs"),s=require("./index-N3n6WSly.cjs");function S(b){const[c,f]=r.useState(!1),[u,p]=r.useState(!1),{component:n,room:E,...o}=R.useInternalFeatures("realtime"),a=r.useRef({[s._.JOINED_ROOM]:[],[s._.LEAVE]:[],[s._.UPDATE]:[]}),e=r.useRef(null);r.useEffect(()=>{if(n){if(n.state===s.Si.STARTED){f(!0);return}n.subscribe("realtime-component.state-changed",t=>{f(t===s.Si.STARTED)})}},[n,a.current]),r.useEffect(()=>{if(!c&&!e.current||!n)return;(async()=>{if(e.current=await n.connect(b),e.current.state==="CONNECTED"){p(!0);return}e.current.subscribe("realtime-channel.state-changed",i=>{p(i==="CONNECTED")})})()},[c]),r.useEffect(()=>{e.current&&!E&&(e.current.disconnect(),e.current=null,p(!1),f(!1))},[n,E]),r.useEffect(()=>{u&&Object.keys(a.current).length&&(Object.entries(a.current).forEach(([t,i])=>{i.forEach(l=>{e.current.participant.subscribe(t,l)})}),a.current={[s._.JOINED_ROOM]:[],[s._.LEAVE]:[],[s._.UPDATE]:[]})},[u]);const d=r.useCallback((t,i)=>{if(!e.current){const l=a.current[t]||[];a.current[t]=l.includes(i)?l:[...l,i];return}e.current.participant.subscribe(t,i)},[n,o,a.current]),m=r.useCallback(t=>{!c||!u||e.current.participant.update(t)},[n,o,c]),y=r.useCallback(t=>{!c||!u||e.current.participant.unsubscribe(t)},[n,o,c]),C=r.useCallback(async()=>c?u?await e.current.participant.getAll():(console.warn(`[SuperViz] Channel ${b} is not ready - try again later`),Promise.resolve([])):(console.warn("[SuperViz] Realtime component is not ready - try again later"),Promise.resolve([])),[n,o,c]);return r.useMemo(()=>({isReady:u&&c,update:m,subscribe:d,unsubscribe:y,getAll:C}),[n,o,c,u])}exports.useRealtimeParticipant=S;
